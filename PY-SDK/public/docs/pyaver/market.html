<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.2"/>
    <title>pyaver.market API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../pyaver.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pyaver</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#AverMarket">AverMarket</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AverMarket.__init__">AverMarket</a>
                        </li>
                        <li>
                                <a class="variable" href="#AverMarket.market_pubkey">market_pubkey</a>
                        </li>
                        <li>
                                <a class="variable" href="#AverMarket.market_state">market_state</a>
                        </li>
                        <li>
                                <a class="variable" href="#AverMarket.market_store_state">market_store_state</a>
                        </li>
                        <li>
                                <a class="variable" href="#AverMarket.orderbooks">orderbooks</a>
                        </li>
                        <li>
                                <a class="variable" href="#AverMarket.aver_client">aver_client</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.load">load</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.load_multiple">load_multiple</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.load_market_state">load_market_state</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.load_multiple_market_states">load_multiple_market_states</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.load_market_state_and_store">load_market_state_and_store</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.load_multiple_market_states_and_stores">load_multiple_market_states_and_stores</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.derive_market_store_pubkey_and_bump">derive_market_store_pubkey_and_bump</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.get_markets_from_account_states">get_markets_from_account_states</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.load_market_store_state">load_market_store_state</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.load_multiple_market_store_states">load_multiple_market_store_states</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.is_market_status_closed">is_market_status_closed</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.get_orderbooks_from_orderbook_accounts">get_orderbooks_from_orderbook_accounts</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets">get_orderbooks_from_orderbook_accounts_multiple_markets</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.make_sweep_fees_instruction">make_sweep_fees_instruction</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.sweep_fees">sweep_fees</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.list_all_pubkeys">list_all_pubkeys</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.get_implied_market_status">get_implied_market_status</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.crank_market">crank_market</a>
                        </li>
                        <li>
                                <a class="function" href="#AverMarket.consume_events">consume_events</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../pyaver.html">pyaver</a><wbr>.market    </h1>

                
                        <input id="market-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="market-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">from</span> <span class="nn">solana.rpc.async_api</span> <span class="kn">import</span> <span class="n">AsyncClient</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">.event_queue</span> <span class="kn">import</span> <span class="n">load_all_event_queues</span><span class="p">,</span> <span class="n">prepare_user_accounts_list</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">.aver_client</span> <span class="kn">import</span> <span class="n">AverClient</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">solana.publickey</span> <span class="kn">import</span> <span class="n">PublicKey</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">solana.keypair</span> <span class="kn">import</span> <span class="n">Keypair</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">.enums</span> <span class="kn">import</span> <span class="n">Fill</span><span class="p">,</span> <span class="n">MarketStatus</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">AVER_MARKET_AUTHORITY</span><span class="p">,</span> <span class="n">AVER_PROGRAM_ID</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">load_multiple_bytes_data</span><span class="p">,</span> <span class="n">sign_and_send_transaction_instructions</span><span class="p">,</span> <span class="n">parse_market_store</span><span class="p">,</span> <span class="n">parse_market_state</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">.data_classes</span> <span class="kn">import</span> <span class="n">MarketState</span><span class="p">,</span> <span class="n">MarketStoreState</span><span class="p">,</span> <span class="n">OrderbookAccountsState</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">.orderbook</span> <span class="kn">import</span> <span class="n">Orderbook</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">solana.transaction</span> <span class="kn">import</span> <span class="n">AccountMeta</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">.slab</span> <span class="kn">import</span> <span class="n">Slab</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">anchorpy</span> <span class="kn">import</span> <span class="n">Context</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">spl.token.instructions</span> <span class="kn">import</span> <span class="n">get_associated_token_address</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">spl.token.constants</span> <span class="kn">import</span> <span class="n">TOKEN_PROGRAM_ID</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">solana.rpc.types</span> <span class="kn">import</span> <span class="n">TxOpts</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">AverMarket</span><span class="p">():</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    AverMarket object</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    Contains information, references and and orderbooks on a particular market</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="sd">&quot;&quot;&quot;Market pubkey&quot;&quot;&quot;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="n">market_state</span><span class="p">:</span> <span class="n">MarketState</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="sd">&quot;&quot;&quot;MarketState object holding data about the market&quot;&quot;&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="n">market_store_state</span><span class="p">:</span> <span class="n">MarketStoreState</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="sd">&quot;&quot;&quot;MarketStoreStateobject holding data about the market required during active trading. </span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    </span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    This does not exist if the market has stopped trading, voided or resolved&quot;&quot;&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="n">orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    Ordered list of Orderbooks for this market.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    Note: Binary (two-outcome0) markets only have 1 orderbook.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    <span class="sd">&quot;&quot;&quot;AverClient object&quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="n">market_state</span><span class="p">:</span> <span class="n">MarketState</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="n">market_store_state</span><span class="p">:</span> <span class="n">MarketStoreState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="n">orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="p">):</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        Initialise an AverMarket object. Do not use this function; use AverMarket.load() instead.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        Args:</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">            market_state (MarketState): MarketState object</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">            market_store_state (MarketStoreState, optional): MarketStoreState object. Defaults to None.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">            orderbooks (list[Orderbook], optional): List of Orderbook objects. Defaults to None.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span> <span class="o">=</span> <span class="n">market_pubkey</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span> <span class="o">=</span> <span class="n">market_state</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span> <span class="o">=</span> <span class="n">market_store_state</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orderbooks</span> <span class="o">=</span> <span class="n">orderbooks</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span> <span class="o">=</span> <span class="n">aver_client</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">orderbooks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert</span><span class="p">())</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">):</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        Initialises an AverMarket object</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        To refresh data on an already loaded market use src.refresh.refresh_markets()</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        Args:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        Returns:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">            AverMarket: AverMarket object</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="n">market_state_and_store</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_market_state_and_store</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="n">market_state</span><span class="p">:</span> <span class="n">MarketState</span> <span class="o">=</span> <span class="n">market_state_and_store</span><span class="p">[</span><span class="s1">&#39;market_states&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="n">market_store_state</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="n">orderbooks</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="n">is_market_status_closed</span> <span class="o">=</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="n">market_store_state</span><span class="p">:</span> <span class="n">MarketStoreState</span> <span class="o">=</span> <span class="n">market_state_and_store</span><span class="p">[</span><span class="s1">&#39;market_stores&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">is_market_status_closed</span><span class="p">):</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>            <span class="n">orderbooks</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>                <span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>                <span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>                <span class="p">[</span><span class="n">market_state</span><span class="o">.</span><span class="n">decimals</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>            <span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="k">return</span> <span class="n">AverMarket</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">,</span> <span class="n">market_state</span><span class="p">,</span> <span class="n">market_store_state</span><span class="p">,</span> <span class="n">orderbooks</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">]):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        Initialises multiple AverMarket objects</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        This method is quicker that using Market.load() multiple times</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        To refresh data on already loaded markets use src.refresh.refresh_multiple_markets()</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        Args:</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of Market public keys</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">        Returns:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">            list[AverMarket]: List of AverMarket objects</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">market_states_and_stores</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_states_and_stores</span><span class="p">[</span><span class="s1">&#39;market_states&#39;</span><span class="p">]</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">are_market_statuses_closed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="k">for</span> <span class="n">market_state</span> <span class="ow">in</span> <span class="n">market_states</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>            <span class="n">are_market_statuses_closed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AverMarket</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span><span class="p">))</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_states_and_stores</span><span class="p">[</span><span class="s1">&#39;market_stores&#39;</span><span class="p">]</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="n">orderbooks_market_list</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts_multiple_markets</span><span class="p">(</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>            <span class="n">market_states</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="n">market_stores</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>            <span class="n">are_market_statuses_closed</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">markets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AverMarket</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_pubkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>            <span class="n">market</span> <span class="o">=</span> <span class="n">AverMarket</span><span class="p">(</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                <span class="n">aver_client</span><span class="p">,</span> 
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>                <span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                <span class="n">market_states</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> 
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>                <span class="n">market_stores</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> 
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>                <span class="n">orderbooks_market_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>                <span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="n">markets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">markets</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_state</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketState</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        Loads onchain data for a MarketState</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        Args:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        Returns:</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">            MarketState: MarketState object</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a> 
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_states</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">]:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Loads onchain data for multiple MarketStates</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        Args:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        Returns:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">            list[MarketState]: List of MarketState objects</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch_multiple</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>   
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_state_and_store</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">):</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        Loads onchain data for multiple MarketStates and MarketStoreStates at once</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        Args:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">            market_pubkey (PublicKey]: Market public key</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">        Returns:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">            dict[str, list[MarketState] or list[MarketStoreState]]: Keys are market_states or market_stores</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="p">[</span><span class="n">market_pubkey</span><span class="p">])</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">]):</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        Loads onchain data for multiple MarketStates and MarketStoreStates at once</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        Args:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        Returns:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">            dict[str, list[MarketState] or list[MarketStoreState]]: Keys are market_states or market_stores</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">market_store_pubkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">AverMarket</span><span class="o">.</span><span class="n">derive_market_store_pubkey_and_bump</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">market_pubkeys</span><span class="p">]</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_multiple_bytes_data</span><span class="p">(</span><span class="n">aver_client</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">market_pubkeys</span> <span class="o">+</span> <span class="n">market_store_pubkeys</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="n">market_states_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">)]</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="n">market_stores_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):]</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">market_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">parse_market_state</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">aver_client</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">market_states_data</span><span class="p">]</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="n">market_stores</span> <span class="o">=</span> <span class="p">[</span><span class="n">parse_market_store</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">aver_client</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">market_stores_data</span><span class="p">]</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;market_states&#39;</span><span class="p">:</span> <span class="n">market_states</span><span class="p">,</span> <span class="s1">&#39;market_stores&#39;</span><span class="p">:</span> <span class="n">market_stores</span><span class="p">}</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="nf">derive_market_store_pubkey_and_bump</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span> <span class="n">program_id</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        Derives PDA (Program Derived Account) for MarketStore public key.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        MarketStore account addresses are derived deterministically using the market&#39;s pubkey.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        Args:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">            program_id (PublicKey, optional): Program public key. Defaults to AVER_PROGRAM_ID.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">        Returns:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">            PublicKey: MarketStore public key</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="k">return</span> <span class="n">PublicKey</span><span class="o">.</span><span class="n">find_program_address</span><span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;market-store&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">)],</span> 
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="n">program_id</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">get_markets_from_account_states</span><span class="p">(</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span> 
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">],</span> 
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">],</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">slabs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Slab</span><span class="p">],</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="p">):</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        Returns multiple AverMarket objects from their respective MarketStates, stores and orderbook objects</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        Used in refresh.py</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        Args:</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">            market_states (list[MarketState]): List of MarketState objects</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">            market_stores (list[MarketStoreState]): List of MarketStoreState objects</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">            slabs (list[Slab]): List of slab objects (used in orderbooks)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        Returns:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">            lst[AverMarket]: List of AverMarket objects</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">slab_position_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="n">all_orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">market_store</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_stores</span><span class="p">):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="n">all_orderbooks_for_market</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">market_store</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>                <span class="n">all_orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>                <span class="k">continue</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">orderbook</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>                <span class="n">orderbook</span> <span class="o">=</span> <span class="n">Orderbook</span><span class="p">(</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span> 
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>                    <span class="n">slabs</span><span class="p">[</span><span class="n">slab_position_counter</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>                    <span class="n">slabs</span><span class="p">[</span><span class="n">slab_position_counter</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">bids</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">asks</span><span class="p">,</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>                    <span class="n">market_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">decimals</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>                    <span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>                <span class="n">all_orderbooks_for_market</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbook</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="n">slab_position_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="n">all_orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks_for_market</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="n">markets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AverMarket</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">markets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AverMarket</span><span class="p">(</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                <span class="n">aver_client</span><span class="p">,</span> 
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>                <span class="n">m</span><span class="p">,</span> 
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="n">market_states</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                <span class="n">market_stores</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                <span class="n">all_orderbooks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                <span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="k">return</span> <span class="n">markets</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_store_state</span><span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="n">is_market_status_closed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="n">market_store_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span> 
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketStoreState</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        Loads onchain data for a MarketStore State</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">        Args:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">            is_market_status_closed (bool): True if market status is closed, voided or resolved</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">            market_store_pubkey (PublicKey): MarketStore public key</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        Returns:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">            MarketStoreState: MarketStoreStateobject</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="c1">#Closed markets do not have orderbooks</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">is_market_status_closed</span><span class="p">):</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;MarketStore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">market_store_pubkey</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_store_states</span><span class="p">(</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">market_store_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span> 
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">]:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        Loads onchain data for multiple MarketStore States</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">        Args:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">            market_store_pubkeys (list[PublicKey]): List of MarketStore public keys</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        Returns:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">            list[MarketStoreState]: List of MarketStore public keys</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;MarketStore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch_multiple</span><span class="p">(</span><span class="n">market_store_pubkeys</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="n">res</span>       
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="k">def</span> <span class="nf">is_market_status_closed</span><span class="p">(</span><span class="n">market_status</span><span class="p">:</span> <span class="n">MarketStatus</span><span class="p">):</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        Checks if a market no longer in a trading status, and therefore will have no Orderbook or MarketStore accounts.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">        Note: Once trading has ceased for a market, these accounts are closed.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        Args:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            market_status (MarketStatus): Market status (find in MarketState object)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        Returns:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            bool: Market status closed</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="k">return</span> <span class="n">market_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MarketStatus</span><span class="o">.</span><span class="n">CEASED_CRANKED_CLOSED</span><span class="p">,</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">RESOLVED</span><span class="p">,</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">VOIDED</span><span class="p">]</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="n">conn</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span> 
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="n">orderbook_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">OrderbookAccountsState</span><span class="p">],</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="n">decimals_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">        Returns Orderbook objects from Orderbook Account objects, by fetching and parsing. </span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">        Args:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">            conn (AsyncClient): Solana AsyncClient object</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">            orderbook_accounts (list[OrderbookAccountsState]): List of orderbook account objects</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">            decimals_list (list[int]): List of decimal precision for each orderbook account state. Variable normally found in MarketState object</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">        Raises:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">            Exception: Decimals list and orderbook accounts do not have the same length</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">        Returns:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">            list[Orderbook]: List of orderbook objects</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decimals_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orderbook_accounts</span><span class="p">)):</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;decimals_list and orderbook_accounts should have the same length&#39;</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="n">all_bids_and_asks_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">orderbook_accounts</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="n">all_bids_and_asks_accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">bids</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">all_bids_and_asks_accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">asks</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">all_slabs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Orderbook</span><span class="o">.</span><span class="n">load_multiple_slabs</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">all_bids_and_asks_accounts</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orderbook_accounts</span><span class="p">):</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="n">orderbook</span> <span class="o">=</span> <span class="n">Orderbook</span><span class="p">(</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>                <span class="n">o</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span> 
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                <span class="n">all_slabs</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> 
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>                <span class="n">all_slabs</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> 
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>                <span class="n">o</span><span class="o">.</span><span class="n">bids</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">asks</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>                <span class="n">decimals_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>                <span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>            <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbook</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="k">return</span> <span class="n">orderbooks</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_orderbooks_from_orderbook_accounts_multiple_markets</span><span class="p">(</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="n">conn</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">],</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">],</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="n">are_market_statuses_closed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="p">):</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        Returns Orderbook objects from MarketState and MarketStoreStateobjects,</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        by fetching and parsing for multiple markets.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">        Use when fetching orderbooks for multiple markets </span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        Args:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">            conn (AsyncClient): Solana AsyncClient object</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">            market_states (list[MarketState]): List of MarketState objects</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">            market_stores (list[MarketStoreState]): List of MarketStoreStateobjects</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">            are_market_statuses_closed (list[bool]): Lists if each market is closed or not</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        Returns:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">            list[list[Orderbook]]: List of orderbooks for each market</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="c1">#Create list of accounts and the decimals for each account</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="n">orderbook_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="n">decimals_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_store</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_stores</span><span class="p">):</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">market_store</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                <span class="k">continue</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="n">orderbook_accounts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)):</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>                <span class="n">decimals_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market_states</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">decimals</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="c1">#Load all orderbooks</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="n">all_orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">orderbook_accounts</span><span class="p">,</span> <span class="n">decimals_list</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="n">orderbooks_market_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="c1">#Create a list for each market we received. The list contains all orderbooks for that market</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_states</span><span class="p">):</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="n">number_of_outcomes</span> <span class="o">=</span> <span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>            <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="c1">#Market is closed</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">are_market_statuses_closed</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                <span class="n">orderbooks_market_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                <span class="k">continue</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="c1">#Binary markets only have 1 orderbook</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>                <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>                <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_outcomes</span><span class="p">):</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>                    <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="n">orderbooks_market_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="k">return</span> <span class="n">orderbooks_market_list</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>    
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>    <span class="k">def</span> <span class="nf">make_sweep_fees_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        Creates instruction to sweeps fees and sends to relevant accounts</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        Returns TransactionInstruction object only. Does not send transaction.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        Returns:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">            TransactionInstruction: TransactionInstruction object</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">quote_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">quote_token</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="n">third_party_vault_authority</span><span class="p">,</span> <span class="n">bump</span> <span class="o">=</span> <span class="n">PublicKey</span><span class="o">.</span><span class="n">find_program_address</span><span class="p">(</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;third-party-token-vault&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">quote_token</span><span class="p">)],</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="n">third_party_vault_token_account</span> <span class="o">=</span> <span class="n">get_associated_token_address</span><span class="p">(</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            <span class="n">third_party_vault_authority</span><span class="p">,</span> <span class="n">quote_token</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="n">aver_quote_token_account</span> <span class="o">=</span> <span class="n">get_associated_token_address</span><span class="p">(</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="n">AVER_MARKET_AUTHORITY</span><span class="p">,</span> <span class="n">quote_token</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">instruction</span><span class="p">[</span><span class="s2">&quot;sweep_fees&quot;</span><span class="p">](</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="n">ctx</span><span class="o">=</span><span class="n">Context</span><span class="p">(</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>                <span class="n">accounts</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>                    <span class="s2">&quot;market&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>                    <span class="s2">&quot;quote_vault&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">quote_vault</span><span class="p">,</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                    <span class="s2">&quot;vault_authority&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">vault_authority</span><span class="p">,</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>                    <span class="s2">&quot;third_party_token_vault&quot;</span><span class="p">:</span> <span class="n">third_party_vault_token_account</span><span class="p">,</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                    <span class="s2">&quot;aver_quote_token_account&quot;</span><span class="p">:</span> <span class="n">aver_quote_token_account</span><span class="p">,</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                    <span class="s2">&quot;spl_token_program&quot;</span><span class="p">:</span> <span class="n">TOKEN_PROGRAM_ID</span><span class="p">,</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>                <span class="p">},</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>                <span class="n">signers</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="p">),</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">sweep_fees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fee_payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">send_options</span><span class="p">:</span> <span class="n">TxOpts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,):</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        Sweeps fees and sends to relevant accounts</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        Sends instructions on chain</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">        Args:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">            fee_payer (Keypair): Pays transaction fees. Defaults to AverClient wallet</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">            send_options (TxOpts, optional): Options to specify when broadcasting a transaction. Defaults to None.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">        Returns:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">            RPCResponse: Response</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">fee_payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>            <span class="n">fee_payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="n">ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_sweep_fees_instruction</span><span class="p">()</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">sign_and_send_transaction_instructions</span><span class="p">(</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>            <span class="p">[],</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="n">fee_payer</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>            <span class="p">[</span><span class="n">ix</span><span class="p">],</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="n">send_options</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>    <span class="k">def</span> <span class="nf">list_all_pubkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        Returns all pubkeys used in AverMarket object</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        Returns:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">            list[PublicKey]: List of public keys</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="n">list_of_pubkeys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">quote_vault</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">oracle_feed</span><span class="p">]</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderbooks</span><span class="p">:</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                <span class="n">list_of_pubkeys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ob</span><span class="o">.</span><span class="n">pubkey</span><span class="p">,</span> <span class="n">ob</span><span class="o">.</span><span class="n">slab_asks_pubkey</span><span class="p">,</span> <span class="n">ob</span><span class="o">.</span><span class="n">slab_asks_pubkey</span><span class="p">]</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="k">return</span> <span class="n">list_of_pubkeys</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>    
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_implied_market_status</span><span class="p">(</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>            <span class="bp">self</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketStatus</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        Returns what we believe the market status ought to be (rather than what is stored in the market&#39;s state on-chain)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        Note: As a fail safe, markets have specified times beyond which the market will react as if it is in another Status until it is formally cranked to that Status.</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        For example, if Solana were to have issues and it was not possible for the market&#39;s authority to crank it into In-Play status or to Cease Trading in time,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        the market would use the System Time as a trigger to treat new requests as if it were in the later Status.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">        If Solana clock time is beyond TradingCeaseTime, market is TradingCeased</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">        If Solana clock time is beyond InPlayStartTime but before TradingCeaseTime, market is ActiveInPlay</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">        Returns:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">            MarketStatus: Implied market status</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="n">solana_datetime</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">get_system_clock_datetime</span><span class="p">()</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="n">solana_datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">trading_cease_time</span><span class="p">:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>            <span class="k">return</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">TRADING_CEASED</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">inplay_start_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">solana_datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">inplay_start_time</span> <span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>            <span class="k">return</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">ACTIVE_IN_PLAY</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">crank_market</span><span class="p">(</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>            <span class="n">outcome_idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="n">reward_target</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>            <span class="n">payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="p">):</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">        Refresh market before cranking</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">        If no outcome_idx are passed, all outcomes are cranked if they meet the criteria to be cranked.</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="k">if</span> <span class="n">outcome_idxs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="c1"># For binary markets, there is only one orderbook</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>            <span class="n">outcome_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>                <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span><span class="p">)]</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">outcome_idxs</span> <span class="ow">or</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">outcome_idxs</span><span class="p">):</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>            <span class="n">outcome_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="k">if</span> <span class="n">reward_target</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>            <span class="n">reward_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">public_key</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="k">if</span> <span class="n">payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="n">payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="c1"># refreshed_market = await refresh_market(self.aver_client, self)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="n">event_queues</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">event_queue</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">]</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="n">loaded_event_queues</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_all_event_queues</span><span class="p">(</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>            <span class="n">event_queues</span> 
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>            <span class="p">)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">outcome_idxs</span><span class="p">:</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>            <span class="k">if</span> <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;header&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>                <span class="k">continue</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cranking market </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">)</span><span class="si">}</span><span class="s1"> for outcome </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;header&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s1"> events left to crank&#39;</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>            <span class="k">if</span> <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>                <span class="n">user_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]):</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">==</span> <span class="n">Fill</span><span class="p">:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>                        <span class="n">user_accounts</span> <span class="o">+=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">maker_user_market</span><span class="p">]</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Out</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>                        <span class="n">user_accounts</span> <span class="o">+=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">user_market</span><span class="p">]</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span><span class="p">:</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>                        <span class="k">break</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>                <span class="n">user_accounts</span> <span class="o">=</span> <span class="n">prepare_user_accounts_list</span><span class="p">(</span><span class="n">user_accounts</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>                <span class="n">events_to_crank</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>                    <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span><span class="p">)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>                <span class="n">sig</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume_events</span><span class="p">(</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>                    <span class="n">outcome_idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>                    <span class="n">max_iterations</span><span class="o">=</span><span class="n">events_to_crank</span><span class="p">,</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>                    <span class="n">user_accounts</span><span class="o">=</span><span class="n">user_accounts</span><span class="p">,</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>                    <span class="n">reward_target</span><span class="o">=</span><span class="n">reward_target</span><span class="p">,</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>                    <span class="n">payer</span><span class="o">=</span><span class="n">payer</span><span class="p">,</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>                <span class="p">)</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>        <span class="k">return</span> <span class="n">sig</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">consume_events</span><span class="p">(</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>        <span class="n">outcome_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>        <span class="n">user_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>        <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>        <span class="n">reward_target</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="n">payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>    <span class="p">):</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">        Consume events</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">        Sends instructions on chain</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a><span class="sd">        Args:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">            outcome_idx (int): index of the outcome</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">            user_accounts (list[PublicKey]): List of User Account public keys</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="sd">            max_iterations (int, optional): Depth of events to iterate through. Defaults to MAX_ITERATIONS_FOR_CONSUME_EVENTS.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="sd">            reward_target (PublicKey, optional): Target for reward. Defaults to AverClient wallet.</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">            payer (Keypair, optional): Fee payer. Defaults to AverClient wallet.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">        Returns:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">            Transaction Signature: TransactionSignature object</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>        <span class="k">if</span> <span class="n">reward_target</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>            <span class="n">reward_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">public_key</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>        <span class="k">if</span> <span class="n">payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>            <span class="n">payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="k">if</span> <span class="n">max_iterations</span> <span class="o">&gt;</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span> <span class="ow">or</span> <span class="n">max_iterations</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>            <span class="n">max_iterations</span> <span class="o">=</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="n">user_accounts_unsorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">AccountMeta</span><span class="p">(</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>                <span class="n">pk</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">user_accounts</span><span class="p">]</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>                
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="n">remaining_accounts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">user_accounts_unsorted</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">account</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">pubkey</span><span class="p">))</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">rpc</span><span class="p">[</span><span class="s2">&quot;consume_events&quot;</span><span class="p">](</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>                <span class="n">max_iterations</span><span class="p">,</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>                <span class="n">outcome_idx</span><span class="p">,</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>                <span class="n">ctx</span><span class="o">=</span><span class="n">Context</span><span class="p">(</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>                    <span class="n">accounts</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>                        <span class="s2">&quot;market&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>                        <span class="s2">&quot;market_store&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_store</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                        <span class="s2">&quot;orderbook&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">[</span><span class="n">outcome_idx</span><span class="p">]</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>                        <span class="s2">&quot;event_queue&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">[</span><span class="n">outcome_idx</span><span class="p">]</span><span class="o">.</span><span class="n">event_queue</span><span class="p">,</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>                        <span class="s2">&quot;reward_target&quot;</span><span class="p">:</span> <span class="n">reward_target</span><span class="p">,</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>                    <span class="p">},</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>                    <span class="n">remaining_accounts</span><span class="o">=</span><span class="n">remaining_accounts</span><span class="p">,</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>                <span class="p">),</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>            <span class="p">)</span>
</span></pre></div>


            </section>
                <section id="AverMarket">
                            <input id="AverMarket-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AverMarket</span>:

                <label class="view-source-button" for="AverMarket-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket-20"><a href="#AverMarket-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">AverMarket</span><span class="p">():</span>
</span><span id="AverMarket-21"><a href="#AverMarket-21"><span class="linenos"> 21</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-22"><a href="#AverMarket-22"><span class="linenos"> 22</span></a><span class="sd">    AverMarket object</span>
</span><span id="AverMarket-23"><a href="#AverMarket-23"><span class="linenos"> 23</span></a>
</span><span id="AverMarket-24"><a href="#AverMarket-24"><span class="linenos"> 24</span></a><span class="sd">    Contains information, references and and orderbooks on a particular market</span>
</span><span id="AverMarket-25"><a href="#AverMarket-25"><span class="linenos"> 25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AverMarket-26"><a href="#AverMarket-26"><span class="linenos"> 26</span></a>
</span><span id="AverMarket-27"><a href="#AverMarket-27"><span class="linenos"> 27</span></a>    <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span>
</span><span id="AverMarket-28"><a href="#AverMarket-28"><span class="linenos"> 28</span></a>    <span class="sd">&quot;&quot;&quot;Market pubkey&quot;&quot;&quot;</span>
</span><span id="AverMarket-29"><a href="#AverMarket-29"><span class="linenos"> 29</span></a>    <span class="n">market_state</span><span class="p">:</span> <span class="n">MarketState</span>
</span><span id="AverMarket-30"><a href="#AverMarket-30"><span class="linenos"> 30</span></a>    <span class="sd">&quot;&quot;&quot;MarketState object holding data about the market&quot;&quot;&quot;</span>
</span><span id="AverMarket-31"><a href="#AverMarket-31"><span class="linenos"> 31</span></a>    <span class="n">market_store_state</span><span class="p">:</span> <span class="n">MarketStoreState</span>
</span><span id="AverMarket-32"><a href="#AverMarket-32"><span class="linenos"> 32</span></a>    <span class="sd">&quot;&quot;&quot;MarketStoreStateobject holding data about the market required during active trading. </span>
</span><span id="AverMarket-33"><a href="#AverMarket-33"><span class="linenos"> 33</span></a><span class="sd">    </span>
</span><span id="AverMarket-34"><a href="#AverMarket-34"><span class="linenos"> 34</span></a><span class="sd">    This does not exist if the market has stopped trading, voided or resolved&quot;&quot;&quot;</span>
</span><span id="AverMarket-35"><a href="#AverMarket-35"><span class="linenos"> 35</span></a>    <span class="n">orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]</span>
</span><span id="AverMarket-36"><a href="#AverMarket-36"><span class="linenos"> 36</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-37"><a href="#AverMarket-37"><span class="linenos"> 37</span></a><span class="sd">    Ordered list of Orderbooks for this market.</span>
</span><span id="AverMarket-38"><a href="#AverMarket-38"><span class="linenos"> 38</span></a>
</span><span id="AverMarket-39"><a href="#AverMarket-39"><span class="linenos"> 39</span></a><span class="sd">    Note: Binary (two-outcome0) markets only have 1 orderbook.</span>
</span><span id="AverMarket-40"><a href="#AverMarket-40"><span class="linenos"> 40</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AverMarket-41"><a href="#AverMarket-41"><span class="linenos"> 41</span></a>    <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span>
</span><span id="AverMarket-42"><a href="#AverMarket-42"><span class="linenos"> 42</span></a>    <span class="sd">&quot;&quot;&quot;AverClient object&quot;&quot;&quot;</span>
</span><span id="AverMarket-43"><a href="#AverMarket-43"><span class="linenos"> 43</span></a>
</span><span id="AverMarket-44"><a href="#AverMarket-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="AverMarket-45"><a href="#AverMarket-45"><span class="linenos"> 45</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="AverMarket-46"><a href="#AverMarket-46"><span class="linenos"> 46</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="AverMarket-47"><a href="#AverMarket-47"><span class="linenos"> 47</span></a>        <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span>
</span><span id="AverMarket-48"><a href="#AverMarket-48"><span class="linenos"> 48</span></a>        <span class="n">market_state</span><span class="p">:</span> <span class="n">MarketState</span><span class="p">,</span>
</span><span id="AverMarket-49"><a href="#AverMarket-49"><span class="linenos"> 49</span></a>        <span class="n">market_store_state</span><span class="p">:</span> <span class="n">MarketStoreState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket-50"><a href="#AverMarket-50"><span class="linenos"> 50</span></a>        <span class="n">orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket-51"><a href="#AverMarket-51"><span class="linenos"> 51</span></a>        <span class="p">):</span>
</span><span id="AverMarket-52"><a href="#AverMarket-52"><span class="linenos"> 52</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-53"><a href="#AverMarket-53"><span class="linenos"> 53</span></a><span class="sd">        Initialise an AverMarket object. Do not use this function; use AverMarket.load() instead.</span>
</span><span id="AverMarket-54"><a href="#AverMarket-54"><span class="linenos"> 54</span></a>
</span><span id="AverMarket-55"><a href="#AverMarket-55"><span class="linenos"> 55</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-56"><a href="#AverMarket-56"><span class="linenos"> 56</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-57"><a href="#AverMarket-57"><span class="linenos"> 57</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="AverMarket-58"><a href="#AverMarket-58"><span class="linenos"> 58</span></a><span class="sd">            market_state (MarketState): MarketState object</span>
</span><span id="AverMarket-59"><a href="#AverMarket-59"><span class="linenos"> 59</span></a><span class="sd">            market_store_state (MarketStoreState, optional): MarketStoreState object. Defaults to None.</span>
</span><span id="AverMarket-60"><a href="#AverMarket-60"><span class="linenos"> 60</span></a><span class="sd">            orderbooks (list[Orderbook], optional): List of Orderbook objects. Defaults to None.</span>
</span><span id="AverMarket-61"><a href="#AverMarket-61"><span class="linenos"> 61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-62"><a href="#AverMarket-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span> <span class="o">=</span> <span class="n">market_pubkey</span>
</span><span id="AverMarket-63"><a href="#AverMarket-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span> <span class="o">=</span> <span class="n">market_state</span>
</span><span id="AverMarket-64"><a href="#AverMarket-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span> <span class="o">=</span> <span class="n">market_store_state</span>
</span><span id="AverMarket-65"><a href="#AverMarket-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orderbooks</span> <span class="o">=</span> <span class="n">orderbooks</span>
</span><span id="AverMarket-66"><a href="#AverMarket-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span> <span class="o">=</span> <span class="n">aver_client</span>
</span><span id="AverMarket-67"><a href="#AverMarket-67"><span class="linenos"> 67</span></a>
</span><span id="AverMarket-68"><a href="#AverMarket-68"><span class="linenos"> 68</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">orderbooks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AverMarket-69"><a href="#AverMarket-69"><span class="linenos"> 69</span></a>            <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert</span><span class="p">())</span>
</span><span id="AverMarket-70"><a href="#AverMarket-70"><span class="linenos"> 70</span></a>    
</span><span id="AverMarket-71"><a href="#AverMarket-71"><span class="linenos"> 71</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-72"><a href="#AverMarket-72"><span class="linenos"> 72</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">):</span>
</span><span id="AverMarket-73"><a href="#AverMarket-73"><span class="linenos"> 73</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-74"><a href="#AverMarket-74"><span class="linenos"> 74</span></a><span class="sd">        Initialises an AverMarket object</span>
</span><span id="AverMarket-75"><a href="#AverMarket-75"><span class="linenos"> 75</span></a>
</span><span id="AverMarket-76"><a href="#AverMarket-76"><span class="linenos"> 76</span></a><span class="sd">        To refresh data on an already loaded market use src.refresh.refresh_markets()</span>
</span><span id="AverMarket-77"><a href="#AverMarket-77"><span class="linenos"> 77</span></a>
</span><span id="AverMarket-78"><a href="#AverMarket-78"><span class="linenos"> 78</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-79"><a href="#AverMarket-79"><span class="linenos"> 79</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-80"><a href="#AverMarket-80"><span class="linenos"> 80</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="AverMarket-81"><a href="#AverMarket-81"><span class="linenos"> 81</span></a>
</span><span id="AverMarket-82"><a href="#AverMarket-82"><span class="linenos"> 82</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-83"><a href="#AverMarket-83"><span class="linenos"> 83</span></a><span class="sd">            AverMarket: AverMarket object</span>
</span><span id="AverMarket-84"><a href="#AverMarket-84"><span class="linenos"> 84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-85"><a href="#AverMarket-85"><span class="linenos"> 85</span></a>        <span class="n">market_state_and_store</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_market_state_and_store</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">)</span>
</span><span id="AverMarket-86"><a href="#AverMarket-86"><span class="linenos"> 86</span></a>        <span class="n">market_state</span><span class="p">:</span> <span class="n">MarketState</span> <span class="o">=</span> <span class="n">market_state_and_store</span><span class="p">[</span><span class="s1">&#39;market_states&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AverMarket-87"><a href="#AverMarket-87"><span class="linenos"> 87</span></a>        <span class="n">market_store_state</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AverMarket-88"><a href="#AverMarket-88"><span class="linenos"> 88</span></a>        <span class="n">orderbooks</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AverMarket-89"><a href="#AverMarket-89"><span class="linenos"> 89</span></a>        <span class="n">is_market_status_closed</span> <span class="o">=</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span><span class="p">)</span>
</span><span id="AverMarket-90"><a href="#AverMarket-90"><span class="linenos"> 90</span></a>        <span class="n">market_store_state</span><span class="p">:</span> <span class="n">MarketStoreState</span> <span class="o">=</span> <span class="n">market_state_and_store</span><span class="p">[</span><span class="s1">&#39;market_stores&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AverMarket-91"><a href="#AverMarket-91"><span class="linenos"> 91</span></a>
</span><span id="AverMarket-92"><a href="#AverMarket-92"><span class="linenos"> 92</span></a>        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">is_market_status_closed</span><span class="p">):</span>
</span><span id="AverMarket-93"><a href="#AverMarket-93"><span class="linenos"> 93</span></a>            <span class="n">orderbooks</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span>
</span><span id="AverMarket-94"><a href="#AverMarket-94"><span class="linenos"> 94</span></a>                <span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="AverMarket-95"><a href="#AverMarket-95"><span class="linenos"> 95</span></a>                <span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">,</span>
</span><span id="AverMarket-96"><a href="#AverMarket-96"><span class="linenos"> 96</span></a>                <span class="p">[</span><span class="n">market_state</span><span class="o">.</span><span class="n">decimals</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span>
</span><span id="AverMarket-97"><a href="#AverMarket-97"><span class="linenos"> 97</span></a>            <span class="p">)</span>
</span><span id="AverMarket-98"><a href="#AverMarket-98"><span class="linenos"> 98</span></a>
</span><span id="AverMarket-99"><a href="#AverMarket-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="n">AverMarket</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">,</span> <span class="n">market_state</span><span class="p">,</span> <span class="n">market_store_state</span><span class="p">,</span> <span class="n">orderbooks</span><span class="p">)</span>
</span><span id="AverMarket-100"><a href="#AverMarket-100"><span class="linenos">100</span></a>
</span><span id="AverMarket-101"><a href="#AverMarket-101"><span class="linenos">101</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-102"><a href="#AverMarket-102"><span class="linenos">102</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">]):</span>
</span><span id="AverMarket-103"><a href="#AverMarket-103"><span class="linenos">103</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-104"><a href="#AverMarket-104"><span class="linenos">104</span></a><span class="sd">        Initialises multiple AverMarket objects</span>
</span><span id="AverMarket-105"><a href="#AverMarket-105"><span class="linenos">105</span></a>
</span><span id="AverMarket-106"><a href="#AverMarket-106"><span class="linenos">106</span></a><span class="sd">        This method is quicker that using Market.load() multiple times</span>
</span><span id="AverMarket-107"><a href="#AverMarket-107"><span class="linenos">107</span></a>
</span><span id="AverMarket-108"><a href="#AverMarket-108"><span class="linenos">108</span></a><span class="sd">        To refresh data on already loaded markets use src.refresh.refresh_multiple_markets()</span>
</span><span id="AverMarket-109"><a href="#AverMarket-109"><span class="linenos">109</span></a>
</span><span id="AverMarket-110"><a href="#AverMarket-110"><span class="linenos">110</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-111"><a href="#AverMarket-111"><span class="linenos">111</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-112"><a href="#AverMarket-112"><span class="linenos">112</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of Market public keys</span>
</span><span id="AverMarket-113"><a href="#AverMarket-113"><span class="linenos">113</span></a>
</span><span id="AverMarket-114"><a href="#AverMarket-114"><span class="linenos">114</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-115"><a href="#AverMarket-115"><span class="linenos">115</span></a><span class="sd">            list[AverMarket]: List of AverMarket objects</span>
</span><span id="AverMarket-116"><a href="#AverMarket-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-117"><a href="#AverMarket-117"><span class="linenos">117</span></a>        <span class="n">market_states_and_stores</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">)</span>
</span><span id="AverMarket-118"><a href="#AverMarket-118"><span class="linenos">118</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_states_and_stores</span><span class="p">[</span><span class="s1">&#39;market_states&#39;</span><span class="p">]</span>
</span><span id="AverMarket-119"><a href="#AverMarket-119"><span class="linenos">119</span></a>
</span><span id="AverMarket-120"><a href="#AverMarket-120"><span class="linenos">120</span></a>        <span class="n">are_market_statuses_closed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-121"><a href="#AverMarket-121"><span class="linenos">121</span></a>        <span class="k">for</span> <span class="n">market_state</span> <span class="ow">in</span> <span class="n">market_states</span><span class="p">:</span>
</span><span id="AverMarket-122"><a href="#AverMarket-122"><span class="linenos">122</span></a>            <span class="n">are_market_statuses_closed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AverMarket</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span><span class="p">))</span>
</span><span id="AverMarket-123"><a href="#AverMarket-123"><span class="linenos">123</span></a>
</span><span id="AverMarket-124"><a href="#AverMarket-124"><span class="linenos">124</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_states_and_stores</span><span class="p">[</span><span class="s1">&#39;market_stores&#39;</span><span class="p">]</span>
</span><span id="AverMarket-125"><a href="#AverMarket-125"><span class="linenos">125</span></a>
</span><span id="AverMarket-126"><a href="#AverMarket-126"><span class="linenos">126</span></a>        <span class="n">orderbooks_market_list</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts_multiple_markets</span><span class="p">(</span>
</span><span id="AverMarket-127"><a href="#AverMarket-127"><span class="linenos">127</span></a>            <span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="AverMarket-128"><a href="#AverMarket-128"><span class="linenos">128</span></a>            <span class="n">market_states</span><span class="p">,</span>
</span><span id="AverMarket-129"><a href="#AverMarket-129"><span class="linenos">129</span></a>            <span class="n">market_stores</span><span class="p">,</span>
</span><span id="AverMarket-130"><a href="#AverMarket-130"><span class="linenos">130</span></a>            <span class="n">are_market_statuses_closed</span><span class="p">,</span>
</span><span id="AverMarket-131"><a href="#AverMarket-131"><span class="linenos">131</span></a>        <span class="p">)</span>
</span><span id="AverMarket-132"><a href="#AverMarket-132"><span class="linenos">132</span></a>        
</span><span id="AverMarket-133"><a href="#AverMarket-133"><span class="linenos">133</span></a>        <span class="n">markets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AverMarket</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-134"><a href="#AverMarket-134"><span class="linenos">134</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_pubkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):</span>
</span><span id="AverMarket-135"><a href="#AverMarket-135"><span class="linenos">135</span></a>            <span class="n">market</span> <span class="o">=</span> <span class="n">AverMarket</span><span class="p">(</span>
</span><span id="AverMarket-136"><a href="#AverMarket-136"><span class="linenos">136</span></a>                <span class="n">aver_client</span><span class="p">,</span> 
</span><span id="AverMarket-137"><a href="#AverMarket-137"><span class="linenos">137</span></a>                <span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="AverMarket-138"><a href="#AverMarket-138"><span class="linenos">138</span></a>                <span class="n">market_states</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> 
</span><span id="AverMarket-139"><a href="#AverMarket-139"><span class="linenos">139</span></a>                <span class="n">market_stores</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> 
</span><span id="AverMarket-140"><a href="#AverMarket-140"><span class="linenos">140</span></a>                <span class="n">orderbooks_market_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="AverMarket-141"><a href="#AverMarket-141"><span class="linenos">141</span></a>                <span class="p">)</span>
</span><span id="AverMarket-142"><a href="#AverMarket-142"><span class="linenos">142</span></a>            <span class="n">markets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
</span><span id="AverMarket-143"><a href="#AverMarket-143"><span class="linenos">143</span></a>        
</span><span id="AverMarket-144"><a href="#AverMarket-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="n">markets</span>
</span><span id="AverMarket-145"><a href="#AverMarket-145"><span class="linenos">145</span></a>
</span><span id="AverMarket-146"><a href="#AverMarket-146"><span class="linenos">146</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-147"><a href="#AverMarket-147"><span class="linenos">147</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_state</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketState</span><span class="p">:</span>
</span><span id="AverMarket-148"><a href="#AverMarket-148"><span class="linenos">148</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-149"><a href="#AverMarket-149"><span class="linenos">149</span></a><span class="sd">        Loads onchain data for a MarketState</span>
</span><span id="AverMarket-150"><a href="#AverMarket-150"><span class="linenos">150</span></a>
</span><span id="AverMarket-151"><a href="#AverMarket-151"><span class="linenos">151</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-152"><a href="#AverMarket-152"><span class="linenos">152</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-153"><a href="#AverMarket-153"><span class="linenos">153</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="AverMarket-154"><a href="#AverMarket-154"><span class="linenos">154</span></a>
</span><span id="AverMarket-155"><a href="#AverMarket-155"><span class="linenos">155</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-156"><a href="#AverMarket-156"><span class="linenos">156</span></a><span class="sd">            MarketState: MarketState object</span>
</span><span id="AverMarket-157"><a href="#AverMarket-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-158"><a href="#AverMarket-158"><span class="linenos">158</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">)</span>
</span><span id="AverMarket-159"><a href="#AverMarket-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="AverMarket-160"><a href="#AverMarket-160"><span class="linenos">160</span></a> 
</span><span id="AverMarket-161"><a href="#AverMarket-161"><span class="linenos">161</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-162"><a href="#AverMarket-162"><span class="linenos">162</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_states</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">]:</span>
</span><span id="AverMarket-163"><a href="#AverMarket-163"><span class="linenos">163</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-164"><a href="#AverMarket-164"><span class="linenos">164</span></a><span class="sd">        Loads onchain data for multiple MarketStates</span>
</span><span id="AverMarket-165"><a href="#AverMarket-165"><span class="linenos">165</span></a>
</span><span id="AverMarket-166"><a href="#AverMarket-166"><span class="linenos">166</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-167"><a href="#AverMarket-167"><span class="linenos">167</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-168"><a href="#AverMarket-168"><span class="linenos">168</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="AverMarket-169"><a href="#AverMarket-169"><span class="linenos">169</span></a>
</span><span id="AverMarket-170"><a href="#AverMarket-170"><span class="linenos">170</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-171"><a href="#AverMarket-171"><span class="linenos">171</span></a><span class="sd">            list[MarketState]: List of MarketState objects</span>
</span><span id="AverMarket-172"><a href="#AverMarket-172"><span class="linenos">172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-173"><a href="#AverMarket-173"><span class="linenos">173</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch_multiple</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">)</span>
</span><span id="AverMarket-174"><a href="#AverMarket-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="AverMarket-175"><a href="#AverMarket-175"><span class="linenos">175</span></a>   
</span><span id="AverMarket-176"><a href="#AverMarket-176"><span class="linenos">176</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-177"><a href="#AverMarket-177"><span class="linenos">177</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_state_and_store</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">):</span>
</span><span id="AverMarket-178"><a href="#AverMarket-178"><span class="linenos">178</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-179"><a href="#AverMarket-179"><span class="linenos">179</span></a><span class="sd">        Loads onchain data for multiple MarketStates and MarketStoreStates at once</span>
</span><span id="AverMarket-180"><a href="#AverMarket-180"><span class="linenos">180</span></a>
</span><span id="AverMarket-181"><a href="#AverMarket-181"><span class="linenos">181</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-182"><a href="#AverMarket-182"><span class="linenos">182</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-183"><a href="#AverMarket-183"><span class="linenos">183</span></a><span class="sd">            market_pubkey (PublicKey]: Market public key</span>
</span><span id="AverMarket-184"><a href="#AverMarket-184"><span class="linenos">184</span></a>
</span><span id="AverMarket-185"><a href="#AverMarket-185"><span class="linenos">185</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-186"><a href="#AverMarket-186"><span class="linenos">186</span></a><span class="sd">            dict[str, list[MarketState] or list[MarketStoreState]]: Keys are market_states or market_stores</span>
</span><span id="AverMarket-187"><a href="#AverMarket-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-188"><a href="#AverMarket-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="p">[</span><span class="n">market_pubkey</span><span class="p">])</span>
</span><span id="AverMarket-189"><a href="#AverMarket-189"><span class="linenos">189</span></a>
</span><span id="AverMarket-190"><a href="#AverMarket-190"><span class="linenos">190</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-191"><a href="#AverMarket-191"><span class="linenos">191</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">]):</span>
</span><span id="AverMarket-192"><a href="#AverMarket-192"><span class="linenos">192</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-193"><a href="#AverMarket-193"><span class="linenos">193</span></a><span class="sd">        Loads onchain data for multiple MarketStates and MarketStoreStates at once</span>
</span><span id="AverMarket-194"><a href="#AverMarket-194"><span class="linenos">194</span></a>
</span><span id="AverMarket-195"><a href="#AverMarket-195"><span class="linenos">195</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-196"><a href="#AverMarket-196"><span class="linenos">196</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-197"><a href="#AverMarket-197"><span class="linenos">197</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="AverMarket-198"><a href="#AverMarket-198"><span class="linenos">198</span></a>
</span><span id="AverMarket-199"><a href="#AverMarket-199"><span class="linenos">199</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-200"><a href="#AverMarket-200"><span class="linenos">200</span></a><span class="sd">            dict[str, list[MarketState] or list[MarketStoreState]]: Keys are market_states or market_stores</span>
</span><span id="AverMarket-201"><a href="#AverMarket-201"><span class="linenos">201</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-202"><a href="#AverMarket-202"><span class="linenos">202</span></a>        <span class="n">market_store_pubkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">AverMarket</span><span class="o">.</span><span class="n">derive_market_store_pubkey_and_bump</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">market_pubkeys</span><span class="p">]</span>
</span><span id="AverMarket-203"><a href="#AverMarket-203"><span class="linenos">203</span></a>
</span><span id="AverMarket-204"><a href="#AverMarket-204"><span class="linenos">204</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_multiple_bytes_data</span><span class="p">(</span><span class="n">aver_client</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">market_pubkeys</span> <span class="o">+</span> <span class="n">market_store_pubkeys</span><span class="p">)</span>
</span><span id="AverMarket-205"><a href="#AverMarket-205"><span class="linenos">205</span></a>        <span class="n">market_states_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">)]</span>
</span><span id="AverMarket-206"><a href="#AverMarket-206"><span class="linenos">206</span></a>        <span class="n">market_stores_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):]</span>
</span><span id="AverMarket-207"><a href="#AverMarket-207"><span class="linenos">207</span></a>
</span><span id="AverMarket-208"><a href="#AverMarket-208"><span class="linenos">208</span></a>        <span class="n">market_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">parse_market_state</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">aver_client</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">market_states_data</span><span class="p">]</span>
</span><span id="AverMarket-209"><a href="#AverMarket-209"><span class="linenos">209</span></a>        <span class="n">market_stores</span> <span class="o">=</span> <span class="p">[</span><span class="n">parse_market_store</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">aver_client</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">market_stores_data</span><span class="p">]</span>
</span><span id="AverMarket-210"><a href="#AverMarket-210"><span class="linenos">210</span></a>
</span><span id="AverMarket-211"><a href="#AverMarket-211"><span class="linenos">211</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;market_states&#39;</span><span class="p">:</span> <span class="n">market_states</span><span class="p">,</span> <span class="s1">&#39;market_stores&#39;</span><span class="p">:</span> <span class="n">market_stores</span><span class="p">}</span>
</span><span id="AverMarket-212"><a href="#AverMarket-212"><span class="linenos">212</span></a>
</span><span id="AverMarket-213"><a href="#AverMarket-213"><span class="linenos">213</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-214"><a href="#AverMarket-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">derive_market_store_pubkey_and_bump</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span> <span class="n">program_id</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">):</span>
</span><span id="AverMarket-215"><a href="#AverMarket-215"><span class="linenos">215</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-216"><a href="#AverMarket-216"><span class="linenos">216</span></a><span class="sd">        Derives PDA (Program Derived Account) for MarketStore public key.</span>
</span><span id="AverMarket-217"><a href="#AverMarket-217"><span class="linenos">217</span></a><span class="sd">        MarketStore account addresses are derived deterministically using the market&#39;s pubkey.</span>
</span><span id="AverMarket-218"><a href="#AverMarket-218"><span class="linenos">218</span></a>
</span><span id="AverMarket-219"><a href="#AverMarket-219"><span class="linenos">219</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-220"><a href="#AverMarket-220"><span class="linenos">220</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="AverMarket-221"><a href="#AverMarket-221"><span class="linenos">221</span></a><span class="sd">            program_id (PublicKey, optional): Program public key. Defaults to AVER_PROGRAM_ID.</span>
</span><span id="AverMarket-222"><a href="#AverMarket-222"><span class="linenos">222</span></a>
</span><span id="AverMarket-223"><a href="#AverMarket-223"><span class="linenos">223</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-224"><a href="#AverMarket-224"><span class="linenos">224</span></a><span class="sd">            PublicKey: MarketStore public key</span>
</span><span id="AverMarket-225"><a href="#AverMarket-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-226"><a href="#AverMarket-226"><span class="linenos">226</span></a>        <span class="k">return</span> <span class="n">PublicKey</span><span class="o">.</span><span class="n">find_program_address</span><span class="p">(</span>
</span><span id="AverMarket-227"><a href="#AverMarket-227"><span class="linenos">227</span></a>            <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;market-store&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">)],</span> 
</span><span id="AverMarket-228"><a href="#AverMarket-228"><span class="linenos">228</span></a>            <span class="n">program_id</span>
</span><span id="AverMarket-229"><a href="#AverMarket-229"><span class="linenos">229</span></a>        <span class="p">)</span>
</span><span id="AverMarket-230"><a href="#AverMarket-230"><span class="linenos">230</span></a>
</span><span id="AverMarket-231"><a href="#AverMarket-231"><span class="linenos">231</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-232"><a href="#AverMarket-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">get_markets_from_account_states</span><span class="p">(</span>
</span><span id="AverMarket-233"><a href="#AverMarket-233"><span class="linenos">233</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span>
</span><span id="AverMarket-234"><a href="#AverMarket-234"><span class="linenos">234</span></a>        <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span> 
</span><span id="AverMarket-235"><a href="#AverMarket-235"><span class="linenos">235</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">],</span> 
</span><span id="AverMarket-236"><a href="#AverMarket-236"><span class="linenos">236</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">],</span>
</span><span id="AverMarket-237"><a href="#AverMarket-237"><span class="linenos">237</span></a>        <span class="n">slabs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Slab</span><span class="p">],</span>
</span><span id="AverMarket-238"><a href="#AverMarket-238"><span class="linenos">238</span></a>        <span class="p">):</span>
</span><span id="AverMarket-239"><a href="#AverMarket-239"><span class="linenos">239</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-240"><a href="#AverMarket-240"><span class="linenos">240</span></a><span class="sd">        Returns multiple AverMarket objects from their respective MarketStates, stores and orderbook objects</span>
</span><span id="AverMarket-241"><a href="#AverMarket-241"><span class="linenos">241</span></a>
</span><span id="AverMarket-242"><a href="#AverMarket-242"><span class="linenos">242</span></a><span class="sd">        Used in refresh.py</span>
</span><span id="AverMarket-243"><a href="#AverMarket-243"><span class="linenos">243</span></a>
</span><span id="AverMarket-244"><a href="#AverMarket-244"><span class="linenos">244</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-245"><a href="#AverMarket-245"><span class="linenos">245</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-246"><a href="#AverMarket-246"><span class="linenos">246</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="AverMarket-247"><a href="#AverMarket-247"><span class="linenos">247</span></a><span class="sd">            market_states (list[MarketState]): List of MarketState objects</span>
</span><span id="AverMarket-248"><a href="#AverMarket-248"><span class="linenos">248</span></a><span class="sd">            market_stores (list[MarketStoreState]): List of MarketStoreState objects</span>
</span><span id="AverMarket-249"><a href="#AverMarket-249"><span class="linenos">249</span></a><span class="sd">            slabs (list[Slab]): List of slab objects (used in orderbooks)</span>
</span><span id="AverMarket-250"><a href="#AverMarket-250"><span class="linenos">250</span></a>
</span><span id="AverMarket-251"><a href="#AverMarket-251"><span class="linenos">251</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-252"><a href="#AverMarket-252"><span class="linenos">252</span></a><span class="sd">            lst[AverMarket]: List of AverMarket objects</span>
</span><span id="AverMarket-253"><a href="#AverMarket-253"><span class="linenos">253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-254"><a href="#AverMarket-254"><span class="linenos">254</span></a>        <span class="n">slab_position_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AverMarket-255"><a href="#AverMarket-255"><span class="linenos">255</span></a>        <span class="n">all_orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-256"><a href="#AverMarket-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">market_store</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_stores</span><span class="p">):</span>
</span><span id="AverMarket-257"><a href="#AverMarket-257"><span class="linenos">257</span></a>            <span class="n">all_orderbooks_for_market</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-258"><a href="#AverMarket-258"><span class="linenos">258</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">market_store</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AverMarket-259"><a href="#AverMarket-259"><span class="linenos">259</span></a>                <span class="n">all_orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="AverMarket-260"><a href="#AverMarket-260"><span class="linenos">260</span></a>                <span class="k">continue</span>
</span><span id="AverMarket-261"><a href="#AverMarket-261"><span class="linenos">261</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">orderbook</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">):</span>
</span><span id="AverMarket-262"><a href="#AverMarket-262"><span class="linenos">262</span></a>                <span class="n">orderbook</span> <span class="o">=</span> <span class="n">Orderbook</span><span class="p">(</span>
</span><span id="AverMarket-263"><a href="#AverMarket-263"><span class="linenos">263</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span> 
</span><span id="AverMarket-264"><a href="#AverMarket-264"><span class="linenos">264</span></a>                    <span class="n">slabs</span><span class="p">[</span><span class="n">slab_position_counter</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="AverMarket-265"><a href="#AverMarket-265"><span class="linenos">265</span></a>                    <span class="n">slabs</span><span class="p">[</span><span class="n">slab_position_counter</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="AverMarket-266"><a href="#AverMarket-266"><span class="linenos">266</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">bids</span><span class="p">,</span>
</span><span id="AverMarket-267"><a href="#AverMarket-267"><span class="linenos">267</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">asks</span><span class="p">,</span>
</span><span id="AverMarket-268"><a href="#AverMarket-268"><span class="linenos">268</span></a>                    <span class="n">market_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">decimals</span>
</span><span id="AverMarket-269"><a href="#AverMarket-269"><span class="linenos">269</span></a>                    <span class="p">)</span>
</span><span id="AverMarket-270"><a href="#AverMarket-270"><span class="linenos">270</span></a>                <span class="n">all_orderbooks_for_market</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbook</span><span class="p">)</span>
</span><span id="AverMarket-271"><a href="#AverMarket-271"><span class="linenos">271</span></a>            <span class="n">slab_position_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="AverMarket-272"><a href="#AverMarket-272"><span class="linenos">272</span></a>            <span class="n">all_orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks_for_market</span><span class="p">)</span>
</span><span id="AverMarket-273"><a href="#AverMarket-273"><span class="linenos">273</span></a>        
</span><span id="AverMarket-274"><a href="#AverMarket-274"><span class="linenos">274</span></a>        <span class="n">markets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AverMarket</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-275"><a href="#AverMarket-275"><span class="linenos">275</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):</span>
</span><span id="AverMarket-276"><a href="#AverMarket-276"><span class="linenos">276</span></a>            <span class="n">markets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AverMarket</span><span class="p">(</span>
</span><span id="AverMarket-277"><a href="#AverMarket-277"><span class="linenos">277</span></a>                <span class="n">aver_client</span><span class="p">,</span> 
</span><span id="AverMarket-278"><a href="#AverMarket-278"><span class="linenos">278</span></a>                <span class="n">m</span><span class="p">,</span> 
</span><span id="AverMarket-279"><a href="#AverMarket-279"><span class="linenos">279</span></a>                <span class="n">market_states</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="AverMarket-280"><a href="#AverMarket-280"><span class="linenos">280</span></a>                <span class="n">market_stores</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="AverMarket-281"><a href="#AverMarket-281"><span class="linenos">281</span></a>                <span class="n">all_orderbooks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AverMarket-282"><a href="#AverMarket-282"><span class="linenos">282</span></a>                <span class="p">)</span>
</span><span id="AverMarket-283"><a href="#AverMarket-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="AverMarket-284"><a href="#AverMarket-284"><span class="linenos">284</span></a>
</span><span id="AverMarket-285"><a href="#AverMarket-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="n">markets</span>
</span><span id="AverMarket-286"><a href="#AverMarket-286"><span class="linenos">286</span></a>
</span><span id="AverMarket-287"><a href="#AverMarket-287"><span class="linenos">287</span></a>
</span><span id="AverMarket-288"><a href="#AverMarket-288"><span class="linenos">288</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-289"><a href="#AverMarket-289"><span class="linenos">289</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_store_state</span><span class="p">(</span>
</span><span id="AverMarket-290"><a href="#AverMarket-290"><span class="linenos">290</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="AverMarket-291"><a href="#AverMarket-291"><span class="linenos">291</span></a>        <span class="n">is_market_status_closed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="AverMarket-292"><a href="#AverMarket-292"><span class="linenos">292</span></a>        <span class="n">market_store_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span> 
</span><span id="AverMarket-293"><a href="#AverMarket-293"><span class="linenos">293</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketStoreState</span><span class="p">:</span>
</span><span id="AverMarket-294"><a href="#AverMarket-294"><span class="linenos">294</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-295"><a href="#AverMarket-295"><span class="linenos">295</span></a><span class="sd">        Loads onchain data for a MarketStore State</span>
</span><span id="AverMarket-296"><a href="#AverMarket-296"><span class="linenos">296</span></a>
</span><span id="AverMarket-297"><a href="#AverMarket-297"><span class="linenos">297</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-298"><a href="#AverMarket-298"><span class="linenos">298</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-299"><a href="#AverMarket-299"><span class="linenos">299</span></a><span class="sd">            is_market_status_closed (bool): True if market status is closed, voided or resolved</span>
</span><span id="AverMarket-300"><a href="#AverMarket-300"><span class="linenos">300</span></a><span class="sd">            market_store_pubkey (PublicKey): MarketStore public key</span>
</span><span id="AverMarket-301"><a href="#AverMarket-301"><span class="linenos">301</span></a>
</span><span id="AverMarket-302"><a href="#AverMarket-302"><span class="linenos">302</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-303"><a href="#AverMarket-303"><span class="linenos">303</span></a><span class="sd">            MarketStoreState: MarketStoreStateobject</span>
</span><span id="AverMarket-304"><a href="#AverMarket-304"><span class="linenos">304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-305"><a href="#AverMarket-305"><span class="linenos">305</span></a>        <span class="c1">#Closed markets do not have orderbooks</span>
</span><span id="AverMarket-306"><a href="#AverMarket-306"><span class="linenos">306</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">is_market_status_closed</span><span class="p">):</span>
</span><span id="AverMarket-307"><a href="#AverMarket-307"><span class="linenos">307</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="AverMarket-308"><a href="#AverMarket-308"><span class="linenos">308</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;MarketStore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">market_store_pubkey</span><span class="p">)</span>
</span><span id="AverMarket-309"><a href="#AverMarket-309"><span class="linenos">309</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="AverMarket-310"><a href="#AverMarket-310"><span class="linenos">310</span></a>
</span><span id="AverMarket-311"><a href="#AverMarket-311"><span class="linenos">311</span></a>
</span><span id="AverMarket-312"><a href="#AverMarket-312"><span class="linenos">312</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-313"><a href="#AverMarket-313"><span class="linenos">313</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_store_states</span><span class="p">(</span>
</span><span id="AverMarket-314"><a href="#AverMarket-314"><span class="linenos">314</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="AverMarket-315"><a href="#AverMarket-315"><span class="linenos">315</span></a>        <span class="n">market_store_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span> 
</span><span id="AverMarket-316"><a href="#AverMarket-316"><span class="linenos">316</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">]:</span>
</span><span id="AverMarket-317"><a href="#AverMarket-317"><span class="linenos">317</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-318"><a href="#AverMarket-318"><span class="linenos">318</span></a><span class="sd">        Loads onchain data for multiple MarketStore States</span>
</span><span id="AverMarket-319"><a href="#AverMarket-319"><span class="linenos">319</span></a>
</span><span id="AverMarket-320"><a href="#AverMarket-320"><span class="linenos">320</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-321"><a href="#AverMarket-321"><span class="linenos">321</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket-322"><a href="#AverMarket-322"><span class="linenos">322</span></a><span class="sd">            market_store_pubkeys (list[PublicKey]): List of MarketStore public keys</span>
</span><span id="AverMarket-323"><a href="#AverMarket-323"><span class="linenos">323</span></a>
</span><span id="AverMarket-324"><a href="#AverMarket-324"><span class="linenos">324</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-325"><a href="#AverMarket-325"><span class="linenos">325</span></a><span class="sd">            list[MarketStoreState]: List of MarketStore public keys</span>
</span><span id="AverMarket-326"><a href="#AverMarket-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-327"><a href="#AverMarket-327"><span class="linenos">327</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;MarketStore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch_multiple</span><span class="p">(</span><span class="n">market_store_pubkeys</span><span class="p">)</span>
</span><span id="AverMarket-328"><a href="#AverMarket-328"><span class="linenos">328</span></a>        <span class="k">return</span> <span class="n">res</span>       
</span><span id="AverMarket-329"><a href="#AverMarket-329"><span class="linenos">329</span></a>
</span><span id="AverMarket-330"><a href="#AverMarket-330"><span class="linenos">330</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-331"><a href="#AverMarket-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="nf">is_market_status_closed</span><span class="p">(</span><span class="n">market_status</span><span class="p">:</span> <span class="n">MarketStatus</span><span class="p">):</span>
</span><span id="AverMarket-332"><a href="#AverMarket-332"><span class="linenos">332</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-333"><a href="#AverMarket-333"><span class="linenos">333</span></a><span class="sd">        Checks if a market no longer in a trading status, and therefore will have no Orderbook or MarketStore accounts.</span>
</span><span id="AverMarket-334"><a href="#AverMarket-334"><span class="linenos">334</span></a><span class="sd">        Note: Once trading has ceased for a market, these accounts are closed.</span>
</span><span id="AverMarket-335"><a href="#AverMarket-335"><span class="linenos">335</span></a>
</span><span id="AverMarket-336"><a href="#AverMarket-336"><span class="linenos">336</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-337"><a href="#AverMarket-337"><span class="linenos">337</span></a><span class="sd">            market_status (MarketStatus): Market status (find in MarketState object)</span>
</span><span id="AverMarket-338"><a href="#AverMarket-338"><span class="linenos">338</span></a>
</span><span id="AverMarket-339"><a href="#AverMarket-339"><span class="linenos">339</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-340"><a href="#AverMarket-340"><span class="linenos">340</span></a><span class="sd">            bool: Market status closed</span>
</span><span id="AverMarket-341"><a href="#AverMarket-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-342"><a href="#AverMarket-342"><span class="linenos">342</span></a>        <span class="k">return</span> <span class="n">market_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MarketStatus</span><span class="o">.</span><span class="n">CEASED_CRANKED_CLOSED</span><span class="p">,</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">RESOLVED</span><span class="p">,</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">VOIDED</span><span class="p">]</span>
</span><span id="AverMarket-343"><a href="#AverMarket-343"><span class="linenos">343</span></a>
</span><span id="AverMarket-344"><a href="#AverMarket-344"><span class="linenos">344</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-345"><a href="#AverMarket-345"><span class="linenos">345</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span>
</span><span id="AverMarket-346"><a href="#AverMarket-346"><span class="linenos">346</span></a>        <span class="n">conn</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span> 
</span><span id="AverMarket-347"><a href="#AverMarket-347"><span class="linenos">347</span></a>        <span class="n">orderbook_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">OrderbookAccountsState</span><span class="p">],</span>
</span><span id="AverMarket-348"><a href="#AverMarket-348"><span class="linenos">348</span></a>        <span class="n">decimals_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="AverMarket-349"><a href="#AverMarket-349"><span class="linenos">349</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]:</span>
</span><span id="AverMarket-350"><a href="#AverMarket-350"><span class="linenos">350</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-351"><a href="#AverMarket-351"><span class="linenos">351</span></a><span class="sd">        Returns Orderbook objects from Orderbook Account objects, by fetching and parsing. </span>
</span><span id="AverMarket-352"><a href="#AverMarket-352"><span class="linenos">352</span></a>
</span><span id="AverMarket-353"><a href="#AverMarket-353"><span class="linenos">353</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-354"><a href="#AverMarket-354"><span class="linenos">354</span></a><span class="sd">            conn (AsyncClient): Solana AsyncClient object</span>
</span><span id="AverMarket-355"><a href="#AverMarket-355"><span class="linenos">355</span></a><span class="sd">            orderbook_accounts (list[OrderbookAccountsState]): List of orderbook account objects</span>
</span><span id="AverMarket-356"><a href="#AverMarket-356"><span class="linenos">356</span></a><span class="sd">            decimals_list (list[int]): List of decimal precision for each orderbook account state. Variable normally found in MarketState object</span>
</span><span id="AverMarket-357"><a href="#AverMarket-357"><span class="linenos">357</span></a>
</span><span id="AverMarket-358"><a href="#AverMarket-358"><span class="linenos">358</span></a><span class="sd">        Raises:</span>
</span><span id="AverMarket-359"><a href="#AverMarket-359"><span class="linenos">359</span></a><span class="sd">            Exception: Decimals list and orderbook accounts do not have the same length</span>
</span><span id="AverMarket-360"><a href="#AverMarket-360"><span class="linenos">360</span></a>
</span><span id="AverMarket-361"><a href="#AverMarket-361"><span class="linenos">361</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-362"><a href="#AverMarket-362"><span class="linenos">362</span></a><span class="sd">            list[Orderbook]: List of orderbook objects</span>
</span><span id="AverMarket-363"><a href="#AverMarket-363"><span class="linenos">363</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-364"><a href="#AverMarket-364"><span class="linenos">364</span></a>        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decimals_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orderbook_accounts</span><span class="p">)):</span>
</span><span id="AverMarket-365"><a href="#AverMarket-365"><span class="linenos">365</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;decimals_list and orderbook_accounts should have the same length&#39;</span><span class="p">)</span>
</span><span id="AverMarket-366"><a href="#AverMarket-366"><span class="linenos">366</span></a>        
</span><span id="AverMarket-367"><a href="#AverMarket-367"><span class="linenos">367</span></a>        <span class="n">all_bids_and_asks_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-368"><a href="#AverMarket-368"><span class="linenos">368</span></a>        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">orderbook_accounts</span><span class="p">:</span>
</span><span id="AverMarket-369"><a href="#AverMarket-369"><span class="linenos">369</span></a>            <span class="n">all_bids_and_asks_accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">bids</span><span class="p">)</span>
</span><span id="AverMarket-370"><a href="#AverMarket-370"><span class="linenos">370</span></a>            <span class="n">all_bids_and_asks_accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">asks</span><span class="p">)</span>
</span><span id="AverMarket-371"><a href="#AverMarket-371"><span class="linenos">371</span></a>
</span><span id="AverMarket-372"><a href="#AverMarket-372"><span class="linenos">372</span></a>        
</span><span id="AverMarket-373"><a href="#AverMarket-373"><span class="linenos">373</span></a>        <span class="n">all_slabs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Orderbook</span><span class="o">.</span><span class="n">load_multiple_slabs</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">all_bids_and_asks_accounts</span><span class="p">)</span>
</span><span id="AverMarket-374"><a href="#AverMarket-374"><span class="linenos">374</span></a>        <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-375"><a href="#AverMarket-375"><span class="linenos">375</span></a>
</span><span id="AverMarket-376"><a href="#AverMarket-376"><span class="linenos">376</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orderbook_accounts</span><span class="p">):</span>
</span><span id="AverMarket-377"><a href="#AverMarket-377"><span class="linenos">377</span></a>            <span class="n">orderbook</span> <span class="o">=</span> <span class="n">Orderbook</span><span class="p">(</span>
</span><span id="AverMarket-378"><a href="#AverMarket-378"><span class="linenos">378</span></a>                <span class="n">o</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span> 
</span><span id="AverMarket-379"><a href="#AverMarket-379"><span class="linenos">379</span></a>                <span class="n">all_slabs</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> 
</span><span id="AverMarket-380"><a href="#AverMarket-380"><span class="linenos">380</span></a>                <span class="n">all_slabs</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> 
</span><span id="AverMarket-381"><a href="#AverMarket-381"><span class="linenos">381</span></a>                <span class="n">o</span><span class="o">.</span><span class="n">bids</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">asks</span><span class="p">,</span>
</span><span id="AverMarket-382"><a href="#AverMarket-382"><span class="linenos">382</span></a>                <span class="n">decimals_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AverMarket-383"><a href="#AverMarket-383"><span class="linenos">383</span></a>                <span class="p">)</span>
</span><span id="AverMarket-384"><a href="#AverMarket-384"><span class="linenos">384</span></a>            <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbook</span><span class="p">)</span>
</span><span id="AverMarket-385"><a href="#AverMarket-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="n">orderbooks</span>
</span><span id="AverMarket-386"><a href="#AverMarket-386"><span class="linenos">386</span></a>
</span><span id="AverMarket-387"><a href="#AverMarket-387"><span class="linenos">387</span></a>
</span><span id="AverMarket-388"><a href="#AverMarket-388"><span class="linenos">388</span></a>
</span><span id="AverMarket-389"><a href="#AverMarket-389"><span class="linenos">389</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket-390"><a href="#AverMarket-390"><span class="linenos">390</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_orderbooks_from_orderbook_accounts_multiple_markets</span><span class="p">(</span>
</span><span id="AverMarket-391"><a href="#AverMarket-391"><span class="linenos">391</span></a>        <span class="n">conn</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span>
</span><span id="AverMarket-392"><a href="#AverMarket-392"><span class="linenos">392</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">],</span>
</span><span id="AverMarket-393"><a href="#AverMarket-393"><span class="linenos">393</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">],</span>
</span><span id="AverMarket-394"><a href="#AverMarket-394"><span class="linenos">394</span></a>        <span class="n">are_market_statuses_closed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="AverMarket-395"><a href="#AverMarket-395"><span class="linenos">395</span></a>    <span class="p">):</span>
</span><span id="AverMarket-396"><a href="#AverMarket-396"><span class="linenos">396</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-397"><a href="#AverMarket-397"><span class="linenos">397</span></a><span class="sd">        Returns Orderbook objects from MarketState and MarketStoreStateobjects,</span>
</span><span id="AverMarket-398"><a href="#AverMarket-398"><span class="linenos">398</span></a><span class="sd">        by fetching and parsing for multiple markets.</span>
</span><span id="AverMarket-399"><a href="#AverMarket-399"><span class="linenos">399</span></a>
</span><span id="AverMarket-400"><a href="#AverMarket-400"><span class="linenos">400</span></a><span class="sd">        Use when fetching orderbooks for multiple markets </span>
</span><span id="AverMarket-401"><a href="#AverMarket-401"><span class="linenos">401</span></a>
</span><span id="AverMarket-402"><a href="#AverMarket-402"><span class="linenos">402</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-403"><a href="#AverMarket-403"><span class="linenos">403</span></a><span class="sd">            conn (AsyncClient): Solana AsyncClient object</span>
</span><span id="AverMarket-404"><a href="#AverMarket-404"><span class="linenos">404</span></a><span class="sd">            market_states (list[MarketState]): List of MarketState objects</span>
</span><span id="AverMarket-405"><a href="#AverMarket-405"><span class="linenos">405</span></a><span class="sd">            market_stores (list[MarketStoreState]): List of MarketStoreStateobjects</span>
</span><span id="AverMarket-406"><a href="#AverMarket-406"><span class="linenos">406</span></a><span class="sd">            are_market_statuses_closed (list[bool]): Lists if each market is closed or not</span>
</span><span id="AverMarket-407"><a href="#AverMarket-407"><span class="linenos">407</span></a>
</span><span id="AverMarket-408"><a href="#AverMarket-408"><span class="linenos">408</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-409"><a href="#AverMarket-409"><span class="linenos">409</span></a><span class="sd">            list[list[Orderbook]]: List of orderbooks for each market</span>
</span><span id="AverMarket-410"><a href="#AverMarket-410"><span class="linenos">410</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-411"><a href="#AverMarket-411"><span class="linenos">411</span></a>        <span class="c1">#Create list of accounts and the decimals for each account</span>
</span><span id="AverMarket-412"><a href="#AverMarket-412"><span class="linenos">412</span></a>        <span class="n">orderbook_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-413"><a href="#AverMarket-413"><span class="linenos">413</span></a>        <span class="n">decimals_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-414"><a href="#AverMarket-414"><span class="linenos">414</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_store</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_stores</span><span class="p">):</span>
</span><span id="AverMarket-415"><a href="#AverMarket-415"><span class="linenos">415</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">market_store</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AverMarket-416"><a href="#AverMarket-416"><span class="linenos">416</span></a>                <span class="k">continue</span>
</span><span id="AverMarket-417"><a href="#AverMarket-417"><span class="linenos">417</span></a>            <span class="n">orderbook_accounts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span>
</span><span id="AverMarket-418"><a href="#AverMarket-418"><span class="linenos">418</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)):</span>
</span><span id="AverMarket-419"><a href="#AverMarket-419"><span class="linenos">419</span></a>                <span class="n">decimals_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market_states</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">decimals</span><span class="p">)</span>
</span><span id="AverMarket-420"><a href="#AverMarket-420"><span class="linenos">420</span></a>        
</span><span id="AverMarket-421"><a href="#AverMarket-421"><span class="linenos">421</span></a>        <span class="c1">#Load all orderbooks</span>
</span><span id="AverMarket-422"><a href="#AverMarket-422"><span class="linenos">422</span></a>        <span class="n">all_orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">orderbook_accounts</span><span class="p">,</span> <span class="n">decimals_list</span><span class="p">)</span>
</span><span id="AverMarket-423"><a href="#AverMarket-423"><span class="linenos">423</span></a>        <span class="n">orderbooks_market_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-424"><a href="#AverMarket-424"><span class="linenos">424</span></a>
</span><span id="AverMarket-425"><a href="#AverMarket-425"><span class="linenos">425</span></a>        <span class="c1">#Create a list for each market we received. The list contains all orderbooks for that market</span>
</span><span id="AverMarket-426"><a href="#AverMarket-426"><span class="linenos">426</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_states</span><span class="p">):</span>
</span><span id="AverMarket-427"><a href="#AverMarket-427"><span class="linenos">427</span></a>            <span class="n">number_of_outcomes</span> <span class="o">=</span> <span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span>
</span><span id="AverMarket-428"><a href="#AverMarket-428"><span class="linenos">428</span></a>            <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-429"><a href="#AverMarket-429"><span class="linenos">429</span></a>            <span class="c1">#Market is closed</span>
</span><span id="AverMarket-430"><a href="#AverMarket-430"><span class="linenos">430</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">are_market_statuses_closed</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
</span><span id="AverMarket-431"><a href="#AverMarket-431"><span class="linenos">431</span></a>                <span class="n">orderbooks_market_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="AverMarket-432"><a href="#AverMarket-432"><span class="linenos">432</span></a>                <span class="k">continue</span>
</span><span id="AverMarket-433"><a href="#AverMarket-433"><span class="linenos">433</span></a>            <span class="c1">#Binary markets only have 1 orderbook</span>
</span><span id="AverMarket-434"><a href="#AverMarket-434"><span class="linenos">434</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="AverMarket-435"><a href="#AverMarket-435"><span class="linenos">435</span></a>                <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="AverMarket-436"><a href="#AverMarket-436"><span class="linenos">436</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AverMarket-437"><a href="#AverMarket-437"><span class="linenos">437</span></a>                <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-438"><a href="#AverMarket-438"><span class="linenos">438</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_outcomes</span><span class="p">):</span>
</span><span id="AverMarket-439"><a href="#AverMarket-439"><span class="linenos">439</span></a>                    <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="AverMarket-440"><a href="#AverMarket-440"><span class="linenos">440</span></a>            <span class="n">orderbooks_market_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">)</span>
</span><span id="AverMarket-441"><a href="#AverMarket-441"><span class="linenos">441</span></a>        
</span><span id="AverMarket-442"><a href="#AverMarket-442"><span class="linenos">442</span></a>        <span class="k">return</span> <span class="n">orderbooks_market_list</span>
</span><span id="AverMarket-443"><a href="#AverMarket-443"><span class="linenos">443</span></a>
</span><span id="AverMarket-444"><a href="#AverMarket-444"><span class="linenos">444</span></a>    
</span><span id="AverMarket-445"><a href="#AverMarket-445"><span class="linenos">445</span></a>    <span class="k">def</span> <span class="nf">make_sweep_fees_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AverMarket-446"><a href="#AverMarket-446"><span class="linenos">446</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-447"><a href="#AverMarket-447"><span class="linenos">447</span></a><span class="sd">        Creates instruction to sweeps fees and sends to relevant accounts</span>
</span><span id="AverMarket-448"><a href="#AverMarket-448"><span class="linenos">448</span></a>
</span><span id="AverMarket-449"><a href="#AverMarket-449"><span class="linenos">449</span></a><span class="sd">        Returns TransactionInstruction object only. Does not send transaction.</span>
</span><span id="AverMarket-450"><a href="#AverMarket-450"><span class="linenos">450</span></a>
</span><span id="AverMarket-451"><a href="#AverMarket-451"><span class="linenos">451</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-452"><a href="#AverMarket-452"><span class="linenos">452</span></a><span class="sd">            TransactionInstruction: TransactionInstruction object</span>
</span><span id="AverMarket-453"><a href="#AverMarket-453"><span class="linenos">453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-454"><a href="#AverMarket-454"><span class="linenos">454</span></a>        <span class="n">quote_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">quote_token</span>
</span><span id="AverMarket-455"><a href="#AverMarket-455"><span class="linenos">455</span></a>        <span class="n">third_party_vault_authority</span><span class="p">,</span> <span class="n">bump</span> <span class="o">=</span> <span class="n">PublicKey</span><span class="o">.</span><span class="n">find_program_address</span><span class="p">(</span>
</span><span id="AverMarket-456"><a href="#AverMarket-456"><span class="linenos">456</span></a>            <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;third-party-token-vault&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">quote_token</span><span class="p">)],</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">)</span>
</span><span id="AverMarket-457"><a href="#AverMarket-457"><span class="linenos">457</span></a>
</span><span id="AverMarket-458"><a href="#AverMarket-458"><span class="linenos">458</span></a>        <span class="n">third_party_vault_token_account</span> <span class="o">=</span> <span class="n">get_associated_token_address</span><span class="p">(</span>
</span><span id="AverMarket-459"><a href="#AverMarket-459"><span class="linenos">459</span></a>            <span class="n">third_party_vault_authority</span><span class="p">,</span> <span class="n">quote_token</span><span class="p">)</span>
</span><span id="AverMarket-460"><a href="#AverMarket-460"><span class="linenos">460</span></a>
</span><span id="AverMarket-461"><a href="#AverMarket-461"><span class="linenos">461</span></a>        <span class="n">aver_quote_token_account</span> <span class="o">=</span> <span class="n">get_associated_token_address</span><span class="p">(</span>
</span><span id="AverMarket-462"><a href="#AverMarket-462"><span class="linenos">462</span></a>            <span class="n">AVER_MARKET_AUTHORITY</span><span class="p">,</span> <span class="n">quote_token</span>
</span><span id="AverMarket-463"><a href="#AverMarket-463"><span class="linenos">463</span></a>        <span class="p">)</span>
</span><span id="AverMarket-464"><a href="#AverMarket-464"><span class="linenos">464</span></a>
</span><span id="AverMarket-465"><a href="#AverMarket-465"><span class="linenos">465</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">instruction</span><span class="p">[</span><span class="s2">&quot;sweep_fees&quot;</span><span class="p">](</span>
</span><span id="AverMarket-466"><a href="#AverMarket-466"><span class="linenos">466</span></a>            <span class="n">ctx</span><span class="o">=</span><span class="n">Context</span><span class="p">(</span>
</span><span id="AverMarket-467"><a href="#AverMarket-467"><span class="linenos">467</span></a>                <span class="n">accounts</span><span class="o">=</span><span class="p">{</span>
</span><span id="AverMarket-468"><a href="#AverMarket-468"><span class="linenos">468</span></a>                    <span class="s2">&quot;market&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="AverMarket-469"><a href="#AverMarket-469"><span class="linenos">469</span></a>                    <span class="s2">&quot;quote_vault&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">quote_vault</span><span class="p">,</span>
</span><span id="AverMarket-470"><a href="#AverMarket-470"><span class="linenos">470</span></a>                    <span class="s2">&quot;vault_authority&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">vault_authority</span><span class="p">,</span>
</span><span id="AverMarket-471"><a href="#AverMarket-471"><span class="linenos">471</span></a>                    <span class="s2">&quot;third_party_token_vault&quot;</span><span class="p">:</span> <span class="n">third_party_vault_token_account</span><span class="p">,</span>
</span><span id="AverMarket-472"><a href="#AverMarket-472"><span class="linenos">472</span></a>                    <span class="s2">&quot;aver_quote_token_account&quot;</span><span class="p">:</span> <span class="n">aver_quote_token_account</span><span class="p">,</span>
</span><span id="AverMarket-473"><a href="#AverMarket-473"><span class="linenos">473</span></a>                    <span class="s2">&quot;spl_token_program&quot;</span><span class="p">:</span> <span class="n">TOKEN_PROGRAM_ID</span><span class="p">,</span>
</span><span id="AverMarket-474"><a href="#AverMarket-474"><span class="linenos">474</span></a>                <span class="p">},</span>
</span><span id="AverMarket-475"><a href="#AverMarket-475"><span class="linenos">475</span></a>                <span class="n">signers</span><span class="o">=</span><span class="p">[],</span>
</span><span id="AverMarket-476"><a href="#AverMarket-476"><span class="linenos">476</span></a>            <span class="p">),</span>
</span><span id="AverMarket-477"><a href="#AverMarket-477"><span class="linenos">477</span></a>        <span class="p">)</span>
</span><span id="AverMarket-478"><a href="#AverMarket-478"><span class="linenos">478</span></a>    
</span><span id="AverMarket-479"><a href="#AverMarket-479"><span class="linenos">479</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">sweep_fees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fee_payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">send_options</span><span class="p">:</span> <span class="n">TxOpts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,):</span>
</span><span id="AverMarket-480"><a href="#AverMarket-480"><span class="linenos">480</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-481"><a href="#AverMarket-481"><span class="linenos">481</span></a><span class="sd">        Sweeps fees and sends to relevant accounts</span>
</span><span id="AverMarket-482"><a href="#AverMarket-482"><span class="linenos">482</span></a>
</span><span id="AverMarket-483"><a href="#AverMarket-483"><span class="linenos">483</span></a><span class="sd">        Sends instructions on chain</span>
</span><span id="AverMarket-484"><a href="#AverMarket-484"><span class="linenos">484</span></a>
</span><span id="AverMarket-485"><a href="#AverMarket-485"><span class="linenos">485</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-486"><a href="#AverMarket-486"><span class="linenos">486</span></a><span class="sd">            fee_payer (Keypair): Pays transaction fees. Defaults to AverClient wallet</span>
</span><span id="AverMarket-487"><a href="#AverMarket-487"><span class="linenos">487</span></a><span class="sd">            send_options (TxOpts, optional): Options to specify when broadcasting a transaction. Defaults to None.</span>
</span><span id="AverMarket-488"><a href="#AverMarket-488"><span class="linenos">488</span></a>
</span><span id="AverMarket-489"><a href="#AverMarket-489"><span class="linenos">489</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-490"><a href="#AverMarket-490"><span class="linenos">490</span></a><span class="sd">            RPCResponse: Response</span>
</span><span id="AverMarket-491"><a href="#AverMarket-491"><span class="linenos">491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-492"><a href="#AverMarket-492"><span class="linenos">492</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">fee_payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AverMarket-493"><a href="#AverMarket-493"><span class="linenos">493</span></a>            <span class="n">fee_payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="AverMarket-494"><a href="#AverMarket-494"><span class="linenos">494</span></a>
</span><span id="AverMarket-495"><a href="#AverMarket-495"><span class="linenos">495</span></a>        <span class="n">ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_sweep_fees_instruction</span><span class="p">()</span>
</span><span id="AverMarket-496"><a href="#AverMarket-496"><span class="linenos">496</span></a>
</span><span id="AverMarket-497"><a href="#AverMarket-497"><span class="linenos">497</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">sign_and_send_transaction_instructions</span><span class="p">(</span>
</span><span id="AverMarket-498"><a href="#AverMarket-498"><span class="linenos">498</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="p">,</span>
</span><span id="AverMarket-499"><a href="#AverMarket-499"><span class="linenos">499</span></a>            <span class="p">[],</span>
</span><span id="AverMarket-500"><a href="#AverMarket-500"><span class="linenos">500</span></a>            <span class="n">fee_payer</span><span class="p">,</span>
</span><span id="AverMarket-501"><a href="#AverMarket-501"><span class="linenos">501</span></a>            <span class="p">[</span><span class="n">ix</span><span class="p">],</span>
</span><span id="AverMarket-502"><a href="#AverMarket-502"><span class="linenos">502</span></a>            <span class="n">send_options</span>
</span><span id="AverMarket-503"><a href="#AverMarket-503"><span class="linenos">503</span></a>        <span class="p">)</span>
</span><span id="AverMarket-504"><a href="#AverMarket-504"><span class="linenos">504</span></a>
</span><span id="AverMarket-505"><a href="#AverMarket-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="nf">list_all_pubkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AverMarket-506"><a href="#AverMarket-506"><span class="linenos">506</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-507"><a href="#AverMarket-507"><span class="linenos">507</span></a><span class="sd">        Returns all pubkeys used in AverMarket object</span>
</span><span id="AverMarket-508"><a href="#AverMarket-508"><span class="linenos">508</span></a>
</span><span id="AverMarket-509"><a href="#AverMarket-509"><span class="linenos">509</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-510"><a href="#AverMarket-510"><span class="linenos">510</span></a><span class="sd">            list[PublicKey]: List of public keys</span>
</span><span id="AverMarket-511"><a href="#AverMarket-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-512"><a href="#AverMarket-512"><span class="linenos">512</span></a>        <span class="n">list_of_pubkeys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">quote_vault</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">oracle_feed</span><span class="p">]</span>
</span><span id="AverMarket-513"><a href="#AverMarket-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">:</span>
</span><span id="AverMarket-514"><a href="#AverMarket-514"><span class="linenos">514</span></a>            <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderbooks</span><span class="p">:</span>
</span><span id="AverMarket-515"><a href="#AverMarket-515"><span class="linenos">515</span></a>                <span class="n">list_of_pubkeys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ob</span><span class="o">.</span><span class="n">pubkey</span><span class="p">,</span> <span class="n">ob</span><span class="o">.</span><span class="n">slab_asks_pubkey</span><span class="p">,</span> <span class="n">ob</span><span class="o">.</span><span class="n">slab_asks_pubkey</span><span class="p">]</span>
</span><span id="AverMarket-516"><a href="#AverMarket-516"><span class="linenos">516</span></a>        <span class="k">return</span> <span class="n">list_of_pubkeys</span>
</span><span id="AverMarket-517"><a href="#AverMarket-517"><span class="linenos">517</span></a>    
</span><span id="AverMarket-518"><a href="#AverMarket-518"><span class="linenos">518</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_implied_market_status</span><span class="p">(</span>
</span><span id="AverMarket-519"><a href="#AverMarket-519"><span class="linenos">519</span></a>            <span class="bp">self</span>
</span><span id="AverMarket-520"><a href="#AverMarket-520"><span class="linenos">520</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketStatus</span><span class="p">:</span>
</span><span id="AverMarket-521"><a href="#AverMarket-521"><span class="linenos">521</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-522"><a href="#AverMarket-522"><span class="linenos">522</span></a><span class="sd">        Returns what we believe the market status ought to be (rather than what is stored in the market&#39;s state on-chain)</span>
</span><span id="AverMarket-523"><a href="#AverMarket-523"><span class="linenos">523</span></a>
</span><span id="AverMarket-524"><a href="#AverMarket-524"><span class="linenos">524</span></a><span class="sd">        Note: As a fail safe, markets have specified times beyond which the market will react as if it is in another Status until it is formally cranked to that Status.</span>
</span><span id="AverMarket-525"><a href="#AverMarket-525"><span class="linenos">525</span></a><span class="sd">        For example, if Solana were to have issues and it was not possible for the market&#39;s authority to crank it into In-Play status or to Cease Trading in time,</span>
</span><span id="AverMarket-526"><a href="#AverMarket-526"><span class="linenos">526</span></a><span class="sd">        the market would use the System Time as a trigger to treat new requests as if it were in the later Status.</span>
</span><span id="AverMarket-527"><a href="#AverMarket-527"><span class="linenos">527</span></a>
</span><span id="AverMarket-528"><a href="#AverMarket-528"><span class="linenos">528</span></a><span class="sd">        If Solana clock time is beyond TradingCeaseTime, market is TradingCeased</span>
</span><span id="AverMarket-529"><a href="#AverMarket-529"><span class="linenos">529</span></a><span class="sd">        If Solana clock time is beyond InPlayStartTime but before TradingCeaseTime, market is ActiveInPlay</span>
</span><span id="AverMarket-530"><a href="#AverMarket-530"><span class="linenos">530</span></a>
</span><span id="AverMarket-531"><a href="#AverMarket-531"><span class="linenos">531</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-532"><a href="#AverMarket-532"><span class="linenos">532</span></a><span class="sd">            MarketStatus: Implied market status</span>
</span><span id="AverMarket-533"><a href="#AverMarket-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-534"><a href="#AverMarket-534"><span class="linenos">534</span></a>        <span class="n">solana_datetime</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">get_system_clock_datetime</span><span class="p">()</span>
</span><span id="AverMarket-535"><a href="#AverMarket-535"><span class="linenos">535</span></a>        <span class="k">if</span> <span class="n">solana_datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">trading_cease_time</span><span class="p">:</span>
</span><span id="AverMarket-536"><a href="#AverMarket-536"><span class="linenos">536</span></a>            <span class="k">return</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">TRADING_CEASED</span>
</span><span id="AverMarket-537"><a href="#AverMarket-537"><span class="linenos">537</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">inplay_start_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">solana_datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">inplay_start_time</span> <span class="p">:</span>
</span><span id="AverMarket-538"><a href="#AverMarket-538"><span class="linenos">538</span></a>            <span class="k">return</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">ACTIVE_IN_PLAY</span>
</span><span id="AverMarket-539"><a href="#AverMarket-539"><span class="linenos">539</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span>
</span><span id="AverMarket-540"><a href="#AverMarket-540"><span class="linenos">540</span></a>
</span><span id="AverMarket-541"><a href="#AverMarket-541"><span class="linenos">541</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">crank_market</span><span class="p">(</span>
</span><span id="AverMarket-542"><a href="#AverMarket-542"><span class="linenos">542</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="AverMarket-543"><a href="#AverMarket-543"><span class="linenos">543</span></a>            <span class="n">outcome_idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket-544"><a href="#AverMarket-544"><span class="linenos">544</span></a>            <span class="n">reward_target</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket-545"><a href="#AverMarket-545"><span class="linenos">545</span></a>            <span class="n">payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket-546"><a href="#AverMarket-546"><span class="linenos">546</span></a>        <span class="p">):</span>
</span><span id="AverMarket-547"><a href="#AverMarket-547"><span class="linenos">547</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-548"><a href="#AverMarket-548"><span class="linenos">548</span></a><span class="sd">        Refresh market before cranking</span>
</span><span id="AverMarket-549"><a href="#AverMarket-549"><span class="linenos">549</span></a><span class="sd">        If no outcome_idx are passed, all outcomes are cranked if they meet the criteria to be cranked.</span>
</span><span id="AverMarket-550"><a href="#AverMarket-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-551"><a href="#AverMarket-551"><span class="linenos">551</span></a>        <span class="k">if</span> <span class="n">outcome_idxs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket-552"><a href="#AverMarket-552"><span class="linenos">552</span></a>            <span class="c1"># For binary markets, there is only one orderbook</span>
</span><span id="AverMarket-553"><a href="#AverMarket-553"><span class="linenos">553</span></a>            <span class="n">outcome_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="AverMarket-554"><a href="#AverMarket-554"><span class="linenos">554</span></a>                <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span><span class="p">)]</span>
</span><span id="AverMarket-555"><a href="#AverMarket-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">outcome_idxs</span> <span class="ow">or</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">outcome_idxs</span><span class="p">):</span>
</span><span id="AverMarket-556"><a href="#AverMarket-556"><span class="linenos">556</span></a>            <span class="n">outcome_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AverMarket-557"><a href="#AverMarket-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="n">reward_target</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket-558"><a href="#AverMarket-558"><span class="linenos">558</span></a>            <span class="n">reward_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">public_key</span>
</span><span id="AverMarket-559"><a href="#AverMarket-559"><span class="linenos">559</span></a>        <span class="k">if</span> <span class="n">payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket-560"><a href="#AverMarket-560"><span class="linenos">560</span></a>            <span class="n">payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="AverMarket-561"><a href="#AverMarket-561"><span class="linenos">561</span></a>
</span><span id="AverMarket-562"><a href="#AverMarket-562"><span class="linenos">562</span></a>        <span class="c1"># refreshed_market = await refresh_market(self.aver_client, self)</span>
</span><span id="AverMarket-563"><a href="#AverMarket-563"><span class="linenos">563</span></a>
</span><span id="AverMarket-564"><a href="#AverMarket-564"><span class="linenos">564</span></a>        <span class="n">event_queues</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">event_queue</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">]</span>
</span><span id="AverMarket-565"><a href="#AverMarket-565"><span class="linenos">565</span></a>        <span class="n">loaded_event_queues</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_all_event_queues</span><span class="p">(</span>
</span><span id="AverMarket-566"><a href="#AverMarket-566"><span class="linenos">566</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="AverMarket-567"><a href="#AverMarket-567"><span class="linenos">567</span></a>            <span class="n">event_queues</span> 
</span><span id="AverMarket-568"><a href="#AverMarket-568"><span class="linenos">568</span></a>            <span class="p">)</span>
</span><span id="AverMarket-569"><a href="#AverMarket-569"><span class="linenos">569</span></a>
</span><span id="AverMarket-570"><a href="#AverMarket-570"><span class="linenos">570</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="AverMarket-571"><a href="#AverMarket-571"><span class="linenos">571</span></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">outcome_idxs</span><span class="p">:</span>
</span><span id="AverMarket-572"><a href="#AverMarket-572"><span class="linenos">572</span></a>            <span class="k">if</span> <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;header&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="AverMarket-573"><a href="#AverMarket-573"><span class="linenos">573</span></a>                <span class="k">continue</span>
</span><span id="AverMarket-574"><a href="#AverMarket-574"><span class="linenos">574</span></a>
</span><span id="AverMarket-575"><a href="#AverMarket-575"><span class="linenos">575</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cranking market </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">)</span><span class="si">}</span><span class="s1"> for outcome </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;header&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s1"> events left to crank&#39;</span><span class="p">)</span>
</span><span id="AverMarket-576"><a href="#AverMarket-576"><span class="linenos">576</span></a>            <span class="k">if</span> <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="AverMarket-577"><a href="#AverMarket-577"><span class="linenos">577</span></a>                <span class="n">user_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket-578"><a href="#AverMarket-578"><span class="linenos">578</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]):</span>
</span><span id="AverMarket-579"><a href="#AverMarket-579"><span class="linenos">579</span></a>                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">==</span> <span class="n">Fill</span><span class="p">:</span>
</span><span id="AverMarket-580"><a href="#AverMarket-580"><span class="linenos">580</span></a>                        <span class="n">user_accounts</span> <span class="o">+=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">maker_user_market</span><span class="p">]</span>
</span><span id="AverMarket-581"><a href="#AverMarket-581"><span class="linenos">581</span></a>                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Out</span>
</span><span id="AverMarket-582"><a href="#AverMarket-582"><span class="linenos">582</span></a>                        <span class="n">user_accounts</span> <span class="o">+=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">user_market</span><span class="p">]</span>
</span><span id="AverMarket-583"><a href="#AverMarket-583"><span class="linenos">583</span></a>                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span><span class="p">:</span>
</span><span id="AverMarket-584"><a href="#AverMarket-584"><span class="linenos">584</span></a>                        <span class="k">break</span>
</span><span id="AverMarket-585"><a href="#AverMarket-585"><span class="linenos">585</span></a>                <span class="n">user_accounts</span> <span class="o">=</span> <span class="n">prepare_user_accounts_list</span><span class="p">(</span><span class="n">user_accounts</span><span class="p">)</span>
</span><span id="AverMarket-586"><a href="#AverMarket-586"><span class="linenos">586</span></a>                <span class="n">events_to_crank</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="AverMarket-587"><a href="#AverMarket-587"><span class="linenos">587</span></a>                    <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span><span class="p">)</span>
</span><span id="AverMarket-588"><a href="#AverMarket-588"><span class="linenos">588</span></a>
</span><span id="AverMarket-589"><a href="#AverMarket-589"><span class="linenos">589</span></a>                <span class="n">sig</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume_events</span><span class="p">(</span>
</span><span id="AverMarket-590"><a href="#AverMarket-590"><span class="linenos">590</span></a>                    <span class="n">outcome_idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
</span><span id="AverMarket-591"><a href="#AverMarket-591"><span class="linenos">591</span></a>                    <span class="n">max_iterations</span><span class="o">=</span><span class="n">events_to_crank</span><span class="p">,</span>
</span><span id="AverMarket-592"><a href="#AverMarket-592"><span class="linenos">592</span></a>                    <span class="n">user_accounts</span><span class="o">=</span><span class="n">user_accounts</span><span class="p">,</span>
</span><span id="AverMarket-593"><a href="#AverMarket-593"><span class="linenos">593</span></a>                    <span class="n">reward_target</span><span class="o">=</span><span class="n">reward_target</span><span class="p">,</span>
</span><span id="AverMarket-594"><a href="#AverMarket-594"><span class="linenos">594</span></a>                    <span class="n">payer</span><span class="o">=</span><span class="n">payer</span><span class="p">,</span>
</span><span id="AverMarket-595"><a href="#AverMarket-595"><span class="linenos">595</span></a>                <span class="p">)</span>
</span><span id="AverMarket-596"><a href="#AverMarket-596"><span class="linenos">596</span></a>
</span><span id="AverMarket-597"><a href="#AverMarket-597"><span class="linenos">597</span></a>        <span class="k">return</span> <span class="n">sig</span>
</span><span id="AverMarket-598"><a href="#AverMarket-598"><span class="linenos">598</span></a>
</span><span id="AverMarket-599"><a href="#AverMarket-599"><span class="linenos">599</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">consume_events</span><span class="p">(</span>
</span><span id="AverMarket-600"><a href="#AverMarket-600"><span class="linenos">600</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AverMarket-601"><a href="#AverMarket-601"><span class="linenos">601</span></a>        <span class="n">outcome_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="AverMarket-602"><a href="#AverMarket-602"><span class="linenos">602</span></a>        <span class="n">user_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span>
</span><span id="AverMarket-603"><a href="#AverMarket-603"><span class="linenos">603</span></a>        <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket-604"><a href="#AverMarket-604"><span class="linenos">604</span></a>        <span class="n">reward_target</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket-605"><a href="#AverMarket-605"><span class="linenos">605</span></a>        <span class="n">payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket-606"><a href="#AverMarket-606"><span class="linenos">606</span></a>    <span class="p">):</span>
</span><span id="AverMarket-607"><a href="#AverMarket-607"><span class="linenos">607</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket-608"><a href="#AverMarket-608"><span class="linenos">608</span></a><span class="sd">        Consume events</span>
</span><span id="AverMarket-609"><a href="#AverMarket-609"><span class="linenos">609</span></a>
</span><span id="AverMarket-610"><a href="#AverMarket-610"><span class="linenos">610</span></a><span class="sd">        Sends instructions on chain</span>
</span><span id="AverMarket-611"><a href="#AverMarket-611"><span class="linenos">611</span></a>
</span><span id="AverMarket-612"><a href="#AverMarket-612"><span class="linenos">612</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket-613"><a href="#AverMarket-613"><span class="linenos">613</span></a><span class="sd">            outcome_idx (int): index of the outcome</span>
</span><span id="AverMarket-614"><a href="#AverMarket-614"><span class="linenos">614</span></a><span class="sd">            user_accounts (list[PublicKey]): List of User Account public keys</span>
</span><span id="AverMarket-615"><a href="#AverMarket-615"><span class="linenos">615</span></a><span class="sd">            max_iterations (int, optional): Depth of events to iterate through. Defaults to MAX_ITERATIONS_FOR_CONSUME_EVENTS.</span>
</span><span id="AverMarket-616"><a href="#AverMarket-616"><span class="linenos">616</span></a><span class="sd">            reward_target (PublicKey, optional): Target for reward. Defaults to AverClient wallet.</span>
</span><span id="AverMarket-617"><a href="#AverMarket-617"><span class="linenos">617</span></a><span class="sd">            payer (Keypair, optional): Fee payer. Defaults to AverClient wallet.</span>
</span><span id="AverMarket-618"><a href="#AverMarket-618"><span class="linenos">618</span></a>
</span><span id="AverMarket-619"><a href="#AverMarket-619"><span class="linenos">619</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket-620"><a href="#AverMarket-620"><span class="linenos">620</span></a><span class="sd">            Transaction Signature: TransactionSignature object</span>
</span><span id="AverMarket-621"><a href="#AverMarket-621"><span class="linenos">621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket-622"><a href="#AverMarket-622"><span class="linenos">622</span></a>        <span class="k">if</span> <span class="n">reward_target</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket-623"><a href="#AverMarket-623"><span class="linenos">623</span></a>            <span class="n">reward_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">public_key</span>
</span><span id="AverMarket-624"><a href="#AverMarket-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="n">payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket-625"><a href="#AverMarket-625"><span class="linenos">625</span></a>            <span class="n">payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="AverMarket-626"><a href="#AverMarket-626"><span class="linenos">626</span></a>        <span class="k">if</span> <span class="n">max_iterations</span> <span class="o">&gt;</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span> <span class="ow">or</span> <span class="n">max_iterations</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket-627"><a href="#AverMarket-627"><span class="linenos">627</span></a>            <span class="n">max_iterations</span> <span class="o">=</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span>
</span><span id="AverMarket-628"><a href="#AverMarket-628"><span class="linenos">628</span></a>        
</span><span id="AverMarket-629"><a href="#AverMarket-629"><span class="linenos">629</span></a>        <span class="n">user_accounts_unsorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">AccountMeta</span><span class="p">(</span>
</span><span id="AverMarket-630"><a href="#AverMarket-630"><span class="linenos">630</span></a>                <span class="n">pk</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">user_accounts</span><span class="p">]</span>
</span><span id="AverMarket-631"><a href="#AverMarket-631"><span class="linenos">631</span></a>                
</span><span id="AverMarket-632"><a href="#AverMarket-632"><span class="linenos">632</span></a>        <span class="n">remaining_accounts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">user_accounts_unsorted</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">account</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">pubkey</span><span class="p">))</span>
</span><span id="AverMarket-633"><a href="#AverMarket-633"><span class="linenos">633</span></a>
</span><span id="AverMarket-634"><a href="#AverMarket-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">rpc</span><span class="p">[</span><span class="s2">&quot;consume_events&quot;</span><span class="p">](</span>
</span><span id="AverMarket-635"><a href="#AverMarket-635"><span class="linenos">635</span></a>                <span class="n">max_iterations</span><span class="p">,</span>
</span><span id="AverMarket-636"><a href="#AverMarket-636"><span class="linenos">636</span></a>                <span class="n">outcome_idx</span><span class="p">,</span>
</span><span id="AverMarket-637"><a href="#AverMarket-637"><span class="linenos">637</span></a>                <span class="n">ctx</span><span class="o">=</span><span class="n">Context</span><span class="p">(</span>
</span><span id="AverMarket-638"><a href="#AverMarket-638"><span class="linenos">638</span></a>                    <span class="n">accounts</span><span class="o">=</span><span class="p">{</span>
</span><span id="AverMarket-639"><a href="#AverMarket-639"><span class="linenos">639</span></a>                        <span class="s2">&quot;market&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="AverMarket-640"><a href="#AverMarket-640"><span class="linenos">640</span></a>                        <span class="s2">&quot;market_store&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_store</span><span class="p">,</span>
</span><span id="AverMarket-641"><a href="#AverMarket-641"><span class="linenos">641</span></a>                        <span class="s2">&quot;orderbook&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">[</span><span class="n">outcome_idx</span><span class="p">]</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span>
</span><span id="AverMarket-642"><a href="#AverMarket-642"><span class="linenos">642</span></a>                        <span class="s2">&quot;event_queue&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">[</span><span class="n">outcome_idx</span><span class="p">]</span><span class="o">.</span><span class="n">event_queue</span><span class="p">,</span>
</span><span id="AverMarket-643"><a href="#AverMarket-643"><span class="linenos">643</span></a>                        <span class="s2">&quot;reward_target&quot;</span><span class="p">:</span> <span class="n">reward_target</span><span class="p">,</span>
</span><span id="AverMarket-644"><a href="#AverMarket-644"><span class="linenos">644</span></a>                    <span class="p">},</span>
</span><span id="AverMarket-645"><a href="#AverMarket-645"><span class="linenos">645</span></a>                    <span class="n">remaining_accounts</span><span class="o">=</span><span class="n">remaining_accounts</span><span class="p">,</span>
</span><span id="AverMarket-646"><a href="#AverMarket-646"><span class="linenos">646</span></a>                <span class="p">),</span>
</span><span id="AverMarket-647"><a href="#AverMarket-647"><span class="linenos">647</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>AverMarket object</p>

<p>Contains information, references and and orderbooks on a particular market</p>
</div>


                            <div id="AverMarket.__init__" class="classattr">
                                        <input id="AverMarket.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AverMarket</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_pubkey</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span>,</span><span class="param">	<span class="n">market_state</span><span class="p">:</span> <span class="n"><a href="data_classes.html#MarketState">pyaver.data_classes.MarketState</a></span>,</span><span class="param">	<span class="n">market_store_state</span><span class="p">:</span> <span class="n"><a href="data_classes.html#MarketStoreState">pyaver.data_classes.MarketStoreState</a></span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="orderbook.html#Orderbook">pyaver.orderbook.Orderbook</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="AverMarket.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.__init__-44"><a href="#AverMarket.__init__-44"><span class="linenos">44</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="AverMarket.__init__-45"><a href="#AverMarket.__init__-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="AverMarket.__init__-46"><a href="#AverMarket.__init__-46"><span class="linenos">46</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="AverMarket.__init__-47"><a href="#AverMarket.__init__-47"><span class="linenos">47</span></a>        <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span>
</span><span id="AverMarket.__init__-48"><a href="#AverMarket.__init__-48"><span class="linenos">48</span></a>        <span class="n">market_state</span><span class="p">:</span> <span class="n">MarketState</span><span class="p">,</span>
</span><span id="AverMarket.__init__-49"><a href="#AverMarket.__init__-49"><span class="linenos">49</span></a>        <span class="n">market_store_state</span><span class="p">:</span> <span class="n">MarketStoreState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket.__init__-50"><a href="#AverMarket.__init__-50"><span class="linenos">50</span></a>        <span class="n">orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket.__init__-51"><a href="#AverMarket.__init__-51"><span class="linenos">51</span></a>        <span class="p">):</span>
</span><span id="AverMarket.__init__-52"><a href="#AverMarket.__init__-52"><span class="linenos">52</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.__init__-53"><a href="#AverMarket.__init__-53"><span class="linenos">53</span></a><span class="sd">        Initialise an AverMarket object. Do not use this function; use AverMarket.load() instead.</span>
</span><span id="AverMarket.__init__-54"><a href="#AverMarket.__init__-54"><span class="linenos">54</span></a>
</span><span id="AverMarket.__init__-55"><a href="#AverMarket.__init__-55"><span class="linenos">55</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.__init__-56"><a href="#AverMarket.__init__-56"><span class="linenos">56</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.__init__-57"><a href="#AverMarket.__init__-57"><span class="linenos">57</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="AverMarket.__init__-58"><a href="#AverMarket.__init__-58"><span class="linenos">58</span></a><span class="sd">            market_state (MarketState): MarketState object</span>
</span><span id="AverMarket.__init__-59"><a href="#AverMarket.__init__-59"><span class="linenos">59</span></a><span class="sd">            market_store_state (MarketStoreState, optional): MarketStoreState object. Defaults to None.</span>
</span><span id="AverMarket.__init__-60"><a href="#AverMarket.__init__-60"><span class="linenos">60</span></a><span class="sd">            orderbooks (list[Orderbook], optional): List of Orderbook objects. Defaults to None.</span>
</span><span id="AverMarket.__init__-61"><a href="#AverMarket.__init__-61"><span class="linenos">61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.__init__-62"><a href="#AverMarket.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span> <span class="o">=</span> <span class="n">market_pubkey</span>
</span><span id="AverMarket.__init__-63"><a href="#AverMarket.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span> <span class="o">=</span> <span class="n">market_state</span>
</span><span id="AverMarket.__init__-64"><a href="#AverMarket.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span> <span class="o">=</span> <span class="n">market_store_state</span>
</span><span id="AverMarket.__init__-65"><a href="#AverMarket.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orderbooks</span> <span class="o">=</span> <span class="n">orderbooks</span>
</span><span id="AverMarket.__init__-66"><a href="#AverMarket.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span> <span class="o">=</span> <span class="n">aver_client</span>
</span><span id="AverMarket.__init__-67"><a href="#AverMarket.__init__-67"><span class="linenos">67</span></a>
</span><span id="AverMarket.__init__-68"><a href="#AverMarket.__init__-68"><span class="linenos">68</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">orderbooks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="AverMarket.__init__-69"><a href="#AverMarket.__init__-69"><span class="linenos">69</span></a>            <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Initialise an AverMarket object. Do not use this function; use <a href="#AverMarket.load">AverMarket.load()</a> instead.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_pubkey (PublicKey):</strong>  Market public key</li>
<li><strong>market_state (MarketState):</strong>  MarketState object</li>
<li><strong>market_store_state (MarketStoreState, optional):</strong>  MarketStoreState object. Defaults to None.</li>
<li><strong>orderbooks (list[Orderbook], optional):</strong>  List of Orderbook objects. Defaults to None.</li>
</ul>
</div>


                            </div>
                            <div id="AverMarket.market_pubkey" class="classattr">
                                <div class="attr variable">
            <span class="name">market_pubkey</span><span class="annotation">: solana.publickey.PublicKey</span>

        
    </div>
    <a class="headerlink" href="#AverMarket.market_pubkey"></a>
    
            <div class="docstring"><p>Market pubkey</p>
</div>


                            </div>
                            <div id="AverMarket.market_state" class="classattr">
                                <div class="attr variable">
            <span class="name">market_state</span><span class="annotation">: <a href="data_classes.html#MarketState">pyaver.data_classes.MarketState</a></span>

        
    </div>
    <a class="headerlink" href="#AverMarket.market_state"></a>
    
            <div class="docstring"><p>MarketState object holding data about the market</p>
</div>


                            </div>
                            <div id="AverMarket.market_store_state" class="classattr">
                                <div class="attr variable">
            <span class="name">market_store_state</span><span class="annotation">: <a href="data_classes.html#MarketStoreState">pyaver.data_classes.MarketStoreState</a></span>

        
    </div>
    <a class="headerlink" href="#AverMarket.market_store_state"></a>
    
            <div class="docstring"><p>MarketStoreStateobject holding data about the market required during active trading. </p>

<p>This does not exist if the market has stopped trading, voided or resolved</p>
</div>


                            </div>
                            <div id="AverMarket.orderbooks" class="classattr">
                                <div class="attr variable">
            <span class="name">orderbooks</span><span class="annotation">: list[<a href="orderbook.html#Orderbook">pyaver.orderbook.Orderbook</a>]</span>

        
    </div>
    <a class="headerlink" href="#AverMarket.orderbooks"></a>
    
            <div class="docstring"><p>Ordered list of Orderbooks for this market.</p>

<p>Note: Binary (two-outcome0) markets only have 1 orderbook.</p>
</div>


                            </div>
                            <div id="AverMarket.aver_client" class="classattr">
                                <div class="attr variable">
            <span class="name">aver_client</span><span class="annotation">: <a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>

        
    </div>
    <a class="headerlink" href="#AverMarket.aver_client"></a>
    
            <div class="docstring"><p>AverClient object</p>
</div>


                            </div>
                            <div id="AverMarket.load" class="classattr">
                                        <input id="AverMarket.load-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">load</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_pubkey</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span></span>)</span>

                <label class="view-source-button" for="AverMarket.load-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.load"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.load-71"><a href="#AverMarket.load-71"><span class="linenos">71</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.load-72"><a href="#AverMarket.load-72"><span class="linenos">72</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">):</span>
</span><span id="AverMarket.load-73"><a href="#AverMarket.load-73"><span class="linenos">73</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.load-74"><a href="#AverMarket.load-74"><span class="linenos">74</span></a><span class="sd">        Initialises an AverMarket object</span>
</span><span id="AverMarket.load-75"><a href="#AverMarket.load-75"><span class="linenos">75</span></a>
</span><span id="AverMarket.load-76"><a href="#AverMarket.load-76"><span class="linenos">76</span></a><span class="sd">        To refresh data on an already loaded market use src.refresh.refresh_markets()</span>
</span><span id="AverMarket.load-77"><a href="#AverMarket.load-77"><span class="linenos">77</span></a>
</span><span id="AverMarket.load-78"><a href="#AverMarket.load-78"><span class="linenos">78</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.load-79"><a href="#AverMarket.load-79"><span class="linenos">79</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.load-80"><a href="#AverMarket.load-80"><span class="linenos">80</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="AverMarket.load-81"><a href="#AverMarket.load-81"><span class="linenos">81</span></a>
</span><span id="AverMarket.load-82"><a href="#AverMarket.load-82"><span class="linenos">82</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.load-83"><a href="#AverMarket.load-83"><span class="linenos">83</span></a><span class="sd">            AverMarket: AverMarket object</span>
</span><span id="AverMarket.load-84"><a href="#AverMarket.load-84"><span class="linenos">84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.load-85"><a href="#AverMarket.load-85"><span class="linenos">85</span></a>        <span class="n">market_state_and_store</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_market_state_and_store</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">)</span>
</span><span id="AverMarket.load-86"><a href="#AverMarket.load-86"><span class="linenos">86</span></a>        <span class="n">market_state</span><span class="p">:</span> <span class="n">MarketState</span> <span class="o">=</span> <span class="n">market_state_and_store</span><span class="p">[</span><span class="s1">&#39;market_states&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AverMarket.load-87"><a href="#AverMarket.load-87"><span class="linenos">87</span></a>        <span class="n">market_store_state</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AverMarket.load-88"><a href="#AverMarket.load-88"><span class="linenos">88</span></a>        <span class="n">orderbooks</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AverMarket.load-89"><a href="#AverMarket.load-89"><span class="linenos">89</span></a>        <span class="n">is_market_status_closed</span> <span class="o">=</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span><span class="p">)</span>
</span><span id="AverMarket.load-90"><a href="#AverMarket.load-90"><span class="linenos">90</span></a>        <span class="n">market_store_state</span><span class="p">:</span> <span class="n">MarketStoreState</span> <span class="o">=</span> <span class="n">market_state_and_store</span><span class="p">[</span><span class="s1">&#39;market_stores&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AverMarket.load-91"><a href="#AverMarket.load-91"><span class="linenos">91</span></a>
</span><span id="AverMarket.load-92"><a href="#AverMarket.load-92"><span class="linenos">92</span></a>        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">is_market_status_closed</span><span class="p">):</span>
</span><span id="AverMarket.load-93"><a href="#AverMarket.load-93"><span class="linenos">93</span></a>            <span class="n">orderbooks</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span>
</span><span id="AverMarket.load-94"><a href="#AverMarket.load-94"><span class="linenos">94</span></a>                <span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="AverMarket.load-95"><a href="#AverMarket.load-95"><span class="linenos">95</span></a>                <span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">,</span>
</span><span id="AverMarket.load-96"><a href="#AverMarket.load-96"><span class="linenos">96</span></a>                <span class="p">[</span><span class="n">market_state</span><span class="o">.</span><span class="n">decimals</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span>
</span><span id="AverMarket.load-97"><a href="#AverMarket.load-97"><span class="linenos">97</span></a>            <span class="p">)</span>
</span><span id="AverMarket.load-98"><a href="#AverMarket.load-98"><span class="linenos">98</span></a>
</span><span id="AverMarket.load-99"><a href="#AverMarket.load-99"><span class="linenos">99</span></a>        <span class="k">return</span> <span class="n">AverMarket</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">,</span> <span class="n">market_state</span><span class="p">,</span> <span class="n">market_store_state</span><span class="p">,</span> <span class="n">orderbooks</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialises an AverMarket object</p>

<p>To refresh data on an already loaded market use src.refresh.refresh_markets()</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_pubkey (PublicKey):</strong>  Market public key</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>AverMarket: AverMarket object</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.load_multiple" class="classattr">
                                        <input id="AverMarket.load_multiple-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">load_multiple</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="AverMarket.load_multiple-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.load_multiple"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.load_multiple-101"><a href="#AverMarket.load_multiple-101"><span class="linenos">101</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.load_multiple-102"><a href="#AverMarket.load_multiple-102"><span class="linenos">102</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">]):</span>
</span><span id="AverMarket.load_multiple-103"><a href="#AverMarket.load_multiple-103"><span class="linenos">103</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.load_multiple-104"><a href="#AverMarket.load_multiple-104"><span class="linenos">104</span></a><span class="sd">        Initialises multiple AverMarket objects</span>
</span><span id="AverMarket.load_multiple-105"><a href="#AverMarket.load_multiple-105"><span class="linenos">105</span></a>
</span><span id="AverMarket.load_multiple-106"><a href="#AverMarket.load_multiple-106"><span class="linenos">106</span></a><span class="sd">        This method is quicker that using Market.load() multiple times</span>
</span><span id="AverMarket.load_multiple-107"><a href="#AverMarket.load_multiple-107"><span class="linenos">107</span></a>
</span><span id="AverMarket.load_multiple-108"><a href="#AverMarket.load_multiple-108"><span class="linenos">108</span></a><span class="sd">        To refresh data on already loaded markets use src.refresh.refresh_multiple_markets()</span>
</span><span id="AverMarket.load_multiple-109"><a href="#AverMarket.load_multiple-109"><span class="linenos">109</span></a>
</span><span id="AverMarket.load_multiple-110"><a href="#AverMarket.load_multiple-110"><span class="linenos">110</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.load_multiple-111"><a href="#AverMarket.load_multiple-111"><span class="linenos">111</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.load_multiple-112"><a href="#AverMarket.load_multiple-112"><span class="linenos">112</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of Market public keys</span>
</span><span id="AverMarket.load_multiple-113"><a href="#AverMarket.load_multiple-113"><span class="linenos">113</span></a>
</span><span id="AverMarket.load_multiple-114"><a href="#AverMarket.load_multiple-114"><span class="linenos">114</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.load_multiple-115"><a href="#AverMarket.load_multiple-115"><span class="linenos">115</span></a><span class="sd">            list[AverMarket]: List of AverMarket objects</span>
</span><span id="AverMarket.load_multiple-116"><a href="#AverMarket.load_multiple-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.load_multiple-117"><a href="#AverMarket.load_multiple-117"><span class="linenos">117</span></a>        <span class="n">market_states_and_stores</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">)</span>
</span><span id="AverMarket.load_multiple-118"><a href="#AverMarket.load_multiple-118"><span class="linenos">118</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_states_and_stores</span><span class="p">[</span><span class="s1">&#39;market_states&#39;</span><span class="p">]</span>
</span><span id="AverMarket.load_multiple-119"><a href="#AverMarket.load_multiple-119"><span class="linenos">119</span></a>
</span><span id="AverMarket.load_multiple-120"><a href="#AverMarket.load_multiple-120"><span class="linenos">120</span></a>        <span class="n">are_market_statuses_closed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.load_multiple-121"><a href="#AverMarket.load_multiple-121"><span class="linenos">121</span></a>        <span class="k">for</span> <span class="n">market_state</span> <span class="ow">in</span> <span class="n">market_states</span><span class="p">:</span>
</span><span id="AverMarket.load_multiple-122"><a href="#AverMarket.load_multiple-122"><span class="linenos">122</span></a>            <span class="n">are_market_statuses_closed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AverMarket</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">(</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span><span class="p">))</span>
</span><span id="AverMarket.load_multiple-123"><a href="#AverMarket.load_multiple-123"><span class="linenos">123</span></a>
</span><span id="AverMarket.load_multiple-124"><a href="#AverMarket.load_multiple-124"><span class="linenos">124</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_states_and_stores</span><span class="p">[</span><span class="s1">&#39;market_stores&#39;</span><span class="p">]</span>
</span><span id="AverMarket.load_multiple-125"><a href="#AverMarket.load_multiple-125"><span class="linenos">125</span></a>
</span><span id="AverMarket.load_multiple-126"><a href="#AverMarket.load_multiple-126"><span class="linenos">126</span></a>        <span class="n">orderbooks_market_list</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts_multiple_markets</span><span class="p">(</span>
</span><span id="AverMarket.load_multiple-127"><a href="#AverMarket.load_multiple-127"><span class="linenos">127</span></a>            <span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="AverMarket.load_multiple-128"><a href="#AverMarket.load_multiple-128"><span class="linenos">128</span></a>            <span class="n">market_states</span><span class="p">,</span>
</span><span id="AverMarket.load_multiple-129"><a href="#AverMarket.load_multiple-129"><span class="linenos">129</span></a>            <span class="n">market_stores</span><span class="p">,</span>
</span><span id="AverMarket.load_multiple-130"><a href="#AverMarket.load_multiple-130"><span class="linenos">130</span></a>            <span class="n">are_market_statuses_closed</span><span class="p">,</span>
</span><span id="AverMarket.load_multiple-131"><a href="#AverMarket.load_multiple-131"><span class="linenos">131</span></a>        <span class="p">)</span>
</span><span id="AverMarket.load_multiple-132"><a href="#AverMarket.load_multiple-132"><span class="linenos">132</span></a>        
</span><span id="AverMarket.load_multiple-133"><a href="#AverMarket.load_multiple-133"><span class="linenos">133</span></a>        <span class="n">markets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AverMarket</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.load_multiple-134"><a href="#AverMarket.load_multiple-134"><span class="linenos">134</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_pubkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):</span>
</span><span id="AverMarket.load_multiple-135"><a href="#AverMarket.load_multiple-135"><span class="linenos">135</span></a>            <span class="n">market</span> <span class="o">=</span> <span class="n">AverMarket</span><span class="p">(</span>
</span><span id="AverMarket.load_multiple-136"><a href="#AverMarket.load_multiple-136"><span class="linenos">136</span></a>                <span class="n">aver_client</span><span class="p">,</span> 
</span><span id="AverMarket.load_multiple-137"><a href="#AverMarket.load_multiple-137"><span class="linenos">137</span></a>                <span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="AverMarket.load_multiple-138"><a href="#AverMarket.load_multiple-138"><span class="linenos">138</span></a>                <span class="n">market_states</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> 
</span><span id="AverMarket.load_multiple-139"><a href="#AverMarket.load_multiple-139"><span class="linenos">139</span></a>                <span class="n">market_stores</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> 
</span><span id="AverMarket.load_multiple-140"><a href="#AverMarket.load_multiple-140"><span class="linenos">140</span></a>                <span class="n">orderbooks_market_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="AverMarket.load_multiple-141"><a href="#AverMarket.load_multiple-141"><span class="linenos">141</span></a>                <span class="p">)</span>
</span><span id="AverMarket.load_multiple-142"><a href="#AverMarket.load_multiple-142"><span class="linenos">142</span></a>            <span class="n">markets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market</span><span class="p">)</span>
</span><span id="AverMarket.load_multiple-143"><a href="#AverMarket.load_multiple-143"><span class="linenos">143</span></a>        
</span><span id="AverMarket.load_multiple-144"><a href="#AverMarket.load_multiple-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="n">markets</span>
</span></pre></div>


            <div class="docstring"><p>Initialises multiple AverMarket objects</p>

<p>This method is quicker that using Market.load() multiple times</p>

<p>To refresh data on already loaded markets use src.refresh.refresh_multiple_markets()</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_pubkeys (list[PublicKey]):</strong>  List of Market public keys</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list[AverMarket]: List of AverMarket objects</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.load_market_state" class="classattr">
                                        <input id="AverMarket.load_market_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">load_market_state</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_pubkey</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span></span><span class="return-annotation">) -> <span class="n"><a href="data_classes.html#MarketState">pyaver.data_classes.MarketState</a></span>:</span></span>

                <label class="view-source-button" for="AverMarket.load_market_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.load_market_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.load_market_state-146"><a href="#AverMarket.load_market_state-146"><span class="linenos">146</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.load_market_state-147"><a href="#AverMarket.load_market_state-147"><span class="linenos">147</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_state</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketState</span><span class="p">:</span>
</span><span id="AverMarket.load_market_state-148"><a href="#AverMarket.load_market_state-148"><span class="linenos">148</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.load_market_state-149"><a href="#AverMarket.load_market_state-149"><span class="linenos">149</span></a><span class="sd">        Loads onchain data for a MarketState</span>
</span><span id="AverMarket.load_market_state-150"><a href="#AverMarket.load_market_state-150"><span class="linenos">150</span></a>
</span><span id="AverMarket.load_market_state-151"><a href="#AverMarket.load_market_state-151"><span class="linenos">151</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.load_market_state-152"><a href="#AverMarket.load_market_state-152"><span class="linenos">152</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.load_market_state-153"><a href="#AverMarket.load_market_state-153"><span class="linenos">153</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="AverMarket.load_market_state-154"><a href="#AverMarket.load_market_state-154"><span class="linenos">154</span></a>
</span><span id="AverMarket.load_market_state-155"><a href="#AverMarket.load_market_state-155"><span class="linenos">155</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.load_market_state-156"><a href="#AverMarket.load_market_state-156"><span class="linenos">156</span></a><span class="sd">            MarketState: MarketState object</span>
</span><span id="AverMarket.load_market_state-157"><a href="#AverMarket.load_market_state-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.load_market_state-158"><a href="#AverMarket.load_market_state-158"><span class="linenos">158</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">)</span>
</span><span id="AverMarket.load_market_state-159"><a href="#AverMarket.load_market_state-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Loads onchain data for a MarketState</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_pubkey (PublicKey):</strong>  Market public key</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>MarketState: MarketState object</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.load_multiple_market_states" class="classattr">
                                        <input id="AverMarket.load_multiple_market_states-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">load_multiple_market_states</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="data_classes.html#MarketState">pyaver.data_classes.MarketState</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AverMarket.load_multiple_market_states-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.load_multiple_market_states"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.load_multiple_market_states-161"><a href="#AverMarket.load_multiple_market_states-161"><span class="linenos">161</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.load_multiple_market_states-162"><a href="#AverMarket.load_multiple_market_states-162"><span class="linenos">162</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_states</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">]:</span>
</span><span id="AverMarket.load_multiple_market_states-163"><a href="#AverMarket.load_multiple_market_states-163"><span class="linenos">163</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.load_multiple_market_states-164"><a href="#AverMarket.load_multiple_market_states-164"><span class="linenos">164</span></a><span class="sd">        Loads onchain data for multiple MarketStates</span>
</span><span id="AverMarket.load_multiple_market_states-165"><a href="#AverMarket.load_multiple_market_states-165"><span class="linenos">165</span></a>
</span><span id="AverMarket.load_multiple_market_states-166"><a href="#AverMarket.load_multiple_market_states-166"><span class="linenos">166</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.load_multiple_market_states-167"><a href="#AverMarket.load_multiple_market_states-167"><span class="linenos">167</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.load_multiple_market_states-168"><a href="#AverMarket.load_multiple_market_states-168"><span class="linenos">168</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="AverMarket.load_multiple_market_states-169"><a href="#AverMarket.load_multiple_market_states-169"><span class="linenos">169</span></a>
</span><span id="AverMarket.load_multiple_market_states-170"><a href="#AverMarket.load_multiple_market_states-170"><span class="linenos">170</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.load_multiple_market_states-171"><a href="#AverMarket.load_multiple_market_states-171"><span class="linenos">171</span></a><span class="sd">            list[MarketState]: List of MarketState objects</span>
</span><span id="AverMarket.load_multiple_market_states-172"><a href="#AverMarket.load_multiple_market_states-172"><span class="linenos">172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.load_multiple_market_states-173"><a href="#AverMarket.load_multiple_market_states-173"><span class="linenos">173</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch_multiple</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">)</span>
</span><span id="AverMarket.load_multiple_market_states-174"><a href="#AverMarket.load_multiple_market_states-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Loads onchain data for multiple MarketStates</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_pubkeys (list[PublicKey]):</strong>  List of market public keys</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list[MarketState]: List of MarketState objects</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.load_market_state_and_store" class="classattr">
                                        <input id="AverMarket.load_market_state_and_store-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">load_market_state_and_store</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_pubkey</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span></span>)</span>

                <label class="view-source-button" for="AverMarket.load_market_state_and_store-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.load_market_state_and_store"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.load_market_state_and_store-176"><a href="#AverMarket.load_market_state_and_store-176"><span class="linenos">176</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.load_market_state_and_store-177"><a href="#AverMarket.load_market_state_and_store-177"><span class="linenos">177</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_state_and_store</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">):</span>
</span><span id="AverMarket.load_market_state_and_store-178"><a href="#AverMarket.load_market_state_and_store-178"><span class="linenos">178</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.load_market_state_and_store-179"><a href="#AverMarket.load_market_state_and_store-179"><span class="linenos">179</span></a><span class="sd">        Loads onchain data for multiple MarketStates and MarketStoreStates at once</span>
</span><span id="AverMarket.load_market_state_and_store-180"><a href="#AverMarket.load_market_state_and_store-180"><span class="linenos">180</span></a>
</span><span id="AverMarket.load_market_state_and_store-181"><a href="#AverMarket.load_market_state_and_store-181"><span class="linenos">181</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.load_market_state_and_store-182"><a href="#AverMarket.load_market_state_and_store-182"><span class="linenos">182</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.load_market_state_and_store-183"><a href="#AverMarket.load_market_state_and_store-183"><span class="linenos">183</span></a><span class="sd">            market_pubkey (PublicKey]: Market public key</span>
</span><span id="AverMarket.load_market_state_and_store-184"><a href="#AverMarket.load_market_state_and_store-184"><span class="linenos">184</span></a>
</span><span id="AverMarket.load_market_state_and_store-185"><a href="#AverMarket.load_market_state_and_store-185"><span class="linenos">185</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.load_market_state_and_store-186"><a href="#AverMarket.load_market_state_and_store-186"><span class="linenos">186</span></a><span class="sd">            dict[str, list[MarketState] or list[MarketStoreState]]: Keys are market_states or market_stores</span>
</span><span id="AverMarket.load_market_state_and_store-187"><a href="#AverMarket.load_market_state_and_store-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.load_market_state_and_store-188"><a href="#AverMarket.load_market_state_and_store-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">,</span> <span class="p">[</span><span class="n">market_pubkey</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Loads onchain data for multiple MarketStates and MarketStoreStates at once</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_pubkey (PublicKey]:</strong>  Market public key</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>dict[str, list[MarketState] or list[MarketStoreState]]: Keys are market_states or market_stores</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.load_multiple_market_states_and_stores" class="classattr">
                                        <input id="AverMarket.load_multiple_market_states_and_stores-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">load_multiple_market_states_and_stores</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="AverMarket.load_multiple_market_states_and_stores-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.load_multiple_market_states_and_stores"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.load_multiple_market_states_and_stores-190"><a href="#AverMarket.load_multiple_market_states_and_stores-190"><span class="linenos">190</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-191"><a href="#AverMarket.load_multiple_market_states_and_stores-191"><span class="linenos">191</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_states_and_stores</span><span class="p">(</span><span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">]):</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-192"><a href="#AverMarket.load_multiple_market_states_and_stores-192"><span class="linenos">192</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-193"><a href="#AverMarket.load_multiple_market_states_and_stores-193"><span class="linenos">193</span></a><span class="sd">        Loads onchain data for multiple MarketStates and MarketStoreStates at once</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-194"><a href="#AverMarket.load_multiple_market_states_and_stores-194"><span class="linenos">194</span></a>
</span><span id="AverMarket.load_multiple_market_states_and_stores-195"><a href="#AverMarket.load_multiple_market_states_and_stores-195"><span class="linenos">195</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-196"><a href="#AverMarket.load_multiple_market_states_and_stores-196"><span class="linenos">196</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-197"><a href="#AverMarket.load_multiple_market_states_and_stores-197"><span class="linenos">197</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-198"><a href="#AverMarket.load_multiple_market_states_and_stores-198"><span class="linenos">198</span></a>
</span><span id="AverMarket.load_multiple_market_states_and_stores-199"><a href="#AverMarket.load_multiple_market_states_and_stores-199"><span class="linenos">199</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-200"><a href="#AverMarket.load_multiple_market_states_and_stores-200"><span class="linenos">200</span></a><span class="sd">            dict[str, list[MarketState] or list[MarketStoreState]]: Keys are market_states or market_stores</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-201"><a href="#AverMarket.load_multiple_market_states_and_stores-201"><span class="linenos">201</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-202"><a href="#AverMarket.load_multiple_market_states_and_stores-202"><span class="linenos">202</span></a>        <span class="n">market_store_pubkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">AverMarket</span><span class="o">.</span><span class="n">derive_market_store_pubkey_and_bump</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">market_pubkeys</span><span class="p">]</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-203"><a href="#AverMarket.load_multiple_market_states_and_stores-203"><span class="linenos">203</span></a>
</span><span id="AverMarket.load_multiple_market_states_and_stores-204"><a href="#AverMarket.load_multiple_market_states_and_stores-204"><span class="linenos">204</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_multiple_bytes_data</span><span class="p">(</span><span class="n">aver_client</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">market_pubkeys</span> <span class="o">+</span> <span class="n">market_store_pubkeys</span><span class="p">)</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-205"><a href="#AverMarket.load_multiple_market_states_and_stores-205"><span class="linenos">205</span></a>        <span class="n">market_states_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">)]</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-206"><a href="#AverMarket.load_multiple_market_states_and_stores-206"><span class="linenos">206</span></a>        <span class="n">market_stores_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):]</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-207"><a href="#AverMarket.load_multiple_market_states_and_stores-207"><span class="linenos">207</span></a>
</span><span id="AverMarket.load_multiple_market_states_and_stores-208"><a href="#AverMarket.load_multiple_market_states_and_stores-208"><span class="linenos">208</span></a>        <span class="n">market_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">parse_market_state</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">aver_client</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">market_states_data</span><span class="p">]</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-209"><a href="#AverMarket.load_multiple_market_states_and_stores-209"><span class="linenos">209</span></a>        <span class="n">market_stores</span> <span class="o">=</span> <span class="p">[</span><span class="n">parse_market_store</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">aver_client</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">market_stores_data</span><span class="p">]</span>
</span><span id="AverMarket.load_multiple_market_states_and_stores-210"><a href="#AverMarket.load_multiple_market_states_and_stores-210"><span class="linenos">210</span></a>
</span><span id="AverMarket.load_multiple_market_states_and_stores-211"><a href="#AverMarket.load_multiple_market_states_and_stores-211"><span class="linenos">211</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;market_states&#39;</span><span class="p">:</span> <span class="n">market_states</span><span class="p">,</span> <span class="s1">&#39;market_stores&#39;</span><span class="p">:</span> <span class="n">market_stores</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Loads onchain data for multiple MarketStates and MarketStoreStates at once</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_pubkeys (list[PublicKey]):</strong>  List of market public keys</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>dict[str, list[MarketState] or list[MarketStoreState]]: Keys are market_states or market_stores</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.derive_market_store_pubkey_and_bump" class="classattr">
                                        <input id="AverMarket.derive_market_store_pubkey_and_bump-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">derive_market_store_pubkey_and_bump</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">market_pubkey</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span>,</span><span class="param">	<span class="n">program_id</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span> <span class="o">=</span> <span class="mi">6</span><span class="n">q5ZGhEj6kkmEjuyCXuH4x8493bpi9fNzvy9L8hX83HQ</span></span>)</span>

                <label class="view-source-button" for="AverMarket.derive_market_store_pubkey_and_bump-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.derive_market_store_pubkey_and_bump"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.derive_market_store_pubkey_and_bump-213"><a href="#AverMarket.derive_market_store_pubkey_and_bump-213"><span class="linenos">213</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-214"><a href="#AverMarket.derive_market_store_pubkey_and_bump-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">derive_market_store_pubkey_and_bump</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span> <span class="n">program_id</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">):</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-215"><a href="#AverMarket.derive_market_store_pubkey_and_bump-215"><span class="linenos">215</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-216"><a href="#AverMarket.derive_market_store_pubkey_and_bump-216"><span class="linenos">216</span></a><span class="sd">        Derives PDA (Program Derived Account) for MarketStore public key.</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-217"><a href="#AverMarket.derive_market_store_pubkey_and_bump-217"><span class="linenos">217</span></a><span class="sd">        MarketStore account addresses are derived deterministically using the market&#39;s pubkey.</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-218"><a href="#AverMarket.derive_market_store_pubkey_and_bump-218"><span class="linenos">218</span></a>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-219"><a href="#AverMarket.derive_market_store_pubkey_and_bump-219"><span class="linenos">219</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-220"><a href="#AverMarket.derive_market_store_pubkey_and_bump-220"><span class="linenos">220</span></a><span class="sd">            market_pubkey (PublicKey): Market public key</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-221"><a href="#AverMarket.derive_market_store_pubkey_and_bump-221"><span class="linenos">221</span></a><span class="sd">            program_id (PublicKey, optional): Program public key. Defaults to AVER_PROGRAM_ID.</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-222"><a href="#AverMarket.derive_market_store_pubkey_and_bump-222"><span class="linenos">222</span></a>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-223"><a href="#AverMarket.derive_market_store_pubkey_and_bump-223"><span class="linenos">223</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-224"><a href="#AverMarket.derive_market_store_pubkey_and_bump-224"><span class="linenos">224</span></a><span class="sd">            PublicKey: MarketStore public key</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-225"><a href="#AverMarket.derive_market_store_pubkey_and_bump-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-226"><a href="#AverMarket.derive_market_store_pubkey_and_bump-226"><span class="linenos">226</span></a>        <span class="k">return</span> <span class="n">PublicKey</span><span class="o">.</span><span class="n">find_program_address</span><span class="p">(</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-227"><a href="#AverMarket.derive_market_store_pubkey_and_bump-227"><span class="linenos">227</span></a>            <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;market-store&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">market_pubkey</span><span class="p">)],</span> 
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-228"><a href="#AverMarket.derive_market_store_pubkey_and_bump-228"><span class="linenos">228</span></a>            <span class="n">program_id</span>
</span><span id="AverMarket.derive_market_store_pubkey_and_bump-229"><a href="#AverMarket.derive_market_store_pubkey_and_bump-229"><span class="linenos">229</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Derives PDA (Program Derived Account) for MarketStore public key.
MarketStore account addresses are derived deterministically using the market's pubkey.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>market_pubkey (PublicKey):</strong>  Market public key</li>
<li><strong>program_id (PublicKey, optional):</strong>  Program public key. Defaults to AVER_PROGRAM_ID.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>PublicKey: MarketStore public key</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.get_markets_from_account_states" class="classattr">
                                        <input id="AverMarket.get_markets_from_account_states-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_markets_from_account_states</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span><span class="p">]</span>,</span><span class="param">	<span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="data_classes.html#MarketState">pyaver.data_classes.MarketState</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="data_classes.html#MarketStoreState">pyaver.data_classes.MarketStoreState</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">slabs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="slab.html#Slab">pyaver.slab.Slab</a></span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="AverMarket.get_markets_from_account_states-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.get_markets_from_account_states"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.get_markets_from_account_states-231"><a href="#AverMarket.get_markets_from_account_states-231"><span class="linenos">231</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.get_markets_from_account_states-232"><a href="#AverMarket.get_markets_from_account_states-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">get_markets_from_account_states</span><span class="p">(</span>
</span><span id="AverMarket.get_markets_from_account_states-233"><a href="#AverMarket.get_markets_from_account_states-233"><span class="linenos">233</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span>
</span><span id="AverMarket.get_markets_from_account_states-234"><a href="#AverMarket.get_markets_from_account_states-234"><span class="linenos">234</span></a>        <span class="n">market_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span> 
</span><span id="AverMarket.get_markets_from_account_states-235"><a href="#AverMarket.get_markets_from_account_states-235"><span class="linenos">235</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">],</span> 
</span><span id="AverMarket.get_markets_from_account_states-236"><a href="#AverMarket.get_markets_from_account_states-236"><span class="linenos">236</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">],</span>
</span><span id="AverMarket.get_markets_from_account_states-237"><a href="#AverMarket.get_markets_from_account_states-237"><span class="linenos">237</span></a>        <span class="n">slabs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Slab</span><span class="p">],</span>
</span><span id="AverMarket.get_markets_from_account_states-238"><a href="#AverMarket.get_markets_from_account_states-238"><span class="linenos">238</span></a>        <span class="p">):</span>
</span><span id="AverMarket.get_markets_from_account_states-239"><a href="#AverMarket.get_markets_from_account_states-239"><span class="linenos">239</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.get_markets_from_account_states-240"><a href="#AverMarket.get_markets_from_account_states-240"><span class="linenos">240</span></a><span class="sd">        Returns multiple AverMarket objects from their respective MarketStates, stores and orderbook objects</span>
</span><span id="AverMarket.get_markets_from_account_states-241"><a href="#AverMarket.get_markets_from_account_states-241"><span class="linenos">241</span></a>
</span><span id="AverMarket.get_markets_from_account_states-242"><a href="#AverMarket.get_markets_from_account_states-242"><span class="linenos">242</span></a><span class="sd">        Used in refresh.py</span>
</span><span id="AverMarket.get_markets_from_account_states-243"><a href="#AverMarket.get_markets_from_account_states-243"><span class="linenos">243</span></a>
</span><span id="AverMarket.get_markets_from_account_states-244"><a href="#AverMarket.get_markets_from_account_states-244"><span class="linenos">244</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.get_markets_from_account_states-245"><a href="#AverMarket.get_markets_from_account_states-245"><span class="linenos">245</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.get_markets_from_account_states-246"><a href="#AverMarket.get_markets_from_account_states-246"><span class="linenos">246</span></a><span class="sd">            market_pubkeys (list[PublicKey]): List of market public keys</span>
</span><span id="AverMarket.get_markets_from_account_states-247"><a href="#AverMarket.get_markets_from_account_states-247"><span class="linenos">247</span></a><span class="sd">            market_states (list[MarketState]): List of MarketState objects</span>
</span><span id="AverMarket.get_markets_from_account_states-248"><a href="#AverMarket.get_markets_from_account_states-248"><span class="linenos">248</span></a><span class="sd">            market_stores (list[MarketStoreState]): List of MarketStoreState objects</span>
</span><span id="AverMarket.get_markets_from_account_states-249"><a href="#AverMarket.get_markets_from_account_states-249"><span class="linenos">249</span></a><span class="sd">            slabs (list[Slab]): List of slab objects (used in orderbooks)</span>
</span><span id="AverMarket.get_markets_from_account_states-250"><a href="#AverMarket.get_markets_from_account_states-250"><span class="linenos">250</span></a>
</span><span id="AverMarket.get_markets_from_account_states-251"><a href="#AverMarket.get_markets_from_account_states-251"><span class="linenos">251</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.get_markets_from_account_states-252"><a href="#AverMarket.get_markets_from_account_states-252"><span class="linenos">252</span></a><span class="sd">            lst[AverMarket]: List of AverMarket objects</span>
</span><span id="AverMarket.get_markets_from_account_states-253"><a href="#AverMarket.get_markets_from_account_states-253"><span class="linenos">253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.get_markets_from_account_states-254"><a href="#AverMarket.get_markets_from_account_states-254"><span class="linenos">254</span></a>        <span class="n">slab_position_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AverMarket.get_markets_from_account_states-255"><a href="#AverMarket.get_markets_from_account_states-255"><span class="linenos">255</span></a>        <span class="n">all_orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_markets_from_account_states-256"><a href="#AverMarket.get_markets_from_account_states-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">market_store</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_stores</span><span class="p">):</span>
</span><span id="AverMarket.get_markets_from_account_states-257"><a href="#AverMarket.get_markets_from_account_states-257"><span class="linenos">257</span></a>            <span class="n">all_orderbooks_for_market</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_markets_from_account_states-258"><a href="#AverMarket.get_markets_from_account_states-258"><span class="linenos">258</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">market_store</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AverMarket.get_markets_from_account_states-259"><a href="#AverMarket.get_markets_from_account_states-259"><span class="linenos">259</span></a>                <span class="n">all_orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="AverMarket.get_markets_from_account_states-260"><a href="#AverMarket.get_markets_from_account_states-260"><span class="linenos">260</span></a>                <span class="k">continue</span>
</span><span id="AverMarket.get_markets_from_account_states-261"><a href="#AverMarket.get_markets_from_account_states-261"><span class="linenos">261</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">orderbook</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">):</span>
</span><span id="AverMarket.get_markets_from_account_states-262"><a href="#AverMarket.get_markets_from_account_states-262"><span class="linenos">262</span></a>                <span class="n">orderbook</span> <span class="o">=</span> <span class="n">Orderbook</span><span class="p">(</span>
</span><span id="AverMarket.get_markets_from_account_states-263"><a href="#AverMarket.get_markets_from_account_states-263"><span class="linenos">263</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span> 
</span><span id="AverMarket.get_markets_from_account_states-264"><a href="#AverMarket.get_markets_from_account_states-264"><span class="linenos">264</span></a>                    <span class="n">slabs</span><span class="p">[</span><span class="n">slab_position_counter</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="AverMarket.get_markets_from_account_states-265"><a href="#AverMarket.get_markets_from_account_states-265"><span class="linenos">265</span></a>                    <span class="n">slabs</span><span class="p">[</span><span class="n">slab_position_counter</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="AverMarket.get_markets_from_account_states-266"><a href="#AverMarket.get_markets_from_account_states-266"><span class="linenos">266</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">bids</span><span class="p">,</span>
</span><span id="AverMarket.get_markets_from_account_states-267"><a href="#AverMarket.get_markets_from_account_states-267"><span class="linenos">267</span></a>                    <span class="n">orderbook</span><span class="o">.</span><span class="n">asks</span><span class="p">,</span>
</span><span id="AverMarket.get_markets_from_account_states-268"><a href="#AverMarket.get_markets_from_account_states-268"><span class="linenos">268</span></a>                    <span class="n">market_states</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">decimals</span>
</span><span id="AverMarket.get_markets_from_account_states-269"><a href="#AverMarket.get_markets_from_account_states-269"><span class="linenos">269</span></a>                    <span class="p">)</span>
</span><span id="AverMarket.get_markets_from_account_states-270"><a href="#AverMarket.get_markets_from_account_states-270"><span class="linenos">270</span></a>                <span class="n">all_orderbooks_for_market</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbook</span><span class="p">)</span>
</span><span id="AverMarket.get_markets_from_account_states-271"><a href="#AverMarket.get_markets_from_account_states-271"><span class="linenos">271</span></a>            <span class="n">slab_position_counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="AverMarket.get_markets_from_account_states-272"><a href="#AverMarket.get_markets_from_account_states-272"><span class="linenos">272</span></a>            <span class="n">all_orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks_for_market</span><span class="p">)</span>
</span><span id="AverMarket.get_markets_from_account_states-273"><a href="#AverMarket.get_markets_from_account_states-273"><span class="linenos">273</span></a>        
</span><span id="AverMarket.get_markets_from_account_states-274"><a href="#AverMarket.get_markets_from_account_states-274"><span class="linenos">274</span></a>        <span class="n">markets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AverMarket</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_markets_from_account_states-275"><a href="#AverMarket.get_markets_from_account_states-275"><span class="linenos">275</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_pubkeys</span><span class="p">):</span>
</span><span id="AverMarket.get_markets_from_account_states-276"><a href="#AverMarket.get_markets_from_account_states-276"><span class="linenos">276</span></a>            <span class="n">markets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AverMarket</span><span class="p">(</span>
</span><span id="AverMarket.get_markets_from_account_states-277"><a href="#AverMarket.get_markets_from_account_states-277"><span class="linenos">277</span></a>                <span class="n">aver_client</span><span class="p">,</span> 
</span><span id="AverMarket.get_markets_from_account_states-278"><a href="#AverMarket.get_markets_from_account_states-278"><span class="linenos">278</span></a>                <span class="n">m</span><span class="p">,</span> 
</span><span id="AverMarket.get_markets_from_account_states-279"><a href="#AverMarket.get_markets_from_account_states-279"><span class="linenos">279</span></a>                <span class="n">market_states</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="AverMarket.get_markets_from_account_states-280"><a href="#AverMarket.get_markets_from_account_states-280"><span class="linenos">280</span></a>                <span class="n">market_stores</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="AverMarket.get_markets_from_account_states-281"><a href="#AverMarket.get_markets_from_account_states-281"><span class="linenos">281</span></a>                <span class="n">all_orderbooks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AverMarket.get_markets_from_account_states-282"><a href="#AverMarket.get_markets_from_account_states-282"><span class="linenos">282</span></a>                <span class="p">)</span>
</span><span id="AverMarket.get_markets_from_account_states-283"><a href="#AverMarket.get_markets_from_account_states-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="AverMarket.get_markets_from_account_states-284"><a href="#AverMarket.get_markets_from_account_states-284"><span class="linenos">284</span></a>
</span><span id="AverMarket.get_markets_from_account_states-285"><a href="#AverMarket.get_markets_from_account_states-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="n">markets</span>
</span></pre></div>


            <div class="docstring"><p>Returns multiple AverMarket objects from their respective MarketStates, stores and orderbook objects</p>

<p>Used in refresh.py</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_pubkeys (list[PublicKey]):</strong>  List of market public keys</li>
<li><strong>market_states (list[MarketState]):</strong>  List of MarketState objects</li>
<li><strong>market_stores (list[MarketStoreState]):</strong>  List of MarketStoreState objects</li>
<li><strong>slabs (list[Slab]):</strong>  List of slab objects (used in orderbooks)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>lst[AverMarket]: List of AverMarket objects</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.load_market_store_state" class="classattr">
                                        <input id="AverMarket.load_market_store_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">load_market_store_state</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">is_market_status_closed</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">market_store_pubkey</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span></span><span class="return-annotation">) -> <span class="n"><a href="data_classes.html#MarketStoreState">pyaver.data_classes.MarketStoreState</a></span>:</span></span>

                <label class="view-source-button" for="AverMarket.load_market_store_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.load_market_store_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.load_market_store_state-288"><a href="#AverMarket.load_market_store_state-288"><span class="linenos">288</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.load_market_store_state-289"><a href="#AverMarket.load_market_store_state-289"><span class="linenos">289</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_market_store_state</span><span class="p">(</span>
</span><span id="AverMarket.load_market_store_state-290"><a href="#AverMarket.load_market_store_state-290"><span class="linenos">290</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="AverMarket.load_market_store_state-291"><a href="#AverMarket.load_market_store_state-291"><span class="linenos">291</span></a>        <span class="n">is_market_status_closed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="AverMarket.load_market_store_state-292"><a href="#AverMarket.load_market_store_state-292"><span class="linenos">292</span></a>        <span class="n">market_store_pubkey</span><span class="p">:</span> <span class="n">PublicKey</span><span class="p">,</span> 
</span><span id="AverMarket.load_market_store_state-293"><a href="#AverMarket.load_market_store_state-293"><span class="linenos">293</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketStoreState</span><span class="p">:</span>
</span><span id="AverMarket.load_market_store_state-294"><a href="#AverMarket.load_market_store_state-294"><span class="linenos">294</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.load_market_store_state-295"><a href="#AverMarket.load_market_store_state-295"><span class="linenos">295</span></a><span class="sd">        Loads onchain data for a MarketStore State</span>
</span><span id="AverMarket.load_market_store_state-296"><a href="#AverMarket.load_market_store_state-296"><span class="linenos">296</span></a>
</span><span id="AverMarket.load_market_store_state-297"><a href="#AverMarket.load_market_store_state-297"><span class="linenos">297</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.load_market_store_state-298"><a href="#AverMarket.load_market_store_state-298"><span class="linenos">298</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.load_market_store_state-299"><a href="#AverMarket.load_market_store_state-299"><span class="linenos">299</span></a><span class="sd">            is_market_status_closed (bool): True if market status is closed, voided or resolved</span>
</span><span id="AverMarket.load_market_store_state-300"><a href="#AverMarket.load_market_store_state-300"><span class="linenos">300</span></a><span class="sd">            market_store_pubkey (PublicKey): MarketStore public key</span>
</span><span id="AverMarket.load_market_store_state-301"><a href="#AverMarket.load_market_store_state-301"><span class="linenos">301</span></a>
</span><span id="AverMarket.load_market_store_state-302"><a href="#AverMarket.load_market_store_state-302"><span class="linenos">302</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.load_market_store_state-303"><a href="#AverMarket.load_market_store_state-303"><span class="linenos">303</span></a><span class="sd">            MarketStoreState: MarketStoreStateobject</span>
</span><span id="AverMarket.load_market_store_state-304"><a href="#AverMarket.load_market_store_state-304"><span class="linenos">304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.load_market_store_state-305"><a href="#AverMarket.load_market_store_state-305"><span class="linenos">305</span></a>        <span class="c1">#Closed markets do not have orderbooks</span>
</span><span id="AverMarket.load_market_store_state-306"><a href="#AverMarket.load_market_store_state-306"><span class="linenos">306</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">is_market_status_closed</span><span class="p">):</span>
</span><span id="AverMarket.load_market_store_state-307"><a href="#AverMarket.load_market_store_state-307"><span class="linenos">307</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="AverMarket.load_market_store_state-308"><a href="#AverMarket.load_market_store_state-308"><span class="linenos">308</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;MarketStore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">market_store_pubkey</span><span class="p">)</span>
</span><span id="AverMarket.load_market_store_state-309"><a href="#AverMarket.load_market_store_state-309"><span class="linenos">309</span></a>        <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Loads onchain data for a MarketStore State</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>is_market_status_closed (bool):</strong>  True if market status is closed, voided or resolved</li>
<li><strong>market_store_pubkey (PublicKey):</strong>  MarketStore public key</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>MarketStoreState: MarketStoreStateobject</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.load_multiple_market_store_states" class="classattr">
                                        <input id="AverMarket.load_multiple_market_store_states-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">load_multiple_market_store_states</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">aver_client</span><span class="p">:</span> <span class="n"><a href="aver_client.html#AverClient">pyaver.aver_client.AverClient</a></span>,</span><span class="param">	<span class="n">market_store_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="data_classes.html#MarketStoreState">pyaver.data_classes.MarketStoreState</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AverMarket.load_multiple_market_store_states-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.load_multiple_market_store_states"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.load_multiple_market_store_states-312"><a href="#AverMarket.load_multiple_market_store_states-312"><span class="linenos">312</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.load_multiple_market_store_states-313"><a href="#AverMarket.load_multiple_market_store_states-313"><span class="linenos">313</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">load_multiple_market_store_states</span><span class="p">(</span>
</span><span id="AverMarket.load_multiple_market_store_states-314"><a href="#AverMarket.load_multiple_market_store_states-314"><span class="linenos">314</span></a>        <span class="n">aver_client</span><span class="p">:</span> <span class="n">AverClient</span><span class="p">,</span> 
</span><span id="AverMarket.load_multiple_market_store_states-315"><a href="#AverMarket.load_multiple_market_store_states-315"><span class="linenos">315</span></a>        <span class="n">market_store_pubkeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span> 
</span><span id="AverMarket.load_multiple_market_store_states-316"><a href="#AverMarket.load_multiple_market_store_states-316"><span class="linenos">316</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">]:</span>
</span><span id="AverMarket.load_multiple_market_store_states-317"><a href="#AverMarket.load_multiple_market_store_states-317"><span class="linenos">317</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.load_multiple_market_store_states-318"><a href="#AverMarket.load_multiple_market_store_states-318"><span class="linenos">318</span></a><span class="sd">        Loads onchain data for multiple MarketStore States</span>
</span><span id="AverMarket.load_multiple_market_store_states-319"><a href="#AverMarket.load_multiple_market_store_states-319"><span class="linenos">319</span></a>
</span><span id="AverMarket.load_multiple_market_store_states-320"><a href="#AverMarket.load_multiple_market_store_states-320"><span class="linenos">320</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.load_multiple_market_store_states-321"><a href="#AverMarket.load_multiple_market_store_states-321"><span class="linenos">321</span></a><span class="sd">            aver_client (AverClient): AverClient object</span>
</span><span id="AverMarket.load_multiple_market_store_states-322"><a href="#AverMarket.load_multiple_market_store_states-322"><span class="linenos">322</span></a><span class="sd">            market_store_pubkeys (list[PublicKey]): List of MarketStore public keys</span>
</span><span id="AverMarket.load_multiple_market_store_states-323"><a href="#AverMarket.load_multiple_market_store_states-323"><span class="linenos">323</span></a>
</span><span id="AverMarket.load_multiple_market_store_states-324"><a href="#AverMarket.load_multiple_market_store_states-324"><span class="linenos">324</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.load_multiple_market_store_states-325"><a href="#AverMarket.load_multiple_market_store_states-325"><span class="linenos">325</span></a><span class="sd">            list[MarketStoreState]: List of MarketStore public keys</span>
</span><span id="AverMarket.load_multiple_market_store_states-326"><a href="#AverMarket.load_multiple_market_store_states-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.load_multiple_market_store_states-327"><a href="#AverMarket.load_multiple_market_store_states-327"><span class="linenos">327</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;MarketStore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch_multiple</span><span class="p">(</span><span class="n">market_store_pubkeys</span><span class="p">)</span>
</span><span id="AverMarket.load_multiple_market_store_states-328"><a href="#AverMarket.load_multiple_market_store_states-328"><span class="linenos">328</span></a>        <span class="k">return</span> <span class="n">res</span>       
</span></pre></div>


            <div class="docstring"><p>Loads onchain data for multiple MarketStore States</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>aver_client (AverClient):</strong>  AverClient object</li>
<li><strong>market_store_pubkeys (list[PublicKey]):</strong>  List of MarketStore public keys</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list[MarketStoreState]: List of MarketStore public keys</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.is_market_status_closed" class="classattr">
                                        <input id="AverMarket.is_market_status_closed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">is_market_status_closed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">market_status</span><span class="p">:</span> <span class="n"><a href="enums.html#MarketStatus">pyaver.enums.MarketStatus</a></span></span>)</span>

                <label class="view-source-button" for="AverMarket.is_market_status_closed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.is_market_status_closed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.is_market_status_closed-330"><a href="#AverMarket.is_market_status_closed-330"><span class="linenos">330</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.is_market_status_closed-331"><a href="#AverMarket.is_market_status_closed-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="nf">is_market_status_closed</span><span class="p">(</span><span class="n">market_status</span><span class="p">:</span> <span class="n">MarketStatus</span><span class="p">):</span>
</span><span id="AverMarket.is_market_status_closed-332"><a href="#AverMarket.is_market_status_closed-332"><span class="linenos">332</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.is_market_status_closed-333"><a href="#AverMarket.is_market_status_closed-333"><span class="linenos">333</span></a><span class="sd">        Checks if a market no longer in a trading status, and therefore will have no Orderbook or MarketStore accounts.</span>
</span><span id="AverMarket.is_market_status_closed-334"><a href="#AverMarket.is_market_status_closed-334"><span class="linenos">334</span></a><span class="sd">        Note: Once trading has ceased for a market, these accounts are closed.</span>
</span><span id="AverMarket.is_market_status_closed-335"><a href="#AverMarket.is_market_status_closed-335"><span class="linenos">335</span></a>
</span><span id="AverMarket.is_market_status_closed-336"><a href="#AverMarket.is_market_status_closed-336"><span class="linenos">336</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.is_market_status_closed-337"><a href="#AverMarket.is_market_status_closed-337"><span class="linenos">337</span></a><span class="sd">            market_status (MarketStatus): Market status (find in MarketState object)</span>
</span><span id="AverMarket.is_market_status_closed-338"><a href="#AverMarket.is_market_status_closed-338"><span class="linenos">338</span></a>
</span><span id="AverMarket.is_market_status_closed-339"><a href="#AverMarket.is_market_status_closed-339"><span class="linenos">339</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.is_market_status_closed-340"><a href="#AverMarket.is_market_status_closed-340"><span class="linenos">340</span></a><span class="sd">            bool: Market status closed</span>
</span><span id="AverMarket.is_market_status_closed-341"><a href="#AverMarket.is_market_status_closed-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.is_market_status_closed-342"><a href="#AverMarket.is_market_status_closed-342"><span class="linenos">342</span></a>        <span class="k">return</span> <span class="n">market_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MarketStatus</span><span class="o">.</span><span class="n">CEASED_CRANKED_CLOSED</span><span class="p">,</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">RESOLVED</span><span class="p">,</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">VOIDED</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Checks if a market no longer in a trading status, and therefore will have no Orderbook or MarketStore accounts.
Note: Once trading has ceased for a market, these accounts are closed.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>market_status (MarketStatus):</strong>  Market status (find in MarketState object)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>bool: Market status closed</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.get_orderbooks_from_orderbook_accounts" class="classattr">
                                        <input id="AverMarket.get_orderbooks_from_orderbook_accounts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">get_orderbooks_from_orderbook_accounts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">conn</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">rpc</span><span class="o">.</span><span class="n">async_api</span><span class="o">.</span><span class="n">AsyncClient</span>,</span><span class="param">	<span class="n">orderbook_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="data_classes.html#OrderbookAccountsState">pyaver.data_classes.OrderbookAccountsState</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">decimals_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="orderbook.html#Orderbook">pyaver.orderbook.Orderbook</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AverMarket.get_orderbooks_from_orderbook_accounts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.get_orderbooks_from_orderbook_accounts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-344"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-344"><span class="linenos">344</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-345"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-345"><span class="linenos">345</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-346"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-346"><span class="linenos">346</span></a>        <span class="n">conn</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span> 
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-347"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-347"><span class="linenos">347</span></a>        <span class="n">orderbook_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">OrderbookAccountsState</span><span class="p">],</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-348"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-348"><span class="linenos">348</span></a>        <span class="n">decimals_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-349"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-349"><span class="linenos">349</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]:</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-350"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-350"><span class="linenos">350</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-351"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-351"><span class="linenos">351</span></a><span class="sd">        Returns Orderbook objects from Orderbook Account objects, by fetching and parsing. </span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-352"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-352"><span class="linenos">352</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-353"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-353"><span class="linenos">353</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-354"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-354"><span class="linenos">354</span></a><span class="sd">            conn (AsyncClient): Solana AsyncClient object</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-355"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-355"><span class="linenos">355</span></a><span class="sd">            orderbook_accounts (list[OrderbookAccountsState]): List of orderbook account objects</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-356"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-356"><span class="linenos">356</span></a><span class="sd">            decimals_list (list[int]): List of decimal precision for each orderbook account state. Variable normally found in MarketState object</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-357"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-357"><span class="linenos">357</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-358"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-358"><span class="linenos">358</span></a><span class="sd">        Raises:</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-359"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-359"><span class="linenos">359</span></a><span class="sd">            Exception: Decimals list and orderbook accounts do not have the same length</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-360"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-360"><span class="linenos">360</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-361"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-361"><span class="linenos">361</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-362"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-362"><span class="linenos">362</span></a><span class="sd">            list[Orderbook]: List of orderbook objects</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-363"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-363"><span class="linenos">363</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-364"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-364"><span class="linenos">364</span></a>        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decimals_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orderbook_accounts</span><span class="p">)):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-365"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-365"><span class="linenos">365</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;decimals_list and orderbook_accounts should have the same length&#39;</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-366"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-366"><span class="linenos">366</span></a>        
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-367"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-367"><span class="linenos">367</span></a>        <span class="n">all_bids_and_asks_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-368"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-368"><span class="linenos">368</span></a>        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">orderbook_accounts</span><span class="p">:</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-369"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-369"><span class="linenos">369</span></a>            <span class="n">all_bids_and_asks_accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">bids</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-370"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-370"><span class="linenos">370</span></a>            <span class="n">all_bids_and_asks_accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">asks</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-371"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-371"><span class="linenos">371</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-372"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-372"><span class="linenos">372</span></a>        
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-373"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-373"><span class="linenos">373</span></a>        <span class="n">all_slabs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Orderbook</span><span class="o">.</span><span class="n">load_multiple_slabs</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">all_bids_and_asks_accounts</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-374"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-374"><span class="linenos">374</span></a>        <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-375"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-375"><span class="linenos">375</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-376"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-376"><span class="linenos">376</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orderbook_accounts</span><span class="p">):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-377"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-377"><span class="linenos">377</span></a>            <span class="n">orderbook</span> <span class="o">=</span> <span class="n">Orderbook</span><span class="p">(</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-378"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-378"><span class="linenos">378</span></a>                <span class="n">o</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span> 
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-379"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-379"><span class="linenos">379</span></a>                <span class="n">all_slabs</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> 
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-380"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-380"><span class="linenos">380</span></a>                <span class="n">all_slabs</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> 
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-381"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-381"><span class="linenos">381</span></a>                <span class="n">o</span><span class="o">.</span><span class="n">bids</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">asks</span><span class="p">,</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-382"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-382"><span class="linenos">382</span></a>                <span class="n">decimals_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-383"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-383"><span class="linenos">383</span></a>                <span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-384"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-384"><span class="linenos">384</span></a>            <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbook</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts-385"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="n">orderbooks</span>
</span></pre></div>


            <div class="docstring"><p>Returns Orderbook objects from Orderbook Account objects, by fetching and parsing. </p>

<h6 id="args">Args</h6>

<ul>
<li><strong>conn (AsyncClient):</strong>  Solana AsyncClient object</li>
<li><strong>orderbook_accounts (list[OrderbookAccountsState]):</strong>  List of orderbook account objects</li>
<li><strong>decimals_list (list[int]):</strong>  List of decimal precision for each orderbook account state. Variable normally found in MarketState object</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>Exception:</strong>  Decimals list and orderbook accounts do not have the same length</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list[Orderbook]: List of orderbook objects</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets" class="classattr">
                                        <input id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">async def</span>
        <span class="name">get_orderbooks_from_orderbook_accounts_multiple_markets</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">conn</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">rpc</span><span class="o">.</span><span class="n">async_api</span><span class="o">.</span><span class="n">AsyncClient</span>,</span><span class="param">	<span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="data_classes.html#MarketState">pyaver.data_classes.MarketState</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="data_classes.html#MarketStoreState">pyaver.data_classes.MarketStoreState</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">are_market_statuses_closed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-389"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-389"><span class="linenos">389</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-390"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-390"><span class="linenos">390</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_orderbooks_from_orderbook_accounts_multiple_markets</span><span class="p">(</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-391"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-391"><span class="linenos">391</span></a>        <span class="n">conn</span><span class="p">:</span> <span class="n">AsyncClient</span><span class="p">,</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-392"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-392"><span class="linenos">392</span></a>        <span class="n">market_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketState</span><span class="p">],</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-393"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-393"><span class="linenos">393</span></a>        <span class="n">market_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MarketStoreState</span><span class="p">],</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-394"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-394"><span class="linenos">394</span></a>        <span class="n">are_market_statuses_closed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-395"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-395"><span class="linenos">395</span></a>    <span class="p">):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-396"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-396"><span class="linenos">396</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-397"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-397"><span class="linenos">397</span></a><span class="sd">        Returns Orderbook objects from MarketState and MarketStoreStateobjects,</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-398"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-398"><span class="linenos">398</span></a><span class="sd">        by fetching and parsing for multiple markets.</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-399"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-399"><span class="linenos">399</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-400"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-400"><span class="linenos">400</span></a><span class="sd">        Use when fetching orderbooks for multiple markets </span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-401"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-401"><span class="linenos">401</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-402"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-402"><span class="linenos">402</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-403"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-403"><span class="linenos">403</span></a><span class="sd">            conn (AsyncClient): Solana AsyncClient object</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-404"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-404"><span class="linenos">404</span></a><span class="sd">            market_states (list[MarketState]): List of MarketState objects</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-405"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-405"><span class="linenos">405</span></a><span class="sd">            market_stores (list[MarketStoreState]): List of MarketStoreStateobjects</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-406"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-406"><span class="linenos">406</span></a><span class="sd">            are_market_statuses_closed (list[bool]): Lists if each market is closed or not</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-407"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-407"><span class="linenos">407</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-408"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-408"><span class="linenos">408</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-409"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-409"><span class="linenos">409</span></a><span class="sd">            list[list[Orderbook]]: List of orderbooks for each market</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-410"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-410"><span class="linenos">410</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-411"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-411"><span class="linenos">411</span></a>        <span class="c1">#Create list of accounts and the decimals for each account</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-412"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-412"><span class="linenos">412</span></a>        <span class="n">orderbook_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-413"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-413"><span class="linenos">413</span></a>        <span class="n">decimals_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-414"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-414"><span class="linenos">414</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_store</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_stores</span><span class="p">):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-415"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-415"><span class="linenos">415</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">market_store</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-416"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-416"><span class="linenos">416</span></a>                <span class="k">continue</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-417"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-417"><span class="linenos">417</span></a>            <span class="n">orderbook_accounts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-418"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-418"><span class="linenos">418</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">market_store</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">)):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-419"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-419"><span class="linenos">419</span></a>                <span class="n">decimals_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">market_states</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">decimals</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-420"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-420"><span class="linenos">420</span></a>        
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-421"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-421"><span class="linenos">421</span></a>        <span class="c1">#Load all orderbooks</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-422"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-422"><span class="linenos">422</span></a>        <span class="n">all_orderbooks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Orderbook</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AverMarket</span><span class="o">.</span><span class="n">get_orderbooks_from_orderbook_accounts</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">orderbook_accounts</span><span class="p">,</span> <span class="n">decimals_list</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-423"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-423"><span class="linenos">423</span></a>        <span class="n">orderbooks_market_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-424"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-424"><span class="linenos">424</span></a>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-425"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-425"><span class="linenos">425</span></a>        <span class="c1">#Create a list for each market we received. The list contains all orderbooks for that market</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-426"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-426"><span class="linenos">426</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">market_state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">market_states</span><span class="p">):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-427"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-427"><span class="linenos">427</span></a>            <span class="n">number_of_outcomes</span> <span class="o">=</span> <span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-428"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-428"><span class="linenos">428</span></a>            <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-429"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-429"><span class="linenos">429</span></a>            <span class="c1">#Market is closed</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-430"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-430"><span class="linenos">430</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">are_market_statuses_closed</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-431"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-431"><span class="linenos">431</span></a>                <span class="n">orderbooks_market_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-432"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-432"><span class="linenos">432</span></a>                <span class="k">continue</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-433"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-433"><span class="linenos">433</span></a>            <span class="c1">#Binary markets only have 1 orderbook</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-434"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-434"><span class="linenos">434</span></a>            <span class="k">if</span><span class="p">(</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-435"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-435"><span class="linenos">435</span></a>                <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-436"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-436"><span class="linenos">436</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-437"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-437"><span class="linenos">437</span></a>                <span class="n">orderbooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-438"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-438"><span class="linenos">438</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_outcomes</span><span class="p">):</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-439"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-439"><span class="linenos">439</span></a>                    <span class="n">orderbooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_orderbooks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-440"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-440"><span class="linenos">440</span></a>            <span class="n">orderbooks_market_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderbooks</span><span class="p">)</span>
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-441"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-441"><span class="linenos">441</span></a>        
</span><span id="AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-442"><a href="#AverMarket.get_orderbooks_from_orderbook_accounts_multiple_markets-442"><span class="linenos">442</span></a>        <span class="k">return</span> <span class="n">orderbooks_market_list</span>
</span></pre></div>


            <div class="docstring"><p>Returns Orderbook objects from MarketState and MarketStoreStateobjects,
by fetching and parsing for multiple markets.</p>

<p>Use when fetching orderbooks for multiple markets </p>

<h6 id="args">Args</h6>

<ul>
<li><strong>conn (AsyncClient):</strong>  Solana AsyncClient object</li>
<li><strong>market_states (list[MarketState]):</strong>  List of MarketState objects</li>
<li><strong>market_stores (list[MarketStoreState]):</strong>  List of MarketStoreStateobjects</li>
<li><strong>are_market_statuses_closed (list[bool]):</strong>  Lists if each market is closed or not</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list[list[Orderbook]]: List of orderbooks for each market</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.make_sweep_fees_instruction" class="classattr">
                                        <input id="AverMarket.make_sweep_fees_instruction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_sweep_fees_instruction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="AverMarket.make_sweep_fees_instruction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.make_sweep_fees_instruction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.make_sweep_fees_instruction-445"><a href="#AverMarket.make_sweep_fees_instruction-445"><span class="linenos">445</span></a>    <span class="k">def</span> <span class="nf">make_sweep_fees_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AverMarket.make_sweep_fees_instruction-446"><a href="#AverMarket.make_sweep_fees_instruction-446"><span class="linenos">446</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.make_sweep_fees_instruction-447"><a href="#AverMarket.make_sweep_fees_instruction-447"><span class="linenos">447</span></a><span class="sd">        Creates instruction to sweeps fees and sends to relevant accounts</span>
</span><span id="AverMarket.make_sweep_fees_instruction-448"><a href="#AverMarket.make_sweep_fees_instruction-448"><span class="linenos">448</span></a>
</span><span id="AverMarket.make_sweep_fees_instruction-449"><a href="#AverMarket.make_sweep_fees_instruction-449"><span class="linenos">449</span></a><span class="sd">        Returns TransactionInstruction object only. Does not send transaction.</span>
</span><span id="AverMarket.make_sweep_fees_instruction-450"><a href="#AverMarket.make_sweep_fees_instruction-450"><span class="linenos">450</span></a>
</span><span id="AverMarket.make_sweep_fees_instruction-451"><a href="#AverMarket.make_sweep_fees_instruction-451"><span class="linenos">451</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.make_sweep_fees_instruction-452"><a href="#AverMarket.make_sweep_fees_instruction-452"><span class="linenos">452</span></a><span class="sd">            TransactionInstruction: TransactionInstruction object</span>
</span><span id="AverMarket.make_sweep_fees_instruction-453"><a href="#AverMarket.make_sweep_fees_instruction-453"><span class="linenos">453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.make_sweep_fees_instruction-454"><a href="#AverMarket.make_sweep_fees_instruction-454"><span class="linenos">454</span></a>        <span class="n">quote_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">quote_token</span>
</span><span id="AverMarket.make_sweep_fees_instruction-455"><a href="#AverMarket.make_sweep_fees_instruction-455"><span class="linenos">455</span></a>        <span class="n">third_party_vault_authority</span><span class="p">,</span> <span class="n">bump</span> <span class="o">=</span> <span class="n">PublicKey</span><span class="o">.</span><span class="n">find_program_address</span><span class="p">(</span>
</span><span id="AverMarket.make_sweep_fees_instruction-456"><a href="#AverMarket.make_sweep_fees_instruction-456"><span class="linenos">456</span></a>            <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;third-party-token-vault&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">quote_token</span><span class="p">)],</span> <span class="n">AVER_PROGRAM_ID</span><span class="p">)</span>
</span><span id="AverMarket.make_sweep_fees_instruction-457"><a href="#AverMarket.make_sweep_fees_instruction-457"><span class="linenos">457</span></a>
</span><span id="AverMarket.make_sweep_fees_instruction-458"><a href="#AverMarket.make_sweep_fees_instruction-458"><span class="linenos">458</span></a>        <span class="n">third_party_vault_token_account</span> <span class="o">=</span> <span class="n">get_associated_token_address</span><span class="p">(</span>
</span><span id="AverMarket.make_sweep_fees_instruction-459"><a href="#AverMarket.make_sweep_fees_instruction-459"><span class="linenos">459</span></a>            <span class="n">third_party_vault_authority</span><span class="p">,</span> <span class="n">quote_token</span><span class="p">)</span>
</span><span id="AverMarket.make_sweep_fees_instruction-460"><a href="#AverMarket.make_sweep_fees_instruction-460"><span class="linenos">460</span></a>
</span><span id="AverMarket.make_sweep_fees_instruction-461"><a href="#AverMarket.make_sweep_fees_instruction-461"><span class="linenos">461</span></a>        <span class="n">aver_quote_token_account</span> <span class="o">=</span> <span class="n">get_associated_token_address</span><span class="p">(</span>
</span><span id="AverMarket.make_sweep_fees_instruction-462"><a href="#AverMarket.make_sweep_fees_instruction-462"><span class="linenos">462</span></a>            <span class="n">AVER_MARKET_AUTHORITY</span><span class="p">,</span> <span class="n">quote_token</span>
</span><span id="AverMarket.make_sweep_fees_instruction-463"><a href="#AverMarket.make_sweep_fees_instruction-463"><span class="linenos">463</span></a>        <span class="p">)</span>
</span><span id="AverMarket.make_sweep_fees_instruction-464"><a href="#AverMarket.make_sweep_fees_instruction-464"><span class="linenos">464</span></a>
</span><span id="AverMarket.make_sweep_fees_instruction-465"><a href="#AverMarket.make_sweep_fees_instruction-465"><span class="linenos">465</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">instruction</span><span class="p">[</span><span class="s2">&quot;sweep_fees&quot;</span><span class="p">](</span>
</span><span id="AverMarket.make_sweep_fees_instruction-466"><a href="#AverMarket.make_sweep_fees_instruction-466"><span class="linenos">466</span></a>            <span class="n">ctx</span><span class="o">=</span><span class="n">Context</span><span class="p">(</span>
</span><span id="AverMarket.make_sweep_fees_instruction-467"><a href="#AverMarket.make_sweep_fees_instruction-467"><span class="linenos">467</span></a>                <span class="n">accounts</span><span class="o">=</span><span class="p">{</span>
</span><span id="AverMarket.make_sweep_fees_instruction-468"><a href="#AverMarket.make_sweep_fees_instruction-468"><span class="linenos">468</span></a>                    <span class="s2">&quot;market&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="AverMarket.make_sweep_fees_instruction-469"><a href="#AverMarket.make_sweep_fees_instruction-469"><span class="linenos">469</span></a>                    <span class="s2">&quot;quote_vault&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">quote_vault</span><span class="p">,</span>
</span><span id="AverMarket.make_sweep_fees_instruction-470"><a href="#AverMarket.make_sweep_fees_instruction-470"><span class="linenos">470</span></a>                    <span class="s2">&quot;vault_authority&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">vault_authority</span><span class="p">,</span>
</span><span id="AverMarket.make_sweep_fees_instruction-471"><a href="#AverMarket.make_sweep_fees_instruction-471"><span class="linenos">471</span></a>                    <span class="s2">&quot;third_party_token_vault&quot;</span><span class="p">:</span> <span class="n">third_party_vault_token_account</span><span class="p">,</span>
</span><span id="AverMarket.make_sweep_fees_instruction-472"><a href="#AverMarket.make_sweep_fees_instruction-472"><span class="linenos">472</span></a>                    <span class="s2">&quot;aver_quote_token_account&quot;</span><span class="p">:</span> <span class="n">aver_quote_token_account</span><span class="p">,</span>
</span><span id="AverMarket.make_sweep_fees_instruction-473"><a href="#AverMarket.make_sweep_fees_instruction-473"><span class="linenos">473</span></a>                    <span class="s2">&quot;spl_token_program&quot;</span><span class="p">:</span> <span class="n">TOKEN_PROGRAM_ID</span><span class="p">,</span>
</span><span id="AverMarket.make_sweep_fees_instruction-474"><a href="#AverMarket.make_sweep_fees_instruction-474"><span class="linenos">474</span></a>                <span class="p">},</span>
</span><span id="AverMarket.make_sweep_fees_instruction-475"><a href="#AverMarket.make_sweep_fees_instruction-475"><span class="linenos">475</span></a>                <span class="n">signers</span><span class="o">=</span><span class="p">[],</span>
</span><span id="AverMarket.make_sweep_fees_instruction-476"><a href="#AverMarket.make_sweep_fees_instruction-476"><span class="linenos">476</span></a>            <span class="p">),</span>
</span><span id="AverMarket.make_sweep_fees_instruction-477"><a href="#AverMarket.make_sweep_fees_instruction-477"><span class="linenos">477</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates instruction to sweeps fees and sends to relevant accounts</p>

<p>Returns TransactionInstruction object only. Does not send transaction.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>TransactionInstruction: TransactionInstruction object</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.sweep_fees" class="classattr">
                                        <input id="AverMarket.sweep_fees-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">sweep_fees</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fee_payer</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">keypair</span><span class="o">.</span><span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">send_options</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">rpc</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TxOpts</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="AverMarket.sweep_fees-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.sweep_fees"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.sweep_fees-479"><a href="#AverMarket.sweep_fees-479"><span class="linenos">479</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">sweep_fees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fee_payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">send_options</span><span class="p">:</span> <span class="n">TxOpts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,):</span>
</span><span id="AverMarket.sweep_fees-480"><a href="#AverMarket.sweep_fees-480"><span class="linenos">480</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.sweep_fees-481"><a href="#AverMarket.sweep_fees-481"><span class="linenos">481</span></a><span class="sd">        Sweeps fees and sends to relevant accounts</span>
</span><span id="AverMarket.sweep_fees-482"><a href="#AverMarket.sweep_fees-482"><span class="linenos">482</span></a>
</span><span id="AverMarket.sweep_fees-483"><a href="#AverMarket.sweep_fees-483"><span class="linenos">483</span></a><span class="sd">        Sends instructions on chain</span>
</span><span id="AverMarket.sweep_fees-484"><a href="#AverMarket.sweep_fees-484"><span class="linenos">484</span></a>
</span><span id="AverMarket.sweep_fees-485"><a href="#AverMarket.sweep_fees-485"><span class="linenos">485</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.sweep_fees-486"><a href="#AverMarket.sweep_fees-486"><span class="linenos">486</span></a><span class="sd">            fee_payer (Keypair): Pays transaction fees. Defaults to AverClient wallet</span>
</span><span id="AverMarket.sweep_fees-487"><a href="#AverMarket.sweep_fees-487"><span class="linenos">487</span></a><span class="sd">            send_options (TxOpts, optional): Options to specify when broadcasting a transaction. Defaults to None.</span>
</span><span id="AverMarket.sweep_fees-488"><a href="#AverMarket.sweep_fees-488"><span class="linenos">488</span></a>
</span><span id="AverMarket.sweep_fees-489"><a href="#AverMarket.sweep_fees-489"><span class="linenos">489</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.sweep_fees-490"><a href="#AverMarket.sweep_fees-490"><span class="linenos">490</span></a><span class="sd">            RPCResponse: Response</span>
</span><span id="AverMarket.sweep_fees-491"><a href="#AverMarket.sweep_fees-491"><span class="linenos">491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.sweep_fees-492"><a href="#AverMarket.sweep_fees-492"><span class="linenos">492</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">fee_payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AverMarket.sweep_fees-493"><a href="#AverMarket.sweep_fees-493"><span class="linenos">493</span></a>            <span class="n">fee_payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="AverMarket.sweep_fees-494"><a href="#AverMarket.sweep_fees-494"><span class="linenos">494</span></a>
</span><span id="AverMarket.sweep_fees-495"><a href="#AverMarket.sweep_fees-495"><span class="linenos">495</span></a>        <span class="n">ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_sweep_fees_instruction</span><span class="p">()</span>
</span><span id="AverMarket.sweep_fees-496"><a href="#AverMarket.sweep_fees-496"><span class="linenos">496</span></a>
</span><span id="AverMarket.sweep_fees-497"><a href="#AverMarket.sweep_fees-497"><span class="linenos">497</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">sign_and_send_transaction_instructions</span><span class="p">(</span>
</span><span id="AverMarket.sweep_fees-498"><a href="#AverMarket.sweep_fees-498"><span class="linenos">498</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="p">,</span>
</span><span id="AverMarket.sweep_fees-499"><a href="#AverMarket.sweep_fees-499"><span class="linenos">499</span></a>            <span class="p">[],</span>
</span><span id="AverMarket.sweep_fees-500"><a href="#AverMarket.sweep_fees-500"><span class="linenos">500</span></a>            <span class="n">fee_payer</span><span class="p">,</span>
</span><span id="AverMarket.sweep_fees-501"><a href="#AverMarket.sweep_fees-501"><span class="linenos">501</span></a>            <span class="p">[</span><span class="n">ix</span><span class="p">],</span>
</span><span id="AverMarket.sweep_fees-502"><a href="#AverMarket.sweep_fees-502"><span class="linenos">502</span></a>            <span class="n">send_options</span>
</span><span id="AverMarket.sweep_fees-503"><a href="#AverMarket.sweep_fees-503"><span class="linenos">503</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sweeps fees and sends to relevant accounts</p>

<p>Sends instructions on chain</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>fee_payer (Keypair):</strong>  Pays transaction fees. Defaults to AverClient wallet</li>
<li><strong>send_options (TxOpts, optional):</strong>  Options to specify when broadcasting a transaction. Defaults to None.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>RPCResponse: Response</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.list_all_pubkeys" class="classattr">
                                        <input id="AverMarket.list_all_pubkeys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_all_pubkeys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="AverMarket.list_all_pubkeys-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.list_all_pubkeys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.list_all_pubkeys-505"><a href="#AverMarket.list_all_pubkeys-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="nf">list_all_pubkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AverMarket.list_all_pubkeys-506"><a href="#AverMarket.list_all_pubkeys-506"><span class="linenos">506</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.list_all_pubkeys-507"><a href="#AverMarket.list_all_pubkeys-507"><span class="linenos">507</span></a><span class="sd">        Returns all pubkeys used in AverMarket object</span>
</span><span id="AverMarket.list_all_pubkeys-508"><a href="#AverMarket.list_all_pubkeys-508"><span class="linenos">508</span></a>
</span><span id="AverMarket.list_all_pubkeys-509"><a href="#AverMarket.list_all_pubkeys-509"><span class="linenos">509</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.list_all_pubkeys-510"><a href="#AverMarket.list_all_pubkeys-510"><span class="linenos">510</span></a><span class="sd">            list[PublicKey]: List of public keys</span>
</span><span id="AverMarket.list_all_pubkeys-511"><a href="#AverMarket.list_all_pubkeys-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.list_all_pubkeys-512"><a href="#AverMarket.list_all_pubkeys-512"><span class="linenos">512</span></a>        <span class="n">list_of_pubkeys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">quote_vault</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">oracle_feed</span><span class="p">]</span>
</span><span id="AverMarket.list_all_pubkeys-513"><a href="#AverMarket.list_all_pubkeys-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_market_status_closed</span><span class="p">:</span>
</span><span id="AverMarket.list_all_pubkeys-514"><a href="#AverMarket.list_all_pubkeys-514"><span class="linenos">514</span></a>            <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderbooks</span><span class="p">:</span>
</span><span id="AverMarket.list_all_pubkeys-515"><a href="#AverMarket.list_all_pubkeys-515"><span class="linenos">515</span></a>                <span class="n">list_of_pubkeys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ob</span><span class="o">.</span><span class="n">pubkey</span><span class="p">,</span> <span class="n">ob</span><span class="o">.</span><span class="n">slab_asks_pubkey</span><span class="p">,</span> <span class="n">ob</span><span class="o">.</span><span class="n">slab_asks_pubkey</span><span class="p">]</span>
</span><span id="AverMarket.list_all_pubkeys-516"><a href="#AverMarket.list_all_pubkeys-516"><span class="linenos">516</span></a>        <span class="k">return</span> <span class="n">list_of_pubkeys</span>
</span></pre></div>


            <div class="docstring"><p>Returns all pubkeys used in AverMarket object</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list[PublicKey]: List of public keys</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.get_implied_market_status" class="classattr">
                                        <input id="AverMarket.get_implied_market_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_implied_market_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="enums.html#MarketStatus">pyaver.enums.MarketStatus</a></span>:</span></span>

                <label class="view-source-button" for="AverMarket.get_implied_market_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.get_implied_market_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.get_implied_market_status-518"><a href="#AverMarket.get_implied_market_status-518"><span class="linenos">518</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_implied_market_status</span><span class="p">(</span>
</span><span id="AverMarket.get_implied_market_status-519"><a href="#AverMarket.get_implied_market_status-519"><span class="linenos">519</span></a>            <span class="bp">self</span>
</span><span id="AverMarket.get_implied_market_status-520"><a href="#AverMarket.get_implied_market_status-520"><span class="linenos">520</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MarketStatus</span><span class="p">:</span>
</span><span id="AverMarket.get_implied_market_status-521"><a href="#AverMarket.get_implied_market_status-521"><span class="linenos">521</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.get_implied_market_status-522"><a href="#AverMarket.get_implied_market_status-522"><span class="linenos">522</span></a><span class="sd">        Returns what we believe the market status ought to be (rather than what is stored in the market&#39;s state on-chain)</span>
</span><span id="AverMarket.get_implied_market_status-523"><a href="#AverMarket.get_implied_market_status-523"><span class="linenos">523</span></a>
</span><span id="AverMarket.get_implied_market_status-524"><a href="#AverMarket.get_implied_market_status-524"><span class="linenos">524</span></a><span class="sd">        Note: As a fail safe, markets have specified times beyond which the market will react as if it is in another Status until it is formally cranked to that Status.</span>
</span><span id="AverMarket.get_implied_market_status-525"><a href="#AverMarket.get_implied_market_status-525"><span class="linenos">525</span></a><span class="sd">        For example, if Solana were to have issues and it was not possible for the market&#39;s authority to crank it into In-Play status or to Cease Trading in time,</span>
</span><span id="AverMarket.get_implied_market_status-526"><a href="#AverMarket.get_implied_market_status-526"><span class="linenos">526</span></a><span class="sd">        the market would use the System Time as a trigger to treat new requests as if it were in the later Status.</span>
</span><span id="AverMarket.get_implied_market_status-527"><a href="#AverMarket.get_implied_market_status-527"><span class="linenos">527</span></a>
</span><span id="AverMarket.get_implied_market_status-528"><a href="#AverMarket.get_implied_market_status-528"><span class="linenos">528</span></a><span class="sd">        If Solana clock time is beyond TradingCeaseTime, market is TradingCeased</span>
</span><span id="AverMarket.get_implied_market_status-529"><a href="#AverMarket.get_implied_market_status-529"><span class="linenos">529</span></a><span class="sd">        If Solana clock time is beyond InPlayStartTime but before TradingCeaseTime, market is ActiveInPlay</span>
</span><span id="AverMarket.get_implied_market_status-530"><a href="#AverMarket.get_implied_market_status-530"><span class="linenos">530</span></a>
</span><span id="AverMarket.get_implied_market_status-531"><a href="#AverMarket.get_implied_market_status-531"><span class="linenos">531</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.get_implied_market_status-532"><a href="#AverMarket.get_implied_market_status-532"><span class="linenos">532</span></a><span class="sd">            MarketStatus: Implied market status</span>
</span><span id="AverMarket.get_implied_market_status-533"><a href="#AverMarket.get_implied_market_status-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.get_implied_market_status-534"><a href="#AverMarket.get_implied_market_status-534"><span class="linenos">534</span></a>        <span class="n">solana_datetime</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">get_system_clock_datetime</span><span class="p">()</span>
</span><span id="AverMarket.get_implied_market_status-535"><a href="#AverMarket.get_implied_market_status-535"><span class="linenos">535</span></a>        <span class="k">if</span> <span class="n">solana_datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">trading_cease_time</span><span class="p">:</span>
</span><span id="AverMarket.get_implied_market_status-536"><a href="#AverMarket.get_implied_market_status-536"><span class="linenos">536</span></a>            <span class="k">return</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">TRADING_CEASED</span>
</span><span id="AverMarket.get_implied_market_status-537"><a href="#AverMarket.get_implied_market_status-537"><span class="linenos">537</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">inplay_start_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">solana_datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">inplay_start_time</span> <span class="p">:</span>
</span><span id="AverMarket.get_implied_market_status-538"><a href="#AverMarket.get_implied_market_status-538"><span class="linenos">538</span></a>            <span class="k">return</span> <span class="n">MarketStatus</span><span class="o">.</span><span class="n">ACTIVE_IN_PLAY</span>
</span><span id="AverMarket.get_implied_market_status-539"><a href="#AverMarket.get_implied_market_status-539"><span class="linenos">539</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_status</span>
</span></pre></div>


            <div class="docstring"><p>Returns what we believe the market status ought to be (rather than what is stored in the market's state on-chain)</p>

<p>Note: As a fail safe, markets have specified times beyond which the market will react as if it is in another Status until it is formally cranked to that Status.
For example, if Solana were to have issues and it was not possible for the market's authority to crank it into In-Play status or to Cease Trading in time,
the market would use the System Time as a trigger to treat new requests as if it were in the later Status.</p>

<p>If Solana clock time is beyond TradingCeaseTime, market is TradingCeased
If Solana clock time is beyond InPlayStartTime but before TradingCeaseTime, market is ActiveInPlay</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>MarketStatus: Implied market status</p>
</blockquote>
</div>


                            </div>
                            <div id="AverMarket.crank_market" class="classattr">
                                        <input id="AverMarket.crank_market-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">crank_market</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">outcome_idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reward_target</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">payer</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">keypair</span><span class="o">.</span><span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="AverMarket.crank_market-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.crank_market"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.crank_market-541"><a href="#AverMarket.crank_market-541"><span class="linenos">541</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">crank_market</span><span class="p">(</span>
</span><span id="AverMarket.crank_market-542"><a href="#AverMarket.crank_market-542"><span class="linenos">542</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-543"><a href="#AverMarket.crank_market-543"><span class="linenos">543</span></a>            <span class="n">outcome_idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-544"><a href="#AverMarket.crank_market-544"><span class="linenos">544</span></a>            <span class="n">reward_target</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-545"><a href="#AverMarket.crank_market-545"><span class="linenos">545</span></a>            <span class="n">payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-546"><a href="#AverMarket.crank_market-546"><span class="linenos">546</span></a>        <span class="p">):</span>
</span><span id="AverMarket.crank_market-547"><a href="#AverMarket.crank_market-547"><span class="linenos">547</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.crank_market-548"><a href="#AverMarket.crank_market-548"><span class="linenos">548</span></a><span class="sd">        Refresh market before cranking</span>
</span><span id="AverMarket.crank_market-549"><a href="#AverMarket.crank_market-549"><span class="linenos">549</span></a><span class="sd">        If no outcome_idx are passed, all outcomes are cranked if they meet the criteria to be cranked.</span>
</span><span id="AverMarket.crank_market-550"><a href="#AverMarket.crank_market-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.crank_market-551"><a href="#AverMarket.crank_market-551"><span class="linenos">551</span></a>        <span class="k">if</span> <span class="n">outcome_idxs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket.crank_market-552"><a href="#AverMarket.crank_market-552"><span class="linenos">552</span></a>            <span class="c1"># For binary markets, there is only one orderbook</span>
</span><span id="AverMarket.crank_market-553"><a href="#AverMarket.crank_market-553"><span class="linenos">553</span></a>            <span class="n">outcome_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="AverMarket.crank_market-554"><a href="#AverMarket.crank_market-554"><span class="linenos">554</span></a>                <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span><span class="p">)]</span>
</span><span id="AverMarket.crank_market-555"><a href="#AverMarket.crank_market-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">number_of_outcomes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">outcome_idxs</span> <span class="ow">or</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">outcome_idxs</span><span class="p">):</span>
</span><span id="AverMarket.crank_market-556"><a href="#AverMarket.crank_market-556"><span class="linenos">556</span></a>            <span class="n">outcome_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AverMarket.crank_market-557"><a href="#AverMarket.crank_market-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="n">reward_target</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket.crank_market-558"><a href="#AverMarket.crank_market-558"><span class="linenos">558</span></a>            <span class="n">reward_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">public_key</span>
</span><span id="AverMarket.crank_market-559"><a href="#AverMarket.crank_market-559"><span class="linenos">559</span></a>        <span class="k">if</span> <span class="n">payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket.crank_market-560"><a href="#AverMarket.crank_market-560"><span class="linenos">560</span></a>            <span class="n">payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="AverMarket.crank_market-561"><a href="#AverMarket.crank_market-561"><span class="linenos">561</span></a>
</span><span id="AverMarket.crank_market-562"><a href="#AverMarket.crank_market-562"><span class="linenos">562</span></a>        <span class="c1"># refreshed_market = await refresh_market(self.aver_client, self)</span>
</span><span id="AverMarket.crank_market-563"><a href="#AverMarket.crank_market-563"><span class="linenos">563</span></a>
</span><span id="AverMarket.crank_market-564"><a href="#AverMarket.crank_market-564"><span class="linenos">564</span></a>        <span class="n">event_queues</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">event_queue</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">]</span>
</span><span id="AverMarket.crank_market-565"><a href="#AverMarket.crank_market-565"><span class="linenos">565</span></a>        <span class="n">loaded_event_queues</span> <span class="o">=</span> <span class="k">await</span> <span class="n">load_all_event_queues</span><span class="p">(</span>
</span><span id="AverMarket.crank_market-566"><a href="#AverMarket.crank_market-566"><span class="linenos">566</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-567"><a href="#AverMarket.crank_market-567"><span class="linenos">567</span></a>            <span class="n">event_queues</span> 
</span><span id="AverMarket.crank_market-568"><a href="#AverMarket.crank_market-568"><span class="linenos">568</span></a>            <span class="p">)</span>
</span><span id="AverMarket.crank_market-569"><a href="#AverMarket.crank_market-569"><span class="linenos">569</span></a>
</span><span id="AverMarket.crank_market-570"><a href="#AverMarket.crank_market-570"><span class="linenos">570</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="AverMarket.crank_market-571"><a href="#AverMarket.crank_market-571"><span class="linenos">571</span></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">outcome_idxs</span><span class="p">:</span>
</span><span id="AverMarket.crank_market-572"><a href="#AverMarket.crank_market-572"><span class="linenos">572</span></a>            <span class="k">if</span> <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;header&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="AverMarket.crank_market-573"><a href="#AverMarket.crank_market-573"><span class="linenos">573</span></a>                <span class="k">continue</span>
</span><span id="AverMarket.crank_market-574"><a href="#AverMarket.crank_market-574"><span class="linenos">574</span></a>
</span><span id="AverMarket.crank_market-575"><a href="#AverMarket.crank_market-575"><span class="linenos">575</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cranking market </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">)</span><span class="si">}</span><span class="s1"> for outcome </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;header&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s1"> events left to crank&#39;</span><span class="p">)</span>
</span><span id="AverMarket.crank_market-576"><a href="#AverMarket.crank_market-576"><span class="linenos">576</span></a>            <span class="k">if</span> <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="AverMarket.crank_market-577"><a href="#AverMarket.crank_market-577"><span class="linenos">577</span></a>                <span class="n">user_accounts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AverMarket.crank_market-578"><a href="#AverMarket.crank_market-578"><span class="linenos">578</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]):</span>
</span><span id="AverMarket.crank_market-579"><a href="#AverMarket.crank_market-579"><span class="linenos">579</span></a>                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">==</span> <span class="n">Fill</span><span class="p">:</span>
</span><span id="AverMarket.crank_market-580"><a href="#AverMarket.crank_market-580"><span class="linenos">580</span></a>                        <span class="n">user_accounts</span> <span class="o">+=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">maker_user_market</span><span class="p">]</span>
</span><span id="AverMarket.crank_market-581"><a href="#AverMarket.crank_market-581"><span class="linenos">581</span></a>                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Out</span>
</span><span id="AverMarket.crank_market-582"><a href="#AverMarket.crank_market-582"><span class="linenos">582</span></a>                        <span class="n">user_accounts</span> <span class="o">+=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">user_market</span><span class="p">]</span>
</span><span id="AverMarket.crank_market-583"><a href="#AverMarket.crank_market-583"><span class="linenos">583</span></a>                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span><span class="p">:</span>
</span><span id="AverMarket.crank_market-584"><a href="#AverMarket.crank_market-584"><span class="linenos">584</span></a>                        <span class="k">break</span>
</span><span id="AverMarket.crank_market-585"><a href="#AverMarket.crank_market-585"><span class="linenos">585</span></a>                <span class="n">user_accounts</span> <span class="o">=</span> <span class="n">prepare_user_accounts_list</span><span class="p">(</span><span class="n">user_accounts</span><span class="p">)</span>
</span><span id="AverMarket.crank_market-586"><a href="#AverMarket.crank_market-586"><span class="linenos">586</span></a>                <span class="n">events_to_crank</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="AverMarket.crank_market-587"><a href="#AverMarket.crank_market-587"><span class="linenos">587</span></a>                    <span class="n">loaded_event_queues</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span><span class="p">)</span>
</span><span id="AverMarket.crank_market-588"><a href="#AverMarket.crank_market-588"><span class="linenos">588</span></a>
</span><span id="AverMarket.crank_market-589"><a href="#AverMarket.crank_market-589"><span class="linenos">589</span></a>                <span class="n">sig</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume_events</span><span class="p">(</span>
</span><span id="AverMarket.crank_market-590"><a href="#AverMarket.crank_market-590"><span class="linenos">590</span></a>                    <span class="n">outcome_idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-591"><a href="#AverMarket.crank_market-591"><span class="linenos">591</span></a>                    <span class="n">max_iterations</span><span class="o">=</span><span class="n">events_to_crank</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-592"><a href="#AverMarket.crank_market-592"><span class="linenos">592</span></a>                    <span class="n">user_accounts</span><span class="o">=</span><span class="n">user_accounts</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-593"><a href="#AverMarket.crank_market-593"><span class="linenos">593</span></a>                    <span class="n">reward_target</span><span class="o">=</span><span class="n">reward_target</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-594"><a href="#AverMarket.crank_market-594"><span class="linenos">594</span></a>                    <span class="n">payer</span><span class="o">=</span><span class="n">payer</span><span class="p">,</span>
</span><span id="AverMarket.crank_market-595"><a href="#AverMarket.crank_market-595"><span class="linenos">595</span></a>                <span class="p">)</span>
</span><span id="AverMarket.crank_market-596"><a href="#AverMarket.crank_market-596"><span class="linenos">596</span></a>
</span><span id="AverMarket.crank_market-597"><a href="#AverMarket.crank_market-597"><span class="linenos">597</span></a>        <span class="k">return</span> <span class="n">sig</span>
</span></pre></div>


            <div class="docstring"><p>Refresh market before cranking
If no outcome_idx are passed, all outcomes are cranked if they meet the criteria to be cranked.</p>
</div>


                            </div>
                            <div id="AverMarket.consume_events" class="classattr">
                                        <input id="AverMarket.consume_events-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">consume_events</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">outcome_idx</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">user_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span><span class="p">]</span>,</span><span class="param">	<span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reward_target</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">publickey</span><span class="o">.</span><span class="n">PublicKey</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">payer</span><span class="p">:</span> <span class="n">solana</span><span class="o">.</span><span class="n">keypair</span><span class="o">.</span><span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="AverMarket.consume_events-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AverMarket.consume_events"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AverMarket.consume_events-599"><a href="#AverMarket.consume_events-599"><span class="linenos">599</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">consume_events</span><span class="p">(</span>
</span><span id="AverMarket.consume_events-600"><a href="#AverMarket.consume_events-600"><span class="linenos">600</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-601"><a href="#AverMarket.consume_events-601"><span class="linenos">601</span></a>        <span class="n">outcome_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-602"><a href="#AverMarket.consume_events-602"><span class="linenos">602</span></a>        <span class="n">user_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PublicKey</span><span class="p">],</span>
</span><span id="AverMarket.consume_events-603"><a href="#AverMarket.consume_events-603"><span class="linenos">603</span></a>        <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-604"><a href="#AverMarket.consume_events-604"><span class="linenos">604</span></a>        <span class="n">reward_target</span><span class="p">:</span> <span class="n">PublicKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-605"><a href="#AverMarket.consume_events-605"><span class="linenos">605</span></a>        <span class="n">payer</span><span class="p">:</span> <span class="n">Keypair</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-606"><a href="#AverMarket.consume_events-606"><span class="linenos">606</span></a>    <span class="p">):</span>
</span><span id="AverMarket.consume_events-607"><a href="#AverMarket.consume_events-607"><span class="linenos">607</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="AverMarket.consume_events-608"><a href="#AverMarket.consume_events-608"><span class="linenos">608</span></a><span class="sd">        Consume events</span>
</span><span id="AverMarket.consume_events-609"><a href="#AverMarket.consume_events-609"><span class="linenos">609</span></a>
</span><span id="AverMarket.consume_events-610"><a href="#AverMarket.consume_events-610"><span class="linenos">610</span></a><span class="sd">        Sends instructions on chain</span>
</span><span id="AverMarket.consume_events-611"><a href="#AverMarket.consume_events-611"><span class="linenos">611</span></a>
</span><span id="AverMarket.consume_events-612"><a href="#AverMarket.consume_events-612"><span class="linenos">612</span></a><span class="sd">        Args:</span>
</span><span id="AverMarket.consume_events-613"><a href="#AverMarket.consume_events-613"><span class="linenos">613</span></a><span class="sd">            outcome_idx (int): index of the outcome</span>
</span><span id="AverMarket.consume_events-614"><a href="#AverMarket.consume_events-614"><span class="linenos">614</span></a><span class="sd">            user_accounts (list[PublicKey]): List of User Account public keys</span>
</span><span id="AverMarket.consume_events-615"><a href="#AverMarket.consume_events-615"><span class="linenos">615</span></a><span class="sd">            max_iterations (int, optional): Depth of events to iterate through. Defaults to MAX_ITERATIONS_FOR_CONSUME_EVENTS.</span>
</span><span id="AverMarket.consume_events-616"><a href="#AverMarket.consume_events-616"><span class="linenos">616</span></a><span class="sd">            reward_target (PublicKey, optional): Target for reward. Defaults to AverClient wallet.</span>
</span><span id="AverMarket.consume_events-617"><a href="#AverMarket.consume_events-617"><span class="linenos">617</span></a><span class="sd">            payer (Keypair, optional): Fee payer. Defaults to AverClient wallet.</span>
</span><span id="AverMarket.consume_events-618"><a href="#AverMarket.consume_events-618"><span class="linenos">618</span></a>
</span><span id="AverMarket.consume_events-619"><a href="#AverMarket.consume_events-619"><span class="linenos">619</span></a><span class="sd">        Returns:</span>
</span><span id="AverMarket.consume_events-620"><a href="#AverMarket.consume_events-620"><span class="linenos">620</span></a><span class="sd">            Transaction Signature: TransactionSignature object</span>
</span><span id="AverMarket.consume_events-621"><a href="#AverMarket.consume_events-621"><span class="linenos">621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AverMarket.consume_events-622"><a href="#AverMarket.consume_events-622"><span class="linenos">622</span></a>        <span class="k">if</span> <span class="n">reward_target</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket.consume_events-623"><a href="#AverMarket.consume_events-623"><span class="linenos">623</span></a>            <span class="n">reward_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">public_key</span>
</span><span id="AverMarket.consume_events-624"><a href="#AverMarket.consume_events-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="n">payer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket.consume_events-625"><a href="#AverMarket.consume_events-625"><span class="linenos">625</span></a>            <span class="n">payer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">owner</span>
</span><span id="AverMarket.consume_events-626"><a href="#AverMarket.consume_events-626"><span class="linenos">626</span></a>        <span class="k">if</span> <span class="n">max_iterations</span> <span class="o">&gt;</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span> <span class="ow">or</span> <span class="n">max_iterations</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AverMarket.consume_events-627"><a href="#AverMarket.consume_events-627"><span class="linenos">627</span></a>            <span class="n">max_iterations</span> <span class="o">=</span> <span class="n">MAX_ITERATIONS_FOR_CONSUME_EVENTS</span>
</span><span id="AverMarket.consume_events-628"><a href="#AverMarket.consume_events-628"><span class="linenos">628</span></a>        
</span><span id="AverMarket.consume_events-629"><a href="#AverMarket.consume_events-629"><span class="linenos">629</span></a>        <span class="n">user_accounts_unsorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">AccountMeta</span><span class="p">(</span>
</span><span id="AverMarket.consume_events-630"><a href="#AverMarket.consume_events-630"><span class="linenos">630</span></a>                <span class="n">pk</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">user_accounts</span><span class="p">]</span>
</span><span id="AverMarket.consume_events-631"><a href="#AverMarket.consume_events-631"><span class="linenos">631</span></a>                
</span><span id="AverMarket.consume_events-632"><a href="#AverMarket.consume_events-632"><span class="linenos">632</span></a>        <span class="n">remaining_accounts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">user_accounts_unsorted</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">account</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">pubkey</span><span class="p">))</span>
</span><span id="AverMarket.consume_events-633"><a href="#AverMarket.consume_events-633"><span class="linenos">633</span></a>
</span><span id="AverMarket.consume_events-634"><a href="#AverMarket.consume_events-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aver_client</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">rpc</span><span class="p">[</span><span class="s2">&quot;consume_events&quot;</span><span class="p">](</span>
</span><span id="AverMarket.consume_events-635"><a href="#AverMarket.consume_events-635"><span class="linenos">635</span></a>                <span class="n">max_iterations</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-636"><a href="#AverMarket.consume_events-636"><span class="linenos">636</span></a>                <span class="n">outcome_idx</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-637"><a href="#AverMarket.consume_events-637"><span class="linenos">637</span></a>                <span class="n">ctx</span><span class="o">=</span><span class="n">Context</span><span class="p">(</span>
</span><span id="AverMarket.consume_events-638"><a href="#AverMarket.consume_events-638"><span class="linenos">638</span></a>                    <span class="n">accounts</span><span class="o">=</span><span class="p">{</span>
</span><span id="AverMarket.consume_events-639"><a href="#AverMarket.consume_events-639"><span class="linenos">639</span></a>                        <span class="s2">&quot;market&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_pubkey</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-640"><a href="#AverMarket.consume_events-640"><span class="linenos">640</span></a>                        <span class="s2">&quot;market_store&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_state</span><span class="o">.</span><span class="n">market_store</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-641"><a href="#AverMarket.consume_events-641"><span class="linenos">641</span></a>                        <span class="s2">&quot;orderbook&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">[</span><span class="n">outcome_idx</span><span class="p">]</span><span class="o">.</span><span class="n">orderbook</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-642"><a href="#AverMarket.consume_events-642"><span class="linenos">642</span></a>                        <span class="s2">&quot;event_queue&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_store_state</span><span class="o">.</span><span class="n">orderbook_accounts</span><span class="p">[</span><span class="n">outcome_idx</span><span class="p">]</span><span class="o">.</span><span class="n">event_queue</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-643"><a href="#AverMarket.consume_events-643"><span class="linenos">643</span></a>                        <span class="s2">&quot;reward_target&quot;</span><span class="p">:</span> <span class="n">reward_target</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-644"><a href="#AverMarket.consume_events-644"><span class="linenos">644</span></a>                    <span class="p">},</span>
</span><span id="AverMarket.consume_events-645"><a href="#AverMarket.consume_events-645"><span class="linenos">645</span></a>                    <span class="n">remaining_accounts</span><span class="o">=</span><span class="n">remaining_accounts</span><span class="p">,</span>
</span><span id="AverMarket.consume_events-646"><a href="#AverMarket.consume_events-646"><span class="linenos">646</span></a>                <span class="p">),</span>
</span><span id="AverMarket.consume_events-647"><a href="#AverMarket.consume_events-647"><span class="linenos">647</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Consume events</p>

<p>Sends instructions on chain</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>outcome_idx (int):</strong>  index of the outcome</li>
<li><strong>user_accounts (list[PublicKey]):</strong>  List of User Account public keys</li>
<li><strong>max_iterations (int, optional):</strong>  Depth of events to iterate through. Defaults to MAX_ITERATIONS_FOR_CONSUME_EVENTS.</li>
<li><strong>reward_target (PublicKey, optional):</strong>  Target for reward. Defaults to AverClient wallet.</li>
<li><strong>payer (Keypair, optional):</strong>  Fee payer. Defaults to AverClient wallet.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Transaction Signature: TransactionSignature object</p>
</blockquote>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>